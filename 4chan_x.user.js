// ==UserScript==
// @name                4chan x
// @namespace           aeosynth
// @version             1.2.0
// @description         Cross-browser userscript for maximum lurking on 4chan.
// @copyright           2013 Zixaphir <zixaphirmoxphar@gmail.com>
// @copyright           2009-2011 James Campos <james.r.campos@gmail.com>
// @copyright           2013 Nicolas Stepien <stepien.nicolas@gmail.com>
// @license             MIT; http://en.wikipedia.org/wiki/Mit_license
// @match               *://*.4chan.org/*
// @grant               GM_getValue
// @grant               GM_setValue
// @grant               GM_deleteValue
// @grant               GM_openInTab
// @run-at              document-start
// @updateURL           https://github.com/zixaphir/appchan-x/raw/stable/4chan_x.meta.js
// @downloadURL         https://github.com/zixaphir/appchan-x/raw/stable/4chan_x.user.js
// @icon                data:image/gif;base64,R0lGODlhYAAQAJEAAGbMM////wAAAP///yH5BAEAAAMALAAAAABgABAAAAL8nI+py+0Po5y02ruEFmh7PnxbJ3KecR4pqoWr2iajIgR2AIb3bu43WPPhdENiLmg7Jn25EODZFDwBTSIPJRwir1tuElvshrNf1RR4lv2QPZzmG9zA16c4uO3+WeVl55Qq9RdVZlc4p3VYdcfXBpSo0ufyJ1gVx2j0huhmWKSW1Xhpd0czSZVBhucl1Hj6acVkBNnZIcggdgh7y0qTFIoaOypTqoiZCTpjiRwp66jp8RhsVmrq2bzbsbz3AcxpDfztBxUIVT0qij0LtsoN3c1MSx5eSQiNTqzL7mzed+4khfZPBrIRL1jEoFHCRYw6A1usKGiiQwgMFCtalFAAADs=
// ==/UserScript==

/*
 * 4chan x - Version 1.2.0 - 2013-03-13
 *
 * Licensed under the MIT license.
 * https://github.com/zixaphir/appchan-x/blob/master/LICENSE
 *
 * Appchan X Copyright © 2013 Zixaphir <zixaphirmoxphar@gmail.com>
 *   http://zixaphir.github.com/appchan-x/
 * 4chan x Copyright © 2009-2011 James Campos <james.r.campos@gmail.com>
 *   http://aeosynth.github.com/4chan-x/
 * 4chan x Copyright © 2013 Nicolas Stepien <stepien.nicolas@gmail.com>
 *   http://mayhemydg.github.com/4chan-x/
 * OneeChan Copyright © 2013 Jordan Bates
 *   http://seaweedchan.github.com/oneechan/
 * 4chan SS Copyright © 2013 Ahodesuka
 *   http://ahodesuka.github.com/4chan-Style-Script
 * Raphael Icons Copyright © 2013 Dmitry Baranovskiy
 *   http://raphaeljs.com/icons/
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 *
 * Contributors:
 *   aeosynth
 *   mayhemydg
 *   noface
 *   !K.WeEabo0o
 *   blaise
 *   that4chanwolf
 *   desuwa
 *   seaweed
 *   e000
 *   ahodesuka
 *   Shou
 *   ferongr
 *   xat
 *   Ongpot
 *   thisisanon
 *   Anonymous
 *   Seiba
 *   herpaderpderp
 *   WakiMiko
 *   btmcsweeney
 *   AppleBloom
 *
 * All the people who've taken the time to write bug reports.
 *
 * Thank you.
 */

/*
 * Linkify based on:
 *   http://downloads.mozdev.org/greasemonkey/linkify.user.js
 *   https://github.com/MayhemYDG/LinkifyPlusFork
 *
 * Originally written by Anthony Lieuallen of http://arantius.com/
 * Licensed for unlimited modification and redistribution as long as
 * this notice is kept intact.
 */

/*
 * JSColor, JavaScript Color Picker
 *
 * @license   GNU Lesser General Public License, http://www.gnu.org/copyleft/lesser.html
 * @author    Jan Odvarko, http://odvarko.cz
 * @link      http://JSColor.com
 */
(function(){var e,t,n,i,a,r,o,s,l,d,c,u,h,p,f,g,m,b,v,A,k,y,w,x,C,D,R,S,I,T,N,B,E,O,M,F,L,H,P,_,q,U,z,j,Q,J,W,Y,V,K,G,X,$,Z,et,tt,nt,it,at,rt,ot,st,lt,dt,ct=[].slice;l={main:{Enhancing:{"Catalog Links":[true,"Turn Navigation links into links to each board's catalog."],"External Catalog":[false,"Link to external catalog instead of the internal one."],"404 Redirect":[true,"Redirect dead threads and images"],Keybinds:[true,"Binds actions to keys"],"Time Formatting":[true,"Arbitrarily formatted timestamps, using your local time"],"File Info Formatting":[true,"Reformats the file information"],"Comment Expansion":[true,"Expand too long comments"],"Thread Expansion":[true,"View all replies"],"Index Navigation":[true,"Navigate to previous / next thread"],"Reply Navigation":[false,"Navigate to top / bottom of thread"],"Custom Navigation":[false,"Customize your Navigation bar."],"Append Delimiters":[false,"Adds delimiters before and after custom navigation."],"Check for Updates":[true,"Check for updated versions of 4chan X"],"Check for Bans":[false,"Check ban status and prepend it to the top of the page."],"Check for Bans constantly":[false,"Optain ban status on every refresh. Note that this will cause delay on getting the result."],"Custom CSS":[false,"Add your own CSS to 4chan."]},Linkification:{Linkify:[true,"Convert text into links where applicable."],Embedding:[true,"Embed supported services."],"Link Title":[true,"Replace the link of a supported site with its actual title. Currently Supported: YouTube, Vimeo, SoundCloud"]},Filtering:{Anonymize:[false,"Make everybody anonymous"],Filter:[true,"Self-moderation placebo"],"Recursive Filtering":[true,"Filter replies of filtered posts, recursively"],"Reply Hiding":[false,"Hide single replies"],"Thread Hiding":[false,"Hide entire threads"],"Show Stubs":[true,"Of hidden threads / replies"]},Imaging:{"Image Expansion":[true,"Expand images"],"Image Hover":[false,"Show full image on mouseover"],Sauce:[true,"Add sauce to images"],"Reveal Spoilers":[false,"Replace spoiler thumbnails by the original thumbnail"],"Don't Expand Spoilers":[true,"Don't expand spoilers when using ImageExpand."],"Expand From Current":[false,"Expand images from current position to thread end."],"Fappe Tyme":[false,"Toggle display of posts without images."],Prefetch:[false,"Prefetch images."],"Replace GIF":[false,"Replace thumbnail of gifs with its actual image."],"Replace PNG":[false,"Replace pngs."],"Replace JPG":[false,"Replace jpgs."]},Menu:{Menu:[true,"Add a drop-down menu in posts."],"Report Link":[true,"Add a report link to the menu."],"Delete Link":[true,"Add post and image deletion links to the menu."],"Download Link":[true,"Add a download with original filename link to the menu. Chrome-only currently."],"Archive Link":[true,"Add an archive link to the menu."],"Embed Link":[true,"Add an embed link to the menu to embed all supported formats in a post."],"Thread Hiding Link":[true,"Add a link to hide entire threads."],"Reply Hiding Link":[true,"Add a link to hide single replies."]},Monitoring:{"Thread Updater":[true,"Update threads. Has more options in its own dialog."],"Optional Increase":[false,"Increase value of Updater over time."],"Interval per board":[false,"Change the intervals of updates on a board-by-board basis."],"Unread Count":[true,"Show unread post count in tab title"],"Unread Favicon":[true,"Show a different favicon when there are unread posts"],"Post in Title":[true,"Show the op's post in the tab title"],"Thread Stats":[true,"Display reply and image count"],"Merged Updater and Stats":[false,"Merges the updater and thread stats into one container."],"Thread Watcher":[true,"Bookmark threads"],"Auto Watch":[true,"Automatically watch threads that you start"],"Auto Watch Reply":[false,"Automatically watch threads that you reply to"],"Color user IDs":[false,"Assign unique colors to user IDs on boards that use them"],"Mark Owned Posts":[true,"Mark quotes to posts you've authored."],"Remove Spoilers":[false,"Remove all spoilers in text."],"Indicate Spoilers":[false,"Indicate spoilers if Remove Spoilers is enabled."]},Posting:{"Quick Reply":[true,"Reply without leaving the page"],Cooldown:[true,'Prevent "flood detected" errors.'],"Persistent QR":[true,"The Quick reply won't disappear after posting."],"Auto Hide QR":[false,"Automatically hide the quick reply when posting."],"Open Reply in New Tab":[false,"Open replies in a new tab that are made from the main board."],"Per Board Persona":[false,"Remember Name, Email, Subject, etc per board instead of globally."],"Remember QR size":[false,"Remember the size of the Quick reply (Firefox only)."],"Remember Subject":[false,"Remember the subject field, instead of resetting after posting."],"Remember Spoiler":[false,"Remember the spoiler state, instead of resetting after posting."],"Remember Sage":[false,"Remember email even if it contains sage."],"Hide Original Post Form":[true,"Replace the normal post form with a shortcut to open the QR"],Markdown:[false,"Code, italic, bold, italic bold, double struck - `, *, **, ***, ||, respectively. _ can be used instead of *."]},Quoting:{"Quote Backlinks":[true,"Add quote backlinks"],"OP Backlinks":[false,"Add backlinks to the OP"],"Quote Highlighting":[true,"Highlight the previewed post"],"Quote Inline":[true,"Show quoted post inline on quote click"],"Quote Hash Navigation":[true,'Show a "#" to jump around the thread as if Quote Inline were disabled.'],"Quote Preview":[true,"Show quote content on hover"],"Resurrect Quotes":[true,"Linkify dead quotes to archives"],"Indicate OP quote":[true,"Add '(OP)' to OP quotes"],"Indicate Cross-thread Quotes":[true,"Add '(Cross-thread)' to cross-threads quotes"],"Forward Hiding":[true,"Hide original posts of inlined backlinks"]}},filter:{name:"# Filter any namefags:\n#/^(?!Anonymous$)/",uniqueid:"# Filter a specific ID:\n#/Txhvk1Tl/",tripcode:"# Filter any tripfags\n#/^!/",mod:"# Set a custom class for mods:\n#/Mod$/;highlight:mod;op:yes\n# Set a custom class for moot:\n#/Admin$/;highlight:moot;op:yes",email:"# Filter any e-mails that are not `sage` on /a/ and /jp/:\n#/^(?!sage$)/;boards:a,jp",subject:"# Filter Generals on /v/:\n#/general/i;boards:v;op:only'",comment:"# Filter Stallman copypasta on /g/:\n#/what you're refer+ing to as linux/i;boards:g",country:"",filename:"",dimensions:"# Highlight potential wallpapers:\n#/1920x1080/;op:yes;highlight;top:no;boards:w,wg",filesize:"",md5:""},sauces:'http://iqdb.org/?url=$1\nhttp://www.google.com/searchbyimage?image_url=$1\n#http://tineye.com/search?url=$1\n#http://saucenao.com/search.php?db=999&url=$1\n#http://3d.iqdb.org/?url=$1\n#http://regex.info/exif.cgi?imgurl=$2\n# uploaders:\n#http://imgur.com/upload?url=$2;text:Upload to imgur\n#http://omploader.org/upload?url1=$2;text:Upload to omploader\n# "View Same" in archives:\n#http://archive.foolz.us/_/search/image/$3/;text:View same on foolz\n#http://archive.foolz.us/$4/search/image/$3/;text:View same on foolz /$4/\n#https://archive.installgentoo.net/$4/image/$3;text:View same on installgentoo /$4/',time:"%m/%d/%y(%a)%H:%M",backlink:">>%id",fileInfo:"%l (%p%s, %r)",favicon:"ferongr",updateIncrease:"5,10,15,20,30,60,90,120,240,300",updateIncreaseB:"5,10,15,20,30,60,90,120,240,300",customCSS:"/* Tripcode Italics: */\n/*\nspan.postertrip {\n  font-style: italic;\n}\n*/\n\n/* Add a rounded border to thumbnails (but not expanded images): */\n/*\n.fileThumb > img:first-child {\n  border: solid 2px rgba(0,0,100,0.5);\n  border-radius: 10px;\n}\n*/\n\n/* Make highlighted posts look inset on the page: */\n/*\ndiv.post:target,\ndiv.post.highlight {\n  box-shadow: inset 2px 2px 2px rgba(0,0,0,0.2);\n}\n*/",hotkeys:{openQR:["I","Open QR with post number inserted"],openEmptyQR:["i","Open QR without post number inserted"],openOptions:["ctrl+o","Open Options"],close:["Esc","Close Options or QR"],spoiler:["ctrl+s","Quick spoiler tags"],math:["ctrl+m","Quick math tags"],eqn:["ctrl+e","Quick eqn tags"],code:["alt+c","Quick code tags"],sageru:["alt+n","Sage keybind"],submit:["alt+s","Submit post"],hideQR:["h","Toggle hide status of QR"],toggleCatalog:["alt+t","Toggle links in nav bar"],watch:["w","Watch thread"],update:["u","Update now"],unreadCountTo0:["z","Mark thread as read"],expandImage:["m","Expand selected image"],expandAllImages:["M","Expand all images"],zero:["0","Jump to page 0"],nextPage:["L","Jump to the next page"],previousPage:["H","Jump to the previous page"],nextThread:["n","See next thread"],previousThread:["p","See previous thread"],expandThread:["e","Expand thread"],openThreadTab:["o","Open thread in new tab"],openThread:["O","Open thread in current tab"],nextReply:["J","Select next reply"],previousReply:["K","Select previous reply"],hide:["x","Hide thread"]},updater:{checkbox:{Beep:[false,"Beep on new post to completely read thread"],Scrolling:[false,"Scroll updated posts into view. Only enabled at bottom of page."],"Scroll BG":[false,"Scroll background tabs"],Verbose:[true,"Show countdown timer, new post count"],"Auto Update":[true,"Automatically fetch new posts"]},Interval:30,BGInterval:60},embedWidth:640,embedHeight:390};if(!/^[a-z]+\.4chan\.org$/.test(location.hostname)){return}s={};st={};ot=document;st.TYPE="sfw";lt={};N=window.MutationObserver||window.WebKitMutationObserver||window.OMutationObserver;e=function(e,t){var n;t||(t=ot.body);if(n=t.querySelector(e)){return n}};e.extend=function(e,t){var n,i;for(n in t){i=t[n];e[n]=i}};e.extend(Array.prototype,{add:function(e,t){var n;n=this.slice(t);this.length=t;this.push(e);return this.pushArrays(n)},contains:function(e){return this.indexOf(e)>-1},indexOf:function(e){var t;t=this.length;while(t--){if(this[t]===e){break}}return t},pushArrays:function(){var e,t,n,i;t=arguments;for(n=0,i=t.length;n<i;n++){e=t[n];this.push.apply(this,e)}return this},remove:function(e){var t;if((t=this.indexOf(e))>-1){return this.splice(t,1)}else{return false}}});e.extend(String.prototype,{capitalize:function(){return this.charAt(0).toUpperCase()+this.slice(1)},contains:function(e){return this.indexOf(e)>-1}});e.DAY=24*(e.HOUR=60*(e.MINUTE=60*(e.SECOND=1e3)));e.extend(e,{NBSP:" ",minmax:function(e,t,n){return e<t?t:e>n?n:e},log:typeof(dt=console.log).bind==="function"?dt.bind(console):void 0,engine:/WebKit|Presto|Gecko/.exec(navigator.userAgent)[0].toLowerCase(),ready:function(t){var n;if(["interactive","complete"].contains(ot.readyState)){return setTimeout(t)}if(!e.callbacks){e.callbacks=[];n=function(){var t,i,a,r;r=e.callbacks;for(i=0,a=r.length;i<a;i++){t=r[i];t()}return e.off(ot,"DOMContentLoaded",n)};e.on(ot,"DOMContentLoaded",n)}e.callbacks.push(t);return e.on(ot,"DOMContentLoaded",n)},sync:function(t,n){var i;t=R.namespace+t;i=JSON.parse;return e.on(window,"storage",function(e){if(e.key===t){return n(i(e.newValue))}})},id:function(e){return ot.getElementById(e)},formData:function(e){var t,n,i;if(e instanceof HTMLFormElement){t=new FormData(e)}else{t=new FormData;for(n in e){i=e[n];if(i){t.append(n,i)}}}return t},ajax:function(t,n,i){var a,r,o,s,l,d,c;if(!i){i={}}l=i.type,r=i.headers,d=i.upCallbacks,a=i.form;s=new XMLHttpRequest;s.overrideMimeType("text/html");l||(l=a&&"post"||"get");s.open(l,t,true);for(o in r){c=r[o];s.setRequestHeader(o,c)}e.extend(s,n);e.extend(s.upload,d);if(l==="post"){s.withCredentials=true}s.send(a);return s},cache:function(t,n){var i;if(i=e.cache.requests[t]){if(i.readyState===4){return n.call(i)}else{return i.callbacks.push(n)}}else{i=e.ajax(t,{onload:function(){var e,t,i;i=this.callbacks;for(e=0,t=i.length;e<t;e++){n=i[e];n.call(this)}},onabort:function(){return delete e.cache.requests[t]},onerror:function(){return delete e.cache.requests[t]}});i.callbacks=[n];return e.cache.requests[t]=i}},cb:{checked:function(){e.set(this.name,this.checked);return s[this.name]=this.checked},value:function(){e.set(this.name,this.value.trim());return s[this.name]=this.value}},addStyle:function(t,n){var i;i=e.el("style",{innerHTML:t,id:n});e.add(ot.head,i);return i},x:function(e,t){t||(t=ot.body);return ot.evaluate(e,t,null,XPathResult.ANY_UNORDERED_NODE_TYPE,null).singleNodeValue},X:function(e,t){t||(t=ot.body);return ot.evaluate(e,t,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null)},addClass:function(e,t){return e.classList.add(t)},rmClass:function(e,t){return e.classList.remove(t)},toggleClass:function(e,t){return e.classList.toggle(t)},rm:function(e){return e.parentNode.removeChild(e)},tn:function(e){return ot.createTextNode(e)},nodes:function(t){var n,i,a,r;if(!(t instanceof Array)){return t}n=e.frag();for(a=0,r=t.length;a<r;a++){i=t[a];e.add(n,i)}return n},frag:function(){return ot.createDocumentFragment()},add:function(t,n){return t.appendChild(e.nodes(n))},prepend:function(t,n){return t.insertBefore(e.nodes(n),t.firstChild)},after:function(t,n){return t.parentNode.insertBefore(e.nodes(n),t.nextSibling)},before:function(t,n){return t.parentNode.insertBefore(e.nodes(n),t)},replace:function(t,n){return t.parentNode.replaceChild(e.nodes(n),t)},el:function(t,n){var i;i=ot.createElement(t);if(n){e.extend(i,n)}return i},on:function(e,t,n){var i,a,r,o;o=t.split(" ");for(a=0,r=o.length;a<r;a++){i=o[a];e.addEventListener(i,n,false)}},off:function(e,t,n){var i,a,r,o;o=t.split(" ");for(a=0,r=o.length;a<r;a++){i=o[a];e.removeEventListener(i,n,false)}},event:function(e,t){return e.dispatchEvent(t)},globalEval:function(t){var n;n=e.el("script",{textContent:"("+t+")()"});e.add(ot.head,n);return e.rm(n)},shortenFilename:function(e,t){var n;n=30+10*t;if(e.replace(/\.\w+$/,"").length>n){return""+e.slice(0,n-5)+"(...)"+e.match(/\.\w+$/)}else{return e}},bytesToString:function(e){var t;t=0;while(e>=1024){e/=1024;t++}e=t>1?Math.round(e*100)/100:Math.round(e);return""+e+" "+["B","KB","MB","GB"][t]},hidden:function(){return ot.hidden||ot.mozHidden||ot.webkitHidden||ot.oHidden}});e.cache.requests={};e.extend(e,typeof GM_deleteValue!=="undefined"&&GM_deleteValue!==null?{"delete":function(e){e=R.namespace+e;return GM_deleteValue(e)},get:function(e,t){var n;e=R.namespace+e;if((n=GM_getValue(e))&&n!=="undefined"){return JSON.parse(n)}else{return t}},set:function(e,t){e=R.namespace+e;localStorage.setItem(e,JSON.stringify(t));return GM_setValue(e,JSON.stringify(t))},open:function(e){return GM_openInTab(location.protocol+e,true)}}:{"delete":function(e){return localStorage.removeItem(R.namespace+e)},get:function(e,t){var n;if(n=localStorage.getItem(R.namespace+e)){return JSON.parse(n)}else{return t}},set:function(e,t){return localStorage.setItem(R.namespace+e,JSON.stringify(t))},open:function(e){return window.open(location.protocol+e,"_blank")}});t=function(e,t){var n;t||(t=ot.body);if(n=ct.call(t.querySelectorAll(e))){return n}return null};nt={dialog:function(t,n,i){var a,r;a=e.el("div",{className:"reply dialog",innerHTML:i,id:t});a.style.cssText=e.get(""+t+".coords",n);if(r=e(".move",a)){r.addEventListener("mousedown",nt.dragstart,false)}return a},dragstart:function(e){var t,n;e.preventDefault();nt.el=t=this.parentNode;ot.addEventListener("mousemove",nt.drag,false);ot.addEventListener("mouseup",nt.dragend,false);n=t.getBoundingClientRect();nt.dx=e.clientX-n.left;nt.dy=e.clientY-n.top;nt.width=ot.documentElement.clientWidth-n.width;return nt.height=ot.documentElement.clientHeight-n.height},drag:function(e){var t,n,i;t=e.clientX-nt.dx;i=e.clientY-nt.dy;t=t<10?"0px":nt.width-t<10?null:t+"px";i=i<10?"0px":nt.height-i<10?null:i+"px";n=nt.el.style;n.left=t;n.top=i;n.right=t===null?"0px":null;return n.bottom=i===null?"0px":null},dragend:function(){e.set(""+nt.el.id+".coords",nt.el.style.cssText);ot.removeEventListener("mousemove",nt.drag,false);ot.removeEventListener("mouseup",nt.dragend,false);return delete nt.el},hover:function(e,t){var n,i,a,r,o,s,l,d;a=e.clientX,r=e.clientY;s=nt.el.style;d=ot.documentElement,n=d.clientHeight,i=d.clientWidth;o=nt.el.offsetHeight;if((t||"default")==="default"){l=r-120;s.top=""+(n<=o||l<=0?0:l+o>=n?n-o:l)+"px";if(a<=i-400){s.left=a+45+"px";return s.right=null}else{s.left=null;s.right=i-a+20+"px";return l=r-120}}else{if(a<=i-400){s.left=a+20+"px";s.right=null;l=r}else{s.left=null;s.right=i-a+20+"px";l=r-120}return s.top=""+(n<=o||l<=0?0:l+o>=n?n-o:l)+"px"}},hoverend:function(){e.rm(nt.el);return delete nt.el}};O={init:function(){var t,n,i,a,r,o,l;if(!e.get("firstrun")){e.set("firstrun",true);if(!m.el){m.init()}O.dialog()}o=["navtopright","navbotright"];l=[];for(a=0,r=o.length;a<r;a++){i=o[a];t=e.el("a",{className:"settingsWindowLink",textContent:"4chan X Settings",href:"javascript:;"});e.on(t,"click",function(){return O.dialog()});n=e.id(i);if(s["Disable 4chan's extension"]){e.replace(n.childNodes[1],t);continue}l.push(e.prepend(n,[e.tn("["),t,e.tn("] ")]))}return l},dialog:function(){var n,i,a,r,o,d,c,u,h,p,f,g,m,b,v,A,k,y,w,x,C,D,S,I,T,N,B,E,M,F,L,H,P,_,q,U;c=O.el=e.el("div",{id:"options",className:"reply dialog",innerHTML:"<div id=optionsbar>  <div id=credits>    <label for=apply>Apply</label>    | <a target=_blank href=http://zixaphir.github.com/appchan-x/>4chan X</a>    | <a target=_blank href=https://raw.github.com/zixaphir/appchan-x/4chanX/changelog>"+R.version+'</a>  </div>  <div class=tabs>    <label for=main_tab id=selected_tab>Main</label>    | <label for=filter_tab>Filter</label>    | <label for=sauces_tab>Sauce</label>    | <label for=keybinds_tab>Keybinds</label>    | <label for=rice_tab>Rice</label>  </div></div><div id=content>  <input type=radio name=tab hidden id=main_tab checked>  <div class=main_tab></div>  <input type=radio name=tab hidden id=sauces_tab>  <div class=sauces_tab>    <div class=warning><code>Sauce</code> is disabled.</div>    Lines starting with a <code>#</code> will be ignored.<br>    You can specify a certain display text by appending <code>;text:[text]</code> to the url.    <ul>These parameters will be replaced by their corresponding values:      <li>$1: Thumbnail url.</li>      <li>$2: Full image url.</li>      <li>$3: MD5 hash.</li>      <li>$4: Current board.</li>    </ul>    <textarea name=sauces id=sauces class=field></textarea>  </div>  <input type=radio name=tab hidden id=filter_tab>  <div class=filter_tab>    <div class=warning><code>Filter</code> is disabled.</div>    <select name=filter>      <option value=guide>Guide</option>      <option value=name>Name</option>      <option value=uniqueid>Unique ID</option>      <option value=tripcode>Tripcode</option>      <option value=mod>Admin/Mod</option>      <option value=email>E-mail</option>      <option value=subject>Subject</option>      <option value=comment>Comment</option>      <option value=country>Country</option>      <option value=filename>Filename</option>      <option value=dimensions>Image dimensions</option>      <option value=filesize>Filesize</option>      <option value=md5>Image MD5 (uses exact string matching, not regular expressions)</option>    </select>  </div>  <input type=radio name=tab hidden id=rice_tab>  <div class=rice_tab>    <ul>      Archiver      <li>        Select an Archiver for this board:        <select name=archiver></select>      </li>    </ul>    <div class=warning><code>Quote Backlinks</code> are disabled.</div>    <ul>      Backlink formatting      <li><input name=backlink class=field> : <span id=backlinkPreview></span></li>    </ul>    <div class=warning><code>Time Formatting</code> is disabled.</div>    <ul>      Time formatting      <li><input name=time class=field> : <span id=timePreview></span></li>      <li>Supported <a href=http://en.wikipedia.org/wiki/Date_%28Unix%29#Formatting>format specifiers</a>:</li>      <li>Day: %a, %A, %d, %e</li>      <li>Month: %m, %b, %B</li>      <li>Year: %y</li>      <li>Hour: %k, %H, %l (lowercase L), %I (uppercase i), %p, %P</li>      <li>Minutes: %M</li>      <li>Seconds: %S</li>    </ul>    <div class=warning><code>File Info Formatting</code> is disabled.</div>    <ul>      File Info Formatting      <li><input name=fileInfo class=field> : <span id=fileInfoPreview class=fileText></span></li>      <li>Link: %l (lowercase L, truncated), %L (untruncated), %t (Unix timestamp)</li>      <li>Original file name: %n (truncated), %N (untruncated), %T (Unix timestamp)</li>      <li>Spoiler indicator: %p</li>      <li>Size: %B (Bytes), %K (KB), %M (MB), %s (4chan default)</li>      <li>Resolution: %r (Displays PDF on /po/, for PDFs)</li>    </ul>    <ul>      Specify size of video embeds<br>      Height: <input name=embedHeight type=number />px      |      Width:  <input name=embedWidth  type=number />px      <button name=resetSize>Reset</button>    </ul>    <ul>      <li>Amounts for Optional Increase</li>      <li>Visible tab</li>      <li><input name=updateIncrease class=field></li>      <li>Background tab</li>      <li><input name=updateIncreaseB class=field></li>    </ul>    <div class=warning><code>Custom Navigation</code> is disabled.</div>    <div id=customNavigation>    </div>    <div class=warning><code>Per Board Persona</code> is disabled.</div>    <div id=persona>      <select name=personaboards></select>      <ul>        <li>          <div class=option>            Name:          </div>        </li>        <li>          <div class=option>            <input name=name>          </div>        </li>        <li>          <div class=option>            Email:          </div>        </li>        <li>          <div class=option>            <input name=email>          </div>        </li>        <li>          <div class=option>            Subject:          </div>        </li>        <li>          <div class=option>            <input name=sub>          </div>        </li>        <li>          <button></button>        </li>      </ul>    </div>    <div class=warning><code>Custom CSS</code> is disabled.</div>    Remove Comment blocks to use! ( "/*" and "*/" around CSS blocks )    <textarea name=customCSS id=customCSS class=field></textarea>    <ul>      <div class=warning><code>Unread Favicon</code> is disabled.</div>      Unread favicons<br>     <span></span>      <select name=favicon>        <option value=ferongr>ferongr</option>        <option value=xat->xat-</option>        <option value=Mayhem>Mayhem</option>        <option value=4chanJS>4chanJS</option>        <option value=Original>Original</option>      </select>    </ul>    <span></span>  </div>  <input type=radio name=tab hidden id=keybinds_tab>  <div class=keybinds_tab>    <div class=warning><code>Keybinds</code> are disabled.</div>    <div>Allowed keys: Ctrl, Alt, Meta, a-z, A-Z, 0-9, Up, Down, Right, Left.</div>    <table><tbody>      <tr><th>Actions</th><th>Keybinds</th></tr>    </tbody></table>  </div>  <input type=radio name=tab hidden onClick="document.location.reload()" id=apply>  <div>Reloading page with new settings.</div></div>'});_=t("label[for]",c);for(F=0,H=_.length;F<H;F++){A=_[F];e.on(A,"click",function(){var t;if(t=e.id("selected_tab")){t.id=""}return this.id="selected_tab"})}q=l.main;for(v in q){w=q[v];T=e.el("ul",{textContent:v});for(v in w){i=w[v];r=e.get(v,s[v])?"checked":"";d=i[1];k=e.el("li",{innerHTML:'<label><input type=checkbox name="'+v+'" '+r+'><span class="optionlabel">'+v+"</span></label><span>: "+d+"</span>"});e.on(e("input",k),"click",e.cb.checked);e.add(T,k)}e.add(e("#main_tab + div",c),T)}m=e.get("hiddenThreads/"+st.BOARD+"/",{});g=Object.keys(st.hiddenReplies).length+Object.keys(m).length;k=e.el("li",{innerHTML:'<span class="optionlabel"><button>hidden: '+g+'</button></span><div style="display: none">Forget all hidden posts. Useful if you accidentally hide a post and have "Show Stubs" disabled.</div>'});e.on(e("button",k),"click",O.clearHidden);e.on(e(".optionlabel",k),"mouseover",O.mouseover);e.add(e("ul:nth-child(3)",c),k);p=e("select[name=filter]",c);e.on(p,"change",O.filter);n=e("select[name=archiver]",c);S=z.select(st.BOARD);if(!S[0]){S=["No Archive Available"]}for(L=0,P=S.length;L<P;L++){y=S[L];e.add(n,e.el("option",{textContent:y}))}if(S[1]){n.value=e.get(E="archiver/"+st.BOARD+"/",S[0]);e.on(n,"change",function(){return e.set(E,this.value)})}C=e("#sauces",c);C.value=e.get(C.name,s[C.name]);e.on(C,"change",e.cb.value);(a=e("[name=backlink]",c)).value=e.get("backlink",s["backlink"]);(D=e("[name=time]",c)).value=e.get("time",s["time"]);(h=e("[name=fileInfo]",c)).value=e.get("fileInfo",s["fileInfo"]);e.on(a,"input",e.cb.value);e.on(a,"input",O.backlink);e.on(D,"input",e.cb.value);e.on(D,"input",O.time);e.on(h,"input",e.cb.value);e.on(h,"input",O.fileInfo);this.persona.select=e("[name=personaboards]",c);this.persona.button=e("#persona button",c);this.persona.data=e.get("persona",{global:{}});if(!this.persona.data[st.BOARD]){this.persona.data[st.BOARD]=JSON.parse(JSON.stringify(this.persona.data.global))}for(y in this.persona.data){this.persona.select.innerHTML+="<option value="+y+">"+y+"</option>"}this.persona.select.value=s["Per Board Persona"]?st.BOARD:"global";this.persona.init();e.on(this.persona.select,"change",O.persona.change);o=e("#customCSS",c);o.value=e.get(o.name,s[o.name]);e.on(o,"change",function(){e.cb.value.call(this);return G.addStyle()});(M=e("[name=embedWidth]",c)).value=e.get("embedWidth",s["embedWidth"]);(f=e("[name=embedHeight]",c)).value=e.get("embedHeight",s["embedHeight"]);e.on(M,"input",e.cb.value);e.on(f,"input",e.cb.value);e.on(e("[name=resetSize]",c),"click",function(){e.set("embedWidth",M.value=l.embedWidth);return e.set("embedHeight",f.value=l.embedHeight)});u=e("select[name=favicon]",c);u.value=e.get("favicon",s["favicon"]);e.on(u,"change",e.cb.value);e.on(u,"change",O.favicon);(N=e("[name=updateIncrease]",c)).value=e.get("updateIncrease",s["updateIncrease"]);(B=e("[name=updateIncreaseB]",c)).value=e.get("updateIncreaseB",s["updateIncreaseB"]);e.on(N,"input",e.cb.value);e.on(B,"input",e.cb.value);this.customNavigation.dialog(c);U=l.hotkeys;for(v in U){i=U[v];I=e.el("tr",{innerHTML:"<td>"+i[1]+"</td><td><input name="+v+" class=field></td>"});b=e("input",I);b.value=e.get(v,s[v]);e.on(b,"keydown",O.keybind);e.add(e("#keybinds_tab + div tbody",c),I)}x=e.el("div",{id:"overlay"});e.on(c,"click",function(e){return e.stopPropagation()});e.on(x,"click",O.close);e.on(c,"click",function(e){return e.stopPropagation()});e.add(x,c);e.add(ot.body,x);ot.body.style.setProperty("width",""+ot.body.clientWidth+"px",null);e.addClass(ot.body,"unscroll");this.indicators(c);O.filter.call(p);O.backlink.call(a);O.time.call(D);O.fileInfo.call(h);return O.favicon.call(u)},indicators:function(n){var i,a,r,o,l,d,c,u,h;a={};u=t(".warning",n);for(o=0,d=u.length;o<d;o++){i=u[o];r=i.firstChild.textContent;i.hidden=e.get(r,s[r]);a[r]=i;e.on(e("[name='"+r+"']",n),"click",function(){return a[this.name].hidden=this.checked})}h=t(".disabledwarning",n);for(l=0,c=h.length;l<c;l++){i=h[l];r=i.firstChild.textContent;i.hidden=!e.get(r,s[r]);a[r]=i;e.on(e("[name='"+r+"']",n),"click",function(){return O.indicators(n)})}},customNavigation:{dialog:function(t){var n,i,a,r,o,s,l,d,c,u,h,p;i=e("#customNavigation",t);h=e.el("ul",{textContent:"Custom Navigation"});l=e.el("li",{className:"delimiter",textContent:"delimiter: "});r=e.el("input",{className:"field",name:"delimiter"});r.setAttribute("value",lt.delimiter);r.setAttribute("placeholder","delimiter");r.setAttribute("type","text");e.on(r,"change",function(){if(this.value===""){alert("Custom Navigation options cannot be blank.");return}lt.delimiter=this.value;return e.set("userNavigation",lt)});e.add(l,r);e.add(h,l);l=e.el("li",{innerHTML:"Navigation Syntax:<br>Display Name | Title / Alternate Text | URL"});e.add(h,l);c=["Display Name","Title / Alt Text","URL"];p=lt.links;for(a in p){d=p[a];if(typeof d!=="object"){continue}l=e.el("li");r=e.el("input",{className:"hidden",value:a,type:"hidden",hidden:"hidden"});e.add(l,r);for(s in d){o=d[s];if(typeof o!=="string"){continue}r=e.el("input",{className:"field",name:s,value:o,placeholder:c[s],type:"text"});e.on(r,"change",function(){if(this.value===""){alert("Custom Navigation options cannot be blank.");return}lt.links[this.parentElement.firstChild.value][this.name]=this.value;return e.set("userNavigation",lt)});e.add(l,[r,e.tn(" ")])}n=e.el("a",{textContent:" + ",href:"javascript:;"});e.on(n,"click",function(){var e;e=["ex","example","http://www.example.com/"];lt.links.add(e,this.parentElement.firstChild.value);return O.customNavigation.cleanup()});u=e.el("a",{textContent:" x ",href:"javascript:;"});e.on(u,"click",function(){lt.links.remove(lt.links[this.parentElement.firstChild.value]);return O.customNavigation.cleanup()});e.add(l,n);e.add(l,u);e.add(h,l)}l=e.el("li",{innerHTML:"<a name='add' href='javascript:;'>+</a> | <a name='reset' href='javascript:;'>Reset</a>"});e.on(e("a[name=add]",l),"click",function(){var e;e=["ex","example","http://www.example.com/"];lt.links.push(e);return O.customNavigation.cleanup()});e.on(e("a[name=reset]",l),"click",function(){lt=JSON.parse(JSON.stringify(E));return O.customNavigation.cleanup()});e.add(h,l);return e.add(i,h)},cleanup:function(){e.set("userNavigation",lt);e.rm(e("#customNavigation > ul",ot.body));return O.customNavigation.dialog(e("#options",ot.body))}},persona:{init:function(){var t,n,i,a,r,o;i=s["Per Board Persona"]?st.BOARD:"global";O.persona.newButton();o=O.persona.array;for(a=0,r=o.length;a<r;a++){n=o[a];t=e("input[name="+n+"]",O.el);t.value=this.data[i][n]||"";e.on(t,"blur",function(){var t;t=O.persona;t.data[t.select.value][this.name]=this.value;return e.set("persona",t.data)})}return e.on(O.persona.button,"click",O.persona.copy)},array:["name","email","sub"],change:function(){var t,n,i,a,r,o;i=this.value;O.persona.newButton();o=O.persona.array;for(a=0,r=o.length;a<r;a++){n=o[a];t=e("input[name="+n+"]",O.el);t.value=O.persona.data[i][n]}},copy:function(){var t,n,i,a;a=O.persona,i=a.select,n=a.data,t=a.change;if(i.value==="global"){n.global=JSON.parse(JSON.stringify(n[i.value]))}else{n[i.value]=JSON.parse(JSON.stringify(n.global))}e.set("persona",O.persona.data=n);return t.call(i)},newButton:function(){return O.persona.button.textContent="Copy from "+(O.persona.select.value==="global"?"current board":"global")}},close:function(){e.rm(this);ot.body.style.removeProperty("width");return e.rmClass(ot.body,"unscroll")},clearHidden:function(){e["delete"]("hiddenReplies/"+st.BOARD+"/");e["delete"]("hiddenThreads/"+st.BOARD+"/");this.textContent="hidden: 0";return st.hiddenReplies={}},keybind:function(t){var n;if(t.keyCode===9){return}t.preventDefault();t.stopPropagation();if((n=C.keyCode(t))==null){return}this.value=n;return e.cb.value.call(this)},filter:function(){var t,n,i,a;n=this.nextSibling;if((i=this.value)!=="guide"){a=e.el("textarea",{name:i,className:"field",value:e.get(i,s[i])});e.on(a,"change",e.cb.value);e.replace(n,a);return}t=e.el("article",{innerHTML:"<p>Use <a href=https://developer.mozilla.org/en/JavaScript/Guide/Regular_Expressions>regular expressions</a>, one per line.<br>\n  Lines starting with a <code>#</code> will be ignored.<br>\n  For example, <code>/weeaboo/i</code> will filter posts containing the string `<code>weeaboo</code>`, case-insensitive.</p>\n<ul>You can use these settings with each regular expression, separate them with semicolons:\n  <li>\n    Per boards, separate them with commas. It is global if not specified.<br>\n    For example: <code>boards:a,jp;</code>.\n  </li>\n  <li>\n    Filter OPs only along with their threads (`only`), replies only (`no`, this is default), or both (`yes`).<br>\n    For example: <code>op:only;</code>, <code>op:no;</code> or <code>op:yes;</code>.\n  </li>\n  <li>\n    Overrule the `Show Stubs` setting if specified: create a stub (`yes`) or not (`no`).<br>\n    For example: <code>stub:yes;</code> or <code>stub:no;</code>.\n  </li>\n  <li>\n    Highlight instead of hiding. You can specify a class name to use with a userstyle.<br>\n    For example: <code>highlight;</code> or <code>highlight:wallpaper;</code>.\n  </li>\n  <li>\n    Highlighted OPs will have their threads put on top of board pages by default.<br>\n    For example: <code>top:yes;</code> or <code>top:no;</code>.\n  </li>\n</ul>"});if(n){return e.replace(n,t)}else{return e.after(this,t)}},time:function(){et.foo();
et.date=new Date;return e.id("timePreview").textContent=et.funk(et)},backlink:function(){return e.id("backlinkPreview").textContent=s["backlink"].replace(/%id/,"123456789")},fileInfo:function(){b.data={link:"//images.4chan.org/g/src/1334437723720.jpg",spoiler:true,size:"276",unit:"KB",resolution:"1280x720",fullname:"d9bb2efc98dd0df141a94399ff5880b7.jpg",shortname:"d9bb2efc98dd0df141a94399ff5880(...).jpg"};b.setFormats();return e.id("fileInfoPreview").innerHTML=b.funk(b)},favicon:function(){m["switch"]();it.update(true);return this.previousElementSibling.innerHTML="<img src="+m.unreadSFW+"> <img src="+m.unreadNSFW+"> <img src="+m.unreadDead+">"}};a={init:function(){var t;this.now=Date.now();if(!s["Check for Bans constantly"]&&(t=e.get("isBanned"))){return a.prepend(t)}else if(s["Check for Bans constantly"]||e.get("lastBanCheck",0)<this.now-6*e.HOUR){return a.load()}},load:function(){this.url="https://www.4chan.org/banned";return e.ajax(this.url,{onloadend:function(){var t,n,i;if(this.status===200||304){if(!s["Check for Bans constantly"]){e.set("lastBanCheck",a.now)}t=ot.implementation.createHTMLDocument("");t.documentElement.innerHTML=this.response;if(/no entry in our database/i.test(n=e(".boxcontent",t).textContent.trim())){if(e.get("isBanned",false)){e["delete"]("isBanned");e.rm(a.el);delete a.el}return}e.set("isBanned",i=/This ban will not expire/i.test(n)?"You are permabanned.":"You are banned.");return a.prepend(i)}}})},prepend:function(t){var n;if(!a.el){Banchecker.el=n=e.el("h2",{id:"banmessage","class":"warning",innerHTML:"          <span>"+t+"</span>          <a href="+a.url+" title='Click to find out why.' target=_blank>Click to find out why.</a>",title:"Click to recheck."},e.on(n.lastChild,"click",function(){if(!s["Check for Bans constantly"]){e["delete"]("lastBanCheck")}e["delete"]("isBanned");this.parentNode.style.opacity=".5";return a.load()}));return e.before(e.id("delform"),n)}else{return Banchecker.el.firstChild.textContent=t}}};o={init:function(){var t,n;n=e.el("span",{id:"toggleCatalog",innerHTML:"[<a href=javascript:;></a>]"});e.on(t=n.firstElementChild,"click",this.toggle);e.add(e.id("boardNavDesktop"),[e.tn(" "),n]);return this.toggle.call(t,true)},toggle:function(n){var i,a,r,l,d,c;if(n===true){r=e.get("CatalogIsToggled",st.CATALOG)}else{e.set("CatalogIsToggled",r=this.textContent==="Catalog Off")}c=t("a",e.id("boardNavDesktop"));for(l=0,d=c.length;l<d;l++){i=c[l];a=i.pathname.split("/")[1];if(["f","status","4chan"].contains(a)||!a){if(a==="f"){i.pathname="/f/"}continue}if(s["External Catalog"]){i.href=r?o.external(a):"//boards.4chan.org/"+a+"/"}else{i.pathname="/"+a+"/"+(r?"catalog":"")}i.title=r?""+i.title+" - Catalog":i.title.replace(/\ -\ Catalog$/,"")}this.textContent="Catalog "+(r?"On":"Off");return this.title="Turn catalog links "+(r?"off":"on")+"."},external:function(e){return["a","c","g","co","k","m","o","p","v","vg","w","cm","3","adv","an","cgl","ck","diy","fa","fit","int","jp","mlp","lit","mu","n","po","sci","toy","trv","tv","vp","x","q"].contains(e)?"http://catalog.neet.tv/"+e:["d","e","gif","h","hr","hc","r9k","s","pol","soc","u","i","ic","hm","r","w","wg","wsg","t","y"].contains(e)?"http://4index.gropes.us/"+e:"//boards.4chan.org/"+e+"/catalog"}};d={init:function(){var t,n,i,a,r,o,l,d;o=e("#boardNavDesktop",ot.body);r=o.childNodes;n=r.length;d=s["Append Delimiters"]?[e.tn(""+lt.delimiter+" ")]:[];while(n--){if((l=r[n]).id){continue}e.rm(l)}i=lt.links.length-1;while(n++<i){a=lt.links[n];t=e.el("a",{textContent:a[0],title:a[1],href:a[2]});if(t.href.contains("/"+st.BOARD+"/")){e.addClass(t,"current")}d[d.length]=t;if(s["Append Delimiters"]||n!==i){d[d.length]=e.tn(" "+lt.delimiter+" ")}}e.prepend(o,d)}};E={delimiter:"/",links:[["a","Anime & Manga","//boards.4chan.org/a/"],["b","Random","//boards.4chan.org/b/"],["c","Cute/Anime","//boards.4chan.org/c/"],["d","Hentai/Alternative","//boards.4chan.org/d/"],["e","Ecchi","//boards.4chan.org/e/"],["f","Flash","//boards.4chan.org/f/"],["g","Technology","//boards.4chan.org/g/"],["gif","Animated Gifs","//boards.4chan.org/gif/"],["h","Hentai","//boards.4chan.org/h/"],["hr","High Resolution","//boards.4chan.org/hr/"],["k","Weapons","//boards.4chan.org/k/"],["l","Lolicon","http://7chan.org/cake/"],["m","Mecha","//boards.4chan.org/m/"],["o","Auto","//boards.4chan.org/o/"],["p","Pictures","//boards.4chan.org/p/"],["r","Requests","//boards.4chan.org/r/"],["s","Sexy Beautiful Women","//boards.4chan.org/s/"],["t","Torrents","//boards.4chan.org/t/"],["u","Yuri","//boards.4chan.org/u/"],["v","Video Games","//boards.4chan.org/v/"],["vg","Video Game Generals","//boards.4chan.org/vg/"],["w","Anime/Wallpapers","//boards.4chan.org/w/"],["wg","Wallpapers/General","//boards.4chan.org/wg/"],["i","Oekaki","//boards.4chan.org/i/"],["ic","Artwork/Critique","//boards.4chan.org/ic/"],["r9k","Robot 9K","//boards.4chan.org/r9k/"],["cm","Cute/Male","//boards.4chan.org/cm/"],["hm","Handsome Men","//boards.4chan.org/hm/"],["y","Yaoi","//boards.4chan.org/y/"],["3","3DCG","//boards.4chan.org/3/"],["adv","Advice","//boards.4chan.org/adv/"],["an","Animals","//boards.4chan.org/an/"],["cgl","Cosplay & EGL","//boards.4chan.org/cgl/"],["ck","Food & Cooking","//boards.4chan.org/ck/"],["co","Comics & Cartoons","//boards.4chan.org/co/"],["diy","Do It Yourself","//boards.4chan.org/diy/"],["fa","Fashion","//boards.4chan.org/fa/"],["fit","Health & Fitness","//boards.4chan.org/fit/"],["hc","Hardcore","//boards.4chan.org/hc/"],["int","International","//boards.4chan.org/int/"],["jp","Otaku Culture","//boards.4chan.org/jp/"],["lit","Literature","//boards.4chan.org/lit/"],["mlp","My Little Pony","//boards.4chan.org/mlp/"],["mu","Music","//boards.4chan.org/mu/"],["n","Transportation","//boards.4chan.org/n/"],["po","Papercraft & Origami","//boards.4chan.org/po/"],["pol","Politically Incorrect","//boards.4chan.org/pol/"],["sci","Science & Math","//boards.4chan.org/sci/"],["soc","Social","//boards.4chan.org/soc/"],["sp","Sports","//boards.4chan.org/sp/"],["tg","Traditional Games","//boards.4chan.org/tg/"],["toy","Toys","//boards.4chan.org/toys/"],["trv","Travel","//boards.4chan.org/trv/"],["tv","Television & Film","//boards.4chan.org/tv/"],["vp","Pok&eacute;mon","//boards.4chan.org/vp/"],["wsg","Worksafe GIF","//boards.4chan.org/wsg/"],["x","Paranormal","//boards.4chan.org/x/"],["rs","Rapidshares","http://rs.4chan.org/"],["status","4chan Status","http://status.4chan.org/"],["q","4chan Discussion","//boards.4chan.org/q/"],["@","4chan Twitter","http://www.twitter.com/4chan"]]};p={init:function(){var n,i,a,r;r=t(".abbr");for(i=0,a=r.length;i<a;i++){n=r[i];e.on(n.firstElementChild,"click",p.expand)}},callbacks:[],node:function(e){var t,n,i,a;a=p.callbacks;for(n=0,i=a.length;n<i;n++){t=a[n];t(e)}},expand:function(t){var n,i,a,r,o;t.preventDefault();o=this.href.match(/(\d+)#p(\d+)/),r=o[0],a=o[1],i=o[2];this.textContent="Loading No."+i+"...";n=this;return e.cache("//api.4chan.org"+this.pathname+".json",function(){return p.parse(this,n,a,i)})},parse:function(t,n,i,a){var o,l,d,c,u,h,f,g,m,b,v,A,k,y;m=s;if(t.status!==200){n.textContent=""+t.status+" "+t.statusText;return}u=JSON.parse(t.response).posts;if(g=u[0].custom_spoiler){r.spoilerRange[st.BOARD]=g}a=+a;for(b=0,A=u.length;b<A;b++){c=u[b];if(c.no===a){break}}if(c.no!==a){n.textContent="No.#{replyID} not found.";return}o=e.id("m"+a);l=o.cloneNode(false);l.innerHTML=c.com;y=f=l.getElementsByClassName("quotelink");for(v=0,k=y.length;v<k;v++){h=y[v];d=h.getAttribute("href");if(d[0]==="/"){continue}h.href="res/"+d}c={blockquote:l,threadID:i,quotes:f,backlinks:[]};p.node(c);e.replace(o,l);return R.prettify(l)}};f={init:function(){var n,i,a,r,o;o=t(".summary");for(a=0,r=o.length;a<r;a++){i=o[a];n=e.el("a",{textContent:"+ "+i.textContent,className:"summary desktop",href:"javascript:;"});e.on(n,"click",function(){return f.toggle(this.parentNode)});e.replace(i,n)}},toggle:function(n){var i,a,r,o,s,l,d;s="//api.4chan.org/"+st.BOARD+"/res/"+n.id.slice(1)+".json";i=e(".summary",n);switch(i.textContent[0]){case"+":i.textContent=i.textContent.replace("+","× Loading...");e.cache(s,function(){return f.parse(this,n,i)});break;case"X":i.textContent=i.textContent.replace("× Loading...","+");e.cache.requests[s].abort();break;case"-":i.textContent=i.textContent.replace("-","+");a=function(){switch(st.BOARD){case"b":case"vg":case"q":return 3;case"t":return 1;default:return 5}}();r=t(".replyContainer",n);r.splice(r.length-a,a);for(l=0,d=r.length;l<d;l++){o=r[l];e.rm(o)}}},parse:function(n,i,a){var o,s,l,d,c,u,h,p,g,m,b,v,A,k,y,w,x,C,D,S,I,T,N,B;if((v=n.status)!==200){a.textContent=""+v+" "+n.statusText;e.off(a,"click",f.cb.toggle);return}a.textContent=a.textContent.replace("× Loading...","-");p=JSON.parse(n.response).posts;if(b=p[0].custom_spoiler){r.spoilerRange[st.BOARD]=b}g=p.slice(1);A=i.id.slice(1);u=[];for(k=0,C=g.length;k<C;k++){m=g[k];h=r.postFromObject(m,st.BOARD);l=m.no;d=e('a[title="Highlight this post"]',h);d.href="res/"+A+"#p"+l;d.nextSibling.href="res/"+A+"#q"+l;u.push(h)}T=t(".summary ~ .replyContainer",a.parentNode);for(y=0,D=T.length;y<D;y++){h=T[y];e.rm(h)}N=t(".backlink",a.previousElementSibling);for(w=0,S=N.length;w<S;w++){o=N[w];if(!e.id(o.hash.slice(1))){e.rm(o)}}B=[];for(x=0,I=u.length;x<I;x++){c=u[x];s=e.frag();e.add(s,c);h=R.preParse(c);h.threadID=A;R.node(h);B.push(e.add(i,s))}return B}};b={init:function(){if(st.BOARD==="f"){return}this.setFormats();q.callbacks.push(this.node);return R.callbacks.push(this.node)},node:function(t){var n,i,a,o;if(!t.fileInfo){return}a=t.fileInfo.firstElementChild;n=t.img.alt;i=((o=e("span",a))!=null?o.title:void 0)||a.title;b.data={link:t.img.parentNode.href,spoiler:/^Spoiler/.test(n),size:n.match(/\d+\.?\d*/)[0],unit:n.match(/\w+$/)[0],resolution:a.textContent.match(/\d+x\d+|PDF/)[0],fullname:i,shortname:r.shortFilename(i,t.ID===t.threadID)};a.setAttribute("data-filename",i);return a.innerHTML=b.funk(b)},setFormats:function(){var e;e=s["fileInfo"].replace(/%(.)/g,function(e,t){if(t in b.formatters){return"' + f.formatters."+t+"() + '"}else{return e}});return this.funk=Function("f","return '"+e+"'")},convertUnit:function(e){var t,n,i,a;n=this.data.size;i=this.data.unit;if(i!==e){a=["B","KB","MB"];t=a.indexOf(i)-a.indexOf(e);if(e==="B"){e="Bytes"}if(t>0){while(t-->0){n*=1024}}else if(t<0){while(t++<0){n/=1024}}if(n<1&&n.toString().length>n.toFixed(2).length){n=n.toFixed(2)}}return""+n+" "+e},formatters:{t:function(){return b.data.link.match(/\d+\..+$/)[0]},T:function(){return"<a href="+b.data.link+" target=_blank>"+this.t()+"</a>"},l:function(){return"<a href="+b.data.link+" target=_blank>"+this.n()+"</a>"},L:function(){return"<a href="+b.data.link+" target=_blank>"+this.N()+"</a>"},n:function(){if(b.data.fullname===b.data.shortname){return b.data.fullname}else{return"<span class=fntrunc>"+b.data.shortname+"</span><span class=fnfull>"+b.data.fullname+"</span>"}},N:function(){return b.data.fullname},p:function(){if(b.data.spoiler){return"Spoiler, "}else{return""}},s:function(){return""+b.data.size+" "+b.data.unit},B:function(){return b.convertUnit("B")},K:function(){return b.convertUnit("KB")},M:function(){return b.convertUnit("MB")},r:function(){return b.data.resolution}}};C={init:function(){var n,i,a,r;this.bindings=this.bind();r=t("[accesskey]");for(i=0,a=r.length;i<a;i++){n=r[i];n.removeAttribute("accesskey")}return e.on(ot,"keydown",C.keydown)},bind:function(){var t,n;n=s;t={};t[n.openQR]=function(e){return C.qr(e,true)};t[n.openEmptyQR]=function(e){return C.qr(e)};t[n.openOptions]=function(){if(!e.id("overlay")){return O.dialog()}};t[n.close]=function(){var t;if(t=e.id("overlay")){return O.close.call(t)}else if(F.el){return F.close()}};t[n.submit]=function(){if(F.el&&!F.status()){return F.submit()}};t[n.hideQR]=function(){if(F.el){if(F.el.hidden){return F.el.hidden=false}return F.autohide.click()}else{return F.open()}};t[n.toggleCatalog]=function(){return o.toggle()};t[n.spoiler]=function(){if(!(e("[name=spoiler]")&&nodeName==="textarea")){return}return C.tags("spoiler",target)};t[n.math]=function(){if(!(st.BOARD===!!e('script[src^="//boards.4chan.org/jsMath/"]',ot.head)&&nodeName==="textarea")){return}return C.tags("math",target)};t[n.eqn]=function(){if(!(st.BOARD===!!e('script[src^="//boards.4chan.org/jsMath/"]',ot.head)&&nodeName==="textarea")){return}return C.tags("eqn",target)};t[n.code]=function(){if(!(st.BOARD===R.hasCodeTags&&nodeName==="textarea")){return}return C.tags("code",target)};t[n.sageru]=function(){e("[name=email]",F.el).value="sage";return F.selected.email="sage"};t[n.watch]=function(e){return rt.toggle(e)};t[n.update]=function(){return at.update()};t[n.unreadCountTo0]=function(){it.replies=[];return it.update(true)};t[n.expandImage]=function(e){return C.img(e)};t[n.expandAllImages]=function(e){return C.img(e,true)};t[n.zero]=function(){return window.location="/"+st.BOARD+"/0#delform"};t[n.nextPage]=function(){var t;if(t=e(".next form")){return window.location=t.action}};t[n.previousPage]=function(){var t;if(t=e(".prev form")){return window.location=t.action}};t[n.nextThread]=function(){if(st.REPLY){return}return B.scroll(+1)};t[n.previousThread]=function(){if(st.REPLY){return}return B.scroll(-1)};t[n.expandThread]=function(e){return f.toggle(e)};t[n.openThread]=function(e){return C.open(e)};t[n.openThreadTab]=function(e){return C.open(e,true)};t[n.nextReply]=function(e){return C.hl(+1,e)};t[n.previousReply]=function(e){return C.hl(-1,e)};t[n.hide]=function(e){if(/\bthread\b/.test(e.className)){return $.toggle(e)}};return t},keydown:function(e){var t,n,i,a,r;if(!(n=C.keyCode(e))){return}a=e.target;if((i=a.nodeName.toLowerCase())==="textarea"||i==="input"){if(!(n==="Esc"||/\+/.test(n))){return}}r=B.getThread();if(!(t=C.bindings[n])){return}t(r);return e.preventDefault()},keyCode:function(e){var t,n,i;i=[48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90].contains(n=e.keyCode)?(t=String.fromCharCode(n),e.shiftKey?t:t.toLowerCase()):function(){switch(n){case 8:return"";case 13:return"Enter";case 27:return"Esc";case 37:return"Left";case 38:return"Up";case 39:return"Right";case 40:return"Down";default:return null}}();if(i){if(e.altKey){i="alt+"+i}if(e.ctrlKey){i="ctrl+"+i}if(e.metaKey){i="meta+"+i}}return i},tags:function(t,n){var i,a,r,o;o=n.value;r=n.selectionStart;a=n.selectionEnd;n.value=o.slice(0,r)+("["+t+"]")+o.slice(r,a)+("[/"+t+"]")+o.slice(a);i=("["+t+"]").length+a;n.setSelectionRange(i,i);return e.event(n,new Event("input"))},img:function(t,n){var i;if(n){return e.id("imageExpand").click()}else{i=e("img[data-md5]",e(".post.highlight",t)||t);return y.toggle(i.parentNode)}},qr:function(t,n){if(n){F.quote.call(e('a[title="Quote this post"]',e(".post.highlight",t)||t))}else{F.open()}return e("textarea",F.el).focus()},open:function(t,n){var i,a;if(st.REPLY){return}i=t.id.slice(1);a="//boards.4chan.org/"+st.BOARD+"/res/"+i;if(n){return e.open(a)}else{return location.href=a}},hl:function(n,i){var a,r,o,s,l,d,c,u;if(o=e(".reply.highlight",i)){e.rmClass(o,"highlight");s=o.getBoundingClientRect();if(s.bottom>=0&&s.top<=ot.documentElement.clientHeight){a=n===+1?"following":"preceding";r=e.x(a+'::div[contains(@class,"post reply")][1]',o);if(!r){return}if(!(st.REPLY||e.x('ancestor::div[parent::div[@class="board"]]',r)===i)){return}s=r.getBoundingClientRect();if(s.top<0||s.bottom>ot.documentElement.clientHeight){r.scrollIntoView(n===-1)}this.focus(r);return}}l=t(".reply",i);if(n===-1){l.reverse()}for(c=0,u=l.length;c<u;c++){d=l[c];s=d.getBoundingClientRect();if(n===+1&&s.top>=0||n===-1&&s.bottom<=ot.documentElement.clientHeight){this.focus(d);return}}},focus:function(t){e.addClass(t,"highlight");return t.focus()}};E={delimiter:"/",links:[["a","Anime & Manga","//boards.4chan.org/a/"],["b","Random","//boards.4chan.org/b/"],["c","Cute/Anime","//boards.4chan.org/c/"],["d","Hentai/Alternative","//boards.4chan.org/d/"],["e","Ecchi","//boards.4chan.org/e/"],["f","Flash","//boards.4chan.org/f/"],["g","Technology","//boards.4chan.org/g/"],["gif","Animated Gifs","//boards.4chan.org/gif/"],["h","Hentai","//boards.4chan.org/h/"],["hr","High Resolution","//boards.4chan.org/hr/"],["k","Weapons","//boards.4chan.org/k/"],["l","Lolicon","http://7chan.org/cake/"],["m","Mecha","//boards.4chan.org/m/"],["o","Auto","//boards.4chan.org/o/"],["p","Pictures","//boards.4chan.org/p/"],["r","Requests","//boards.4chan.org/r/"],["s","Sexy Beautiful Women","//boards.4chan.org/s/"],["t","Torrents","//boards.4chan.org/t/"],["u","Yuri","//boards.4chan.org/u/"],["v","Video Games","//boards.4chan.org/v/"],["vg","Video Game Generals","//boards.4chan.org/vg/"],["w","Anime/Wallpapers","//boards.4chan.org/w/"],["wg","Wallpapers/General","//boards.4chan.org/wg/"],["i","Oekaki","//boards.4chan.org/i/"],["ic","Artwork/Critique","//boards.4chan.org/ic/"],["r9k","Robot 9K","//boards.4chan.org/r9k/"],["cm","Cute/Male","//boards.4chan.org/cm/"],["hm","Handsome Men","//boards.4chan.org/hm/"],["y","Yaoi","//boards.4chan.org/y/"],["3","3DCG","//boards.4chan.org/3/"],["adv","Advice","//boards.4chan.org/adv/"],["an","Animals","//boards.4chan.org/an/"],["cgl","Cosplay & EGL","//boards.4chan.org/cgl/"],["ck","Food & Cooking","//boards.4chan.org/ck/"],["co","Comics & Cartoons","//boards.4chan.org/co/"],["diy","Do It Yourself","//boards.4chan.org/diy/"],["fa","Fashion","//boards.4chan.org/fa/"],["fit","Health & Fitness","//boards.4chan.org/fit/"],["hc","Hardcore","//boards.4chan.org/hc/"],["int","International","//boards.4chan.org/int/"],["jp","Otaku Culture","//boards.4chan.org/jp/"],["lit","Literature","//boards.4chan.org/lit/"],["mlp","My Little Pony","//boards.4chan.org/mlp/"],["mu","Music","//boards.4chan.org/mu/"],["n","Transportation","//boards.4chan.org/n/"],["po","Papercraft & Origami","//boards.4chan.org/po/"],["pol","Politically Incorrect","//boards.4chan.org/pol/"],["sci","Science & Math","//boards.4chan.org/sci/"],["soc","Social","//boards.4chan.org/soc/"],["sp","Sports","//boards.4chan.org/sp/"],["tg","Traditional Games","//boards.4chan.org/tg/"],["toy","Toys","//boards.4chan.org/toys/"],["trv","Travel","//boards.4chan.org/trv/"],["tv","Television & Film","//boards.4chan.org/tv/"],["vp","Pok&eacute;mon","//boards.4chan.org/vp/"],["wsg","Worksafe GIF","//boards.4chan.org/wsg/"],["x","Paranormal","//boards.4chan.org/x/"],["rs","Rapidshares","http://rs.4chan.org/"],["status","4chan Status","http://status.4chan.org/"],["q","4chan Discussion","//boards.4chan.org/q/"],["@","4chan Twitter","http://www.twitter.com/4chan"]]};B={init:function(){var t,n,i;i=e.el("span",{id:"navlinks"});n=e.el("a",{href:"javascript:;"});t=e.el("a",{href:"javascript:;"});e.on(n,"click",this.prev);e.on(t,"click",this.next);e.add(i,[n,t]);return e.add(ot.body,i)},prev:function(){if(st.REPLY){return window.scrollTo(0,0)}else{return B.scroll(-1)}},next:function(){if(st.REPLY){return window.scrollTo(0,ot.body.scrollHeight)}else{return B.scroll(+1)}},getThread:function(n){var i,a,r,o,s,l,d;B.threads=t(".thread:not(.hidden)");d=B.threads;for(a=s=0,l=d.length;s<l;a=++s){o=d[a];r=o.getBoundingClientRect();i=r.bottom;if(i>0){if(n){return[o,a,r]}return o}}return e(".board")},scroll:function(e){var t,n,i,a,r,o;r=B.getThread(true),i=r[0],t=r[1],n=r[2];a=n.top;if(!(e===-1&&Math.ceil(a)<0||e===+1&&a>1)){t+=e}a=(o=B.threads[t])!=null?o.getBoundingClientRect().top:void 0;return window.scrollBy(0,a)}};z={image:function(e,t){switch(e){case"a":case"jp":case"m":case"q":case"sp":case"tg":case"vg":case"wsg":return"//archive.foolz.us/"+e+"/full_image/"+t;case"cgl":case"g":case"mu":case"w":return"//rbt.asia/"+e+"/full_image/"+t;case"an":case"k":case"toy":case"x":return"http://archive.heinessen.com/"+e+"/full_image/"+t;case"ck":case"lit":return"//fuuka.warosu.org/"+e+"/full_image/"+t;case"u":return"//nsfw.foolz.us/"+e+"/full_image/"+t;case"e":return"//www.xn--clich-fsa.net/4chan/cgi-board.pl/"+e+"/img/"+t;case"c":return"//archive.nyafuu.org/"+e+"/full_image/"+t}},post:function(e,t){var n,i,a,r;if(z.post[e]===void 0){r=this.archiver;for(i in r){n=r[i];if(n.type==="foolfuuka"&&n.boards.contains(e)){z.post[e]=n.base;break}}(a=z.post)[e]||(a[e]=null)}if(z.post[e]){return""+z.post[e]+"/_/api/chan/post/?board="+e+"&num="+t}return null},archiver:{Foolz:{base:"//archive.foolz.us",boards:["a","co","jp","m","q","sp","tg","tv","v","vg","wsg","dev","foolz"],type:"foolfuuka"},NSFWFoolz:{base:"//nsfw.foolz.us",boards:["u","kuku"],type:"foolfuuka"},TheDarkCave:{base:"http://archive.thedarkcave.org",boards:["c","int","po"],type:"foolfuuka"},Warosu:{base:"//fuuka.warosu.org",boards:["cgl","ck","jp","lit","q","tg"],type:"fuuka"},RebeccaBlackTech:{base:"//rbt.asia",boards:["cgl","g","mu","w"],type:"fuuka_mail"},InstallGentoo:{base:"//archive.installgentoo.net",boards:["diy","g","sci"],type:"fuuka"},Heinessen:{base:"http://archive.heinessen.com",boards:["an","fit","k","mlp","r9k","toy","x"],type:"fuuka"},Cliche:{base:"//www.xn--clich-fsa.net/4chan/cgi-board.pl",boards:["e"],type:"fuuka"},NyaFuu:{base:"//archive.nyafuu.org",boards:["c","w"],type:"fuuka"}},select:function(e){var t,n;return function(){var i,a;i=this.archiver;a=[];for(n in i){t=i[n];if(t.boards.contains(e||st.BOARD)){a.push(n)}}return a}.call(this)},to:function(t){var n,i,a,r;i=t.board,r=t.threadID,a=t.isSearch;return(n=this.archiver[e.get("archiver/"+i+"/",this.select(i)[0])])?this.path(n.base,n.type,t):r&&!a?"//boards.4chan.org/"+i+"/":null},path:function(e,t,n){var i,a,r,o,s,l,d;i=n.board,s=n.type,d=n.value,o=n.threadID,r=n.postID,a=n.isSearch;if(a){s=s==="name"?"username":s==="md5"?"image":s;d=encodeURIComponent(d);return(l=t==="foolfuuka"?"search/"+s+"/":s==="image"?"?task=search2&search_media_hash=":s!=="email"||t==="fuuka_mail"?"?task=search2&search_"+s+"=":false)?""+e+"/"+i+"/"+l+d:l}if(r){r=r.match(/\d+/)[0]}return e+"/"+i+"/"+(o?"thread/"+o:"post/"+r)+(o&&r?"#"+(t==="foolfuuka"?"p":"")+r:"")}};et={init:function(){et.foo();q.callbacks.push(this.node);return R.callbacks.push(this.node)},node:function(t){var n;n=e(".postInfo > .dateTime",t.el);et.date=new Date(n.dataset.utc*1e3);return n.textContent=et.funk(et)},foo:function(){var e;e=s["time"].replace(/%([A-Za-z])/g,function(e,t){if(t in et.formatters){return"' + Time.formatters."+t+"() + '"}else{return e}});return et.funk=Function("Time","return '"+e+"'")},day:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],month:["January","February","March","April","May","June","July","August","September","October","November","December"],zeroPad:function(e){if(e<10){return"0"+e}else{return e}},formatters:{a:function(){return et.day[et.date.getDay()].slice(0,3)},A:function(){return et.day[et.date.getDay()]},b:function(){return et.month[et.date.getMonth()].slice(0,3)},B:function(){return et.month[et.date.getMonth()]},d:function(){return et.zeroPad(et.date.getDate())},e:function(){return et.date.getDate()},H:function(){return et.zeroPad(et.date.getHours())},I:function(){return et.zeroPad(et.date.getHours()%12||12)},k:function(){return et.date.getHours()},l:function(){return et.date.getHours()%12||12},m:function(){return et.zeroPad(et.date.getMonth()+1)},M:function(){return et.zeroPad(et.date.getMinutes())},p:function(){if(et.date.getHours()<12){return"AM"}else{return"PM"}},P:function(){if(et.date.getHours()<12){return"am"}else{return"pm"}},S:function(){return et.zeroPad(et.date.getSeconds())},y:function(){return et.date.getFullYear()-2e3}}};n={init:function(){q.callbacks.push(this.node);return R.callbacks.push(this.node)},node:function(t){var n,i,a;n=e(".postInfo .name",t.el);n.textContent="Anonymous";if((a=n.nextElementSibling)&&a.className==="postertrip"){e.rm(a)}if((i=n.parentNode).className==="useremail"&&!/^mailto:sage$/i.test(i.href)){return e.replace(i,n)}}};v={filters:{},init:function(){var e,t,n,i,a,r,o,d,c,u,h,p,f,g,m;for(i in l.filter){this.filters[i]=[];h=s[i].split("\n");for(c=0,u=h.length;c<u;c++){t=h[c];if(t[0]==="#"){continue}if(!(r=t.match(/\/(.+)\/(\w*)/))){continue}t=t.replace(r[0],"");e=((p=t.match(/boards:([^;]+)/))!=null?p[1].toLowerCase():void 0)||"global";if(!(e==="global"||e.split(",").contains(st.BOARD))){continue}if(i==="md5"){r=r[1]}else{try{r=RegExp(r[1],r[2])}catch(b){alert(b.message);continue}}a=((f=t.match(/[^t]op:(yes|no|only)/))!=null?f[1]:void 0)||"no";o=function(){var e;switch((e=t.match(/stub:(yes|no)/))!=null?e[1]:void 0){case"yes":return true;case"no":return false;default:return s["Show Stubs"]}}();if(n=/highlight/.test(t)){n=((g=t.match(/highlight:(\w+)/))!=null?g[1]:void 0)||"filter_highlight";d=((m=t.match(/top:(yes|no)/))!=null?m[1]:void 0)||"yes";d=d==="yes"}this.filters[i].push(this.createFilter(r,a,o,n,d))}if(!this.filters[i].length){delete this.filters[i]}}if(Object.keys(this.filters).length){return R.callbacks.push(this.node)}},createFilter:function(e,t,n,i,a){var r,o;o=typeof e==="string"?function(t){return e===t}:function(t){return e.test(t)};r={hide:!i,stub:n,"class":i,top:a};return function(e,n){if(n&&t==="no"||!n&&t==="only"){return false}if(!o(e)){return false}return r}},node:function(t){var n,i,a,r,o,s,l,d,c;if(t.isInlined){return}i=t.ID===t.threadID;o=t.root;for(a in v.filters){s=v[a](t);if(s===false){continue}c=v.filters[a];for(l=0,d=c.length;l<d;l++){n=c[l];if(!(r=n(s,i))){continue}if(r.hide){if(i){if(!st.REPLY){$.hide(o.parentNode,r.stub)}else{continue}}else{J.hide(t.root,r.stub)}return}e.addClass(o,r["class"])}}},name:function(t){return e(".name",t.el).textContent},uniqueid:function(t){var n;if(n=e(".posteruid",t.el)){return n.textContent.slice(5,-1)}return false},tripcode:function(t){var n;if(n=e(".postertrip",t.el)){return n.textContent}return false},mod:function(t){var n;if(n=e(".capcode",t.el)){return n.textContent}return false},email:function(t){var n;if(n=e(".useremail",t.el)){return decodeURIComponent(n.href.slice(7))}return false},subject:function(t){var n;if((n=e(".postInfo .subject",t.el)).textContent.length!==0){return n.textContent}return false},comment:function(e){var t,n,i,a,r,o,s;r=[];a=ot.evaluate(".//br|.//text()",e.blockquote,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(i=o=0,s=a.snapshotLength;0<=s?o<s:o>s;i=0<=s?++o:--o){r.push((n=a.snapshotItem(i).data)?n:"\n")}if((t=r.join("")).length!==0){return t}return false},country:function(t){var n;if(n=e(".countryFlag",t.el)){return n.title}return false},filename:function(t){var n,i;i=t.fileInfo;if(i){if(n=e(".fileText > span",i)){return n.title}else{return i.firstElementChild.dataset.filename}}return false},dimensions:function(e){var t,n;t=e.fileInfo;if(t&&(n=t.textContent.match(/\d+x\d+/))){return n[0]}return false},filesize:function(e){var t;t=e.img;if(t){return t.alt.replace("Spoiler Image, ","")}return false},md5:function(e){var t;t=e.img;if(t){return t.dataset.md5}return false},menuInit:function(){var t,n,i,a,r,o;t=e.el("div",{textContent:"Filter"});n={el:t,open:function(){return true},children:[]};o=[["Name","name"],["Unique ID","uniqueid"],["Tripcode","tripcode"],["Admin/Mod","mod"],["E-mail","email"],["Subject","subject"],["Comment","comment"],["Country","country"],["Filename","filename"],["Image dimensions","dimensions"],["Filesize","filesize"],["Image MD5","md5"]];for(a=0,r=o.length;a<r;a++){i=o[a];n.children.push(this.createSubEntry(i[0],i[1]))}return T.addEntry(n)},createSubEntry:function(t,n){var i,a,r;i=e.el("a",{href:"javascript:;",textContent:t});a=null;r=function(t){var r;r=v[n](t);if(r===false){return false}e.off(i,"click",a);a=function(){var i,a,o,s,l;i=n==="md5"?r:r.replace(/\/|\\|\^|\$|\n|\.|\(|\)|\{|\}|\[|\]|\?|\*|\+|\|/g,function(e){if(e==="\n"){return"\\n"}else if(e==="\\"){return"\\\\"}else{return"\\"+e}});i=n==="md5"?"/"+r+"/":"/^"+i+"$/";if(/\bop\b/.test(t["class"])){i+=";op:yes"}a=(a=e.get(n,""))?""+a+"\n"+i:i;e.set(n,a);O.dialog();o=e("select[name=filter]",e.id("options"));o.value=n;e.event(o,new Event("change"));e.id("filter_tab").checked=true;s=o.nextElementSibling;l=s.textLength;s.setSelectionRange(l,l);return s.focus()};e.on(i,"click",a);return true};return{el:i,open:r}}};J={init:function(){return R.callbacks.push(this.node)},node:function(t){var n;if(t.isInlined||t.ID===t.threadID){return}n=e(".sideArrows",t.root);n.innerHTML='<a href="javascript:;"><span>[ - ]</span></a>';e.on(n.firstChild,"click",function(){var e,t,n;return J.toggle(e=this.parentNode,n=e.parentNode,t=n.id.slice(2))});if(t.ID in st.hiddenReplies){return J.hide(t.root)}},toggle:function(n,i,a){var r,o,s,l,d,c;o=t(".quotelink[href$='#p"+a+"'], .backlink[href$='#p"+a+"']");if(/\bstub\b/.test(n.className)){J.show(i);for(s=0,d=o.length;s<d;s++){r=o[s];e.rmClass(r,"filtered")}delete st.hiddenReplies[a]}else{J.hide(i);for(l=0,c=o.length;l<c;l++){r=o[l];e.addClass(r,"filtered")}st.hiddenReplies[a]=Date.now()}return e.set("hiddenReplies/"+st.BOARD+"/",st.hiddenReplies)},hide:function(t){var n,i,a,r,o;r=e(".post",t);if(r.hidden){return}r.hidden=true;e.addClass(t,"hidden");if(!s["Show Stubs"]){return}o=e.el("div",{className:"stub",innerHTML:"<a href='javascript:;' id='show"+(i=t.id.slice(2))+"'>"+(s["Anonymize"]?"Anonymous":e(".desktop > .nameBlock",t).textContent)+" <span>[ + ]</span> </a>"});n=o.firstChild;e.on(n,"click",function(){var n;return J.toggle(n=this.parentNode,t=e.id("pc"+this.id.slice(4)),i)});if(s["Menu"]){a=T.a.cloneNode(true);e.on(a,"click",T.toggle);e.add(o,[e.tn(" "),a])}return e.prepend(t,o)},show:function(t){var n,i;if(i=e(".stub",t)){e.rm(i)}n=e(".post",t);n.hidden=false;return e.rmClass(t,"hidden")},unhide:function(e){if(e.el.hidden){return J.show(e.root)}}};K={init:function(){return R.callbacks.push(this.node)},node:function(t){var n,i,a,r,o;if(t.isInlined){return}o=t.quotes;for(a=0,r=o.length;a<r;a++){i=o[a];if(!(i.hash&&(n=e.id("p"+i.hash.slice(2)))&&i.hostname==="boards.4chan.org"&&!/catalog$/.test(i.pathname)&&n.hidden)){continue}e.addClass(i,"filtered");if(s["Recursive Filtering"]&&t.ID!==t.threadID){J.hide(t.root)}}}};$={init:function(){var n,i,a,r,o;this.hiddenThreads=e.get("hiddenThreads/"+st.BOARD+"/",{});$.sync();if(st.CATALOG){return}o=t(".thread");for(a=0,r=o.length;a<r;a++){i=o[a];n=e.el("a",{className:"hide_thread_button",innerHTML:"<span>[ - ]</span>",href:"javascript:;"});e.on(n,"click",function(){return $.toggle(e.x('ancestor::div[@class="thread"][1]',this))});e.add(e(".op .postInfo",i),n);if(i.id.slice(1)in this.hiddenThreads){$.hide(i)}}},sync:function(){var t,n;t=JSON.parse(localStorage.getItem("4chan-hide-t-"+st.BOARD))||{};if(st.CATALOG){for(n in this.hiddenThreads){t[n]=true}return localStorage.setItem("4chan-hide-t-"+st.BOARD,JSON.stringify(t))}else{for(n in t){if(!(n in this.hiddenThreads)){this.hiddenThreads[n]=Date.now()}}return e.set("hiddenThreads/"+st.BOARD+"/",this.hiddenThreads)}},toggle:function(t){var n;n=t.id.slice(1);if(t.hidden||/\bhidden_thread\b/.test(t.firstChild.className)){$.show(t);delete $.hiddenThreads[n]}else{$.hide(t);$.hiddenThreads[n]=Date.now()}return e.set("hiddenThreads/"+st.BOARD+"/",$.hiddenThreads)},hide:function(n){var i,a,r,o,l,d;if(!s["Show Stubs"]){n.hidden=true;n.nextElementSibling.hidden=true;return}if(/\bhidden_thread\b/.test(n.firstChild.className)){return}a=0;if(o=e(".summary",n)){a=Number(o.textContent.match(/\d+/))}a+=t(".opContainer ~ .replyContainer",n).length;d=a===1?"1 reply":""+a+" replies";r=e(".desktop > .nameBlock",n).textContent;l=e.el("a",{className:"hidden_thread",innerHTML:"<span class=hide_thread_button>[ + ]</span>",href:"javascript:;"});e.on(l,"click",function(){return $.toggle(this.parentElement)});e.add(l,e.tn(""+r+" ("+d+")"));if(s["Menu"]){i=T.a.cloneNode(true);e.on(i,"click",T.toggle);e.add(l,[e.tn(" "),i])}return e.prepend(n,l)},show:function(t){var n;if(n=e(".hidden_thread",t)){e.rm(n)}t.hidden=false;return t.nextElementSibling.hidden=false}};g={init:function(){var t;if(st.CATALOG||st.BOARD==="f"){return}t=e.el("a",{href:"javascript:;",id:"fappeTyme",title:"Fappe Tyme"});e.on(t,"click",g.toggle);e.add(e.id("navtopright"),t);return R.callbacks.push(this.node)},node:function(e){if(e.img){return}return e.el.parentElement.classList.add("noFile")},toggle:function(){return e.toggleClass(ot.body,"fappeTyme")
}};y={init:function(){if(st.BOARD==="f"){return}P.callbacks.push(this.node);R.callbacks.push(this.node);return this.dialog()},node:function(t){var n;if(!t.img||t.hasPDF){return}n=t.img.parentNode;e.on(n,"click",y.cb.toggle);if(s["Don't Expand Spoilers"]&&!s["Reveal Spoilers"]&&/^spoiler\ image/i.test(n.firstChild.alt)){return}if(y.on&&!t.el.hidden){return y.expand(t.img)}},cb:{toggle:function(e){if(e.shiftKey||e.altKey||e.ctrlKey||e.metaKey||e.button){return}e.preventDefault();return y.toggle(this)},all:function(){var e,n,i,a,r,o,l,d,c,u;y.on=this.checked;if(y.on){i=t("img[data-md5]");if(s["Expand From Current"]){for(e=a=0,l=i.length;a<l;e=++a){n=i[e];if(n.getBoundingClientRect().top>0){break}}i=i.slice(e)}for(r=0,d=i.length;r<d;r++){n=i[r];if(s["Don't Expand Spoilers"]&&!s["Reveal Spoilers"]&&/^spoiler\ image/i.test(n.alt)){continue}y.expand(n)}}else{u=t("img[data-md5][hidden]");for(o=0,c=u.length;o<c;o++){n=u[o];y.contract(n)}}},typeChange:function(){var t;t=function(){switch(this.value){case"full":return"";case"fit width":return"fitwidth";case"fit height":return"fitheight";case"fit screen":return"fitwidth fitheight"}}.call(this);e.id("delform").className=t;if(/\bfitheight\b/.test(t)){e.on(window,"resize",y.resize);if(!y.style){y.style=e.addStyle("")}return y.resize()}else if(y.style){return e.off(window,"resize",y.resize)}}},toggle:function(t){var n,i;i=t.firstChild;if(i.hidden){n=t.getBoundingClientRect();if(n.bottom>0){if(e.engine==="webkit"){if(n.top<0){ot.body.scrollTop+=n.top-42}if(n.left<0){ot.body.scrollLeft+=n.left}}else{if(n.top<0){ot.documentElement.scrollTop+=n.top-42}if(n.left<0){ot.documentElement.scrollLeft+=n.left}}}return y.contract(i)}else{return y.expand(i)}},contract:function(t){t.hidden=false;t.nextSibling.hidden=true;return e.rmClass(t.parentNode.parentNode.parentNode.parentNode,"image_expanded")},expand:function(t,n){var i,a;if(e.x("ancestor-or-self::*[@hidden]",t)){return}i=t.parentNode;n||(n=i.href);if(/\.pdf$/.test(n)){return}t.hidden=true;e.addClass(t.parentNode.parentNode.parentNode.parentNode,"image_expanded");if((a=t.nextSibling)&&a.tagName.toLowerCase()==="img"){a.hidden=false;return}a=e.el("img",{src:n,className:"fullSize"});e.on(a,"error",y.error);return e.after(t,a)},error:function(){var t,n,i,a;n=this.previousSibling;y.contract(n);e.rm(this);t=this.src.split("/");if(!(t[2]==="images.4chan.org"&&(a=z.image(t[3],t[5])))){if(st.dead){return}a="//images.4chan.org/"+t[3]+"/src/"+t[5]}if(e.engine!=="webkit"&&a.split("/")[2]==="images.4chan.org"){return}i=setTimeout(y.expand,1e4,n,a);if(e.engine!=="webkit"||a.split("/")[2]!=="images.4chan.org"){return}return e.ajax(a,{onreadystatechange:function(){if(this.status===404){return clearTimeout(i)}}},{type:"head"})},dialog:function(){var t,n,i;t=e.el("div",{id:"imgControls",innerHTML:"<div id=imgContainer><select id=imageType name=imageType><option value=full>Full</option><option value='fit width'>Fit Width</option><option value='fit height'>Fit Height</option value='fit screen'><option value='fit screen'>Fit Screen</option></select><label><input type=checkbox id=imageExpand></label></div>"});n=e.get("imageType","full");i=e("select",t);i.value=n;y.cb.typeChange.call(i);e.on(i,"change",e.cb.value);e.on(i,"change",y.cb.typeChange);e.on(e("input",t),"click",y.cb.all);return e.prepend(e.id("delform"),t)},resize:function(){return y.style.textContent=".fitheight img[data-md5] + img {max-height:"+ot.documentElement.clientHeight+"px;}"}};w={init:function(){P.callbacks.push(this.node);return R.callbacks.push(this.node)},node:function(t){if(!t.img||t.hasPDF){return}return e.on(t.img,"mouseover",w.mouseover)},mouseover:function(){var t;if(t=e.id("ihover")){if(t===nt.el){delete nt.el}e.rm(t)}if(nt.el){return}t=nt.el=e.el("img",{id:"ihover",src:this.parentNode.href});e.add(ot.body,t);e.on(t,"load",w.load);e.on(t,"error",w.error);e.on(this,"mousemove",nt.hover);return e.on(this,"mouseout",w.mouseout)},load:function(){var e;if(!this.parentNode){return}e=this.style;return nt.hover({clientX:-45+parseInt(e.left),clientY:120+parseInt(e.top)})},error:function(){var t,n,i,a=this;t=this.src.split("/");if(!(t[2]==="images.4chan.org"&&(i=z.image(t[3],t[5])))){if(st.dead){return}i="//images.4chan.org/"+t[3]+"/src/"+t[5]}if(e.engine!=="webkit"&&i.split("/")[2]==="images.4chan.org"){return}n=setTimeout(function(){return a.src=i},3e3);if(e.engine!=="webkit"||i.split("/")[2]!=="images.4chan.org"){return}return e.ajax(i,{onreadystatechange:function(){if(this.status===404){return clearTimeout(n)}}},{type:"head"})},mouseout:function(){nt.hoverend();e.off(this,"mousemove",nt.hover);return e.off(this,"mouseout",w.mouseout)}};x={init:function(){if(st.BOARD==="f"){return}P.callbacks.push(this.node);q.callbacks.push(this.node);return R.callbacks.push(this.node)},node:function(t){var n,i,a,r;a=t.img;if(t.el.hidden||!a||/spoiler/.test(a.src)){return}if(s["Replace "+((r=(i=a.parentNode.href).match(/\w{3}$/)[0].toUpperCase())==="PEG"?"JPG":r)]){n=e.el("img");n.setAttribute("data-id",t.ID);e.on(n,"load",function(){return a.src=n.src});return n.src=i}}};M={init:function(){if(st.BOARD==="f"){return}return this.dialog()},dialog:function(){var t,n,i;t=e.el("label",{id:"prefetch",innerHTML:"<input type=checkbox>Prefetch Images"});i=e("input",t);e.on(i,"change",M.change);n=e.id("delform").firstElementChild;if(n.id==="imgControls"){return e.after(n,t)}else{return e.before(n,t)}},change:function(){var n,i,a,r;e.off(this,"change",M.change);r=t("a.fileThumb");for(i=0,a=r.length;i<a;i++){n=r[i];e.el("img",{src:n.href})}return R.callbacks.push(M.node)},node:function(t){var n;n=t.img;if(t.el.hidden||!n){return}return e.el("img",{src:n.parentNode.href})}};Y={init:function(){q.callbacks.push(this.node);p.callbacks.push(this.node);return R.callbacks.push(this.node)},node:function(e){var t,n;t=e.img;if(!(t&&/^Spoiler/.test(t.alt))||e.isArchived){return}t.removeAttribute("style");n=t.style;n.maxHeight=n.maxWidth=/\bop\b/.test(e["class"])?"250px":"125px";return t.src="//thumbs.4chan.org"+t.parentNode.pathname.replace(/src(\/\d+).+$/,"thumb$1s.jpg")}};V={init:function(){var e,t,n,i;if(st.BOARD==="f"){return}this.links=[];i=s["sauces"].split("\n");for(t=0,n=i.length;t<n;t++){e=i[t];if(e[0]==="#"){continue}this.links.push(this.createSauceLink(e.trim()))}if(!this.links.length){return}return R.callbacks.push(this.node)},createSauceLink:function(t){var n,i,a,r;t=t.replace(/(\$\d)/g,function(e){switch(e){case"$1":return"' + (isArchived ? img.firstChild.src : 'http://thumbs.4chan.org' + img.pathname.replace(/src(\\/\\d+).+$/, 'thumb$1s.jpg')) + '";case"$2":return"' + img.href + '";case"$3":return"' + encodeURIComponent(img.firstChild.dataset.md5) + '";case"$4":return st.BOARD;default:return e}});n=(r=t.match(/;text:(.+)$/))?r[1]:t.match(/(\w+)\.\w+\//)[1];a=t.replace(/;text:.+$/,"");a=Function("img","isArchived","return '"+a+"'");i=e.el("a",{target:"_blank",textContent:n});return function(e,t){var n;n=i.cloneNode(true);n.href=a(e,t);return n}},node:function(t){var n,i,a,r,o,s;n=t.img;if(!n){return}n=n.parentNode;a=[];s=V.links;for(r=0,o=s.length;r<o;r++){i=s[r];a.push(e.tn(" "),i(n,t.isArchived))}return e.add(t.fileInfo,a)}};D={init:function(){if(s["Embedding"]){P.callbacks.push(function(n){var i,a,r,o;o=t(".embed",n.blockquote);for(a=0,r=o.length;a<r;a++){i=o[a];e.on(i,"click",D.toggle)}})}q.callbacks.push(this.node);p.callbacks.push(this.node);return R.callbacks.push(this.node)},regString:/(\b([a-z]+:\/\/|[a-z]{3,}\.[-a-z0-9]+\.[a-z]+|[-a-z0-9]+\.[a-z]{2,4}|[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+|[a-z]{3,}:[a-z0-9?]|[a-z0-9._%+-:]+@[a-z0-9.-]+\.[a-z0-9])[^\s'"]+)/gi,cypher:e.el("div"),node:function(t){var n,i,a,r,o,s,l,d,c,u,h,p,f,g,m,b,v,A,k,y,w,x,C,R,S,I,T;b=e.X(".//text()",t.blockquote);a=D.cypher;s=-1;d=b.snapshotLength;T=[];while(++s<d){m=e.frag();g=b.snapshotItem(s);o=g.data;if(!(g.parentNode&&D.regString.test(o))){continue}D.regString.lastIndex=0;r=[];if(f=g.nextSibling){a.textContent=g.textContent;r[0]=a.innerHTML;while((f.nodeName.toLowerCase()==="wbr"||f.nodeName.toLowerCase()==="s")&&(h=f.nextSibling)&&((p=h.nodeName)==="#text"||p.toLowerCase()==="br")){a.textContent=h.textContent;r.push((v=f.innerHTML)?"<s>"+v.replace(/</g," <")+"</s>":"<wbr>");r.push(a.innerHTML);e.rm(f);f=h.nextSibling;if(h.nodeName==="#text"){e.rm(h)}if(!f){break}}}if(r.length){o=r.join("")}u=o.match(D.regString);for(k=0,x=u.length;k<x;k++){c=u[k];l=o.indexOf(c);if(A=o.slice(0,l)){a.innerHTML=A;S=ct.call(a.childNodes);for(y=0,C=S.length;y<C;y++){i=S[y];e.add(m,i)}}a.innerHTML=(c.indexOf(":")<0?c.indexOf("@")>0?"mailto:"+c:"http://"+c:c).replace(/<(wbr|s|\/s)>/g,"");n=e.el("a",{innerHTML:c,className:"linkify",rel:"nofollow noreferrer",target:"_blank",href:a.textContent});e.add(m,D.embedder(n));o=o.slice(l+c.length)}if(o){a.innerHTML=o;I=ct.call(a.childNodes);for(w=0,R=I.length;w<R;w++){i=I[w];e.add(m,i)}}T.push(e.replace(g,m))}return T},toggle:function(){var t,n,i,a,r;n=this.previousElementSibling;if(this.className.contains("embedded")){t=e.el("a",{rel:"nofollow noreferrer",target:"blank",className:"linkify",href:r=this.getAttribute("data-originalURL"),textContent:this.getAttribute("data-title")||r});this.textContent="(embed)"}else{t=(a=D.types[this.getAttribute("data-service")]).el.call(this);t.style.cssText=(i=a.style)?i:"border: 0; width: "+e.get("embedWidth",l["embedWidth"])+"px; height: "+e.get("embedHeight",l["embedHeight"])+"px";this.textContent="(unembed)"}e.replace(n,t);return e.toggleClass(this,"embedded")},types:{YouTube:{regExp:/.*(?:youtu.be\/|youtube.*v=|youtube.*\/embed\/|youtube.*\/v\/|youtube.*videos\/)([^#\&\?]*).*/,el:function(){return e.el("iframe",{src:"//www.youtube.com/embed/"+this.name})},title:{api:function(){return"https://gdata.youtube.com/feeds/api/videos/"+this.name+"?alt=json&fields=title/text(),yt:noembed,app:control/yt:state/@reasonCode"},text:function(){return JSON.parse(this.responseText).entry.title.$t}}},Vocaroo:{regExp:/.*(?:vocaroo.com\/)([^#\&\?]*).*/,style:"border: 0; width: 150px; height: 45px;",el:function(){return e.el("object",{innerHTML:"<embed src='http://vocaroo.com/player.swf?playMediaID="+this.name.replace(/^i\//,"")+"&autoplay=0' width='150' height='45' pluginspage='http://get.adobe.com/flashplayer/' type='application/x-shockwave-flash'></embed>"})}},Vimeo:{regExp:/.*(?:vimeo.com\/)([^#\&\?]*).*/,el:function(){return e.el("iframe",{src:"//player.vimeo.com/video/"+this.name})},title:{api:function(){return"https://vimeo.com/api/oembed.json?url=http://vimeo.com/"+this.name},text:function(){return JSON.parse(this.responseText).title}}},LiveLeak:{regExp:/.*(?:liveleak.com\/view.+i=)([0-9a-z_]+)/,el:function(){return e.el("iframe",{src:"http://www.liveleak.com/e/"+this.name+"?autostart=true"})}},audio:{regExp:/(.*\.(mp3|ogg|wav))$/,el:function(){return e.el("audio",{controls:"controls",preload:"auto",src:this.name})}},SoundCloud:{regExp:/.*(?:soundcloud.com\/|snd.sc\/)([^#\&\?]*).*/,el:function(){var t;t=e.el("div",{className:"soundcloud",name:"soundcloud"});return e.ajax("//soundcloud.com/oembed?show_artwork=false&&maxwidth=500px&show_comments=false&format=json&url="+this.getAttribute("data-originalURL")+"&color="+G.colorToHex(Themes[s["theme"]]["Background Color"]),{div:t,onloadend:function(){return this.div.innerHTML=JSON.parse(this.responseText).html}},false)}},pastebin:{regExp:/.*(?:pastebin.com\/)([^#\&\?]*).*/,el:function(){var t;return t=e.el("iframe",{src:"http://pastebin.com/embed_iframe.php?i="+this.name})}}},embedder:function(t){var n,i,a,r,o,l,d,c,u;if(!s["Embedding"]){return[t]}n=function(){var n;return t.textContent=function(){switch(this.status){case 200:case 304:n="["+i.getAttribute("data-service")+"] "+o.text.call(this);i.setAttribute("data-title",n);d[i.name]=[n,Date.now()];e.set("CachedTitles",d);return n;case 404:return"["+a+"] Not Found";case 403:return"["+a+"] Forbidden or Private";default:return"["+a+"] "+this.status+"'d"}}.call(this)};u=D.types;for(a in u){c=u[a];if(!(r=t.href.match(c.regExp))){continue}i=e.el("a",{name:t.name=r[1],className:"embed",href:"javascript:;",textContent:"(embed)"});i.setAttribute("data-service",a);i.setAttribute("data-originalURL",t.href);e.on(i,"click",D.toggle);if(s["Link Title"]&&(o=c.title)){d=e.get("CachedTitles",{});if(l=d[r[1]]){t.textContent=l[0];i.setAttribute("data-title",l[0])}else{try{e.cache(o.api.call(t),n)}catch(h){t.innerHTML="["+a+"] <span class=warning>Title Link Blocked</span> (are you using NoScript?)</a>"}}}return[t,e.tn(" "),i]}return[t]}};i={init:function(){var t,n,i,a,r;t=e.el("div",{textContent:"Archive"});n={el:t,open:function(t){var n;n=e('a[title="Highlight this post"]',t.el).pathname.split("/");if(z.to({board:n[1],threadID:n[3],postID:t.ID})==="//boards.4chan.org/"+n[1]+"/"){return false}t.info=[n[1],n[3]];return true},children:[]};r={Post:"apost",Name:"name",Tripcode:"tripcode","E-mail":"email",Subject:"subject",Filename:"filename","Image MD5":"md5"};for(i in r){a=r[i];n.children.push(this.createSubEntry(i,a))}return T.addEntry(n)},createSubEntry:function(t,n){var i,a;i=e.el("a",{textContent:t,target:"_blank"});a=function(e){var t;if(n==="apost"){i.href=z.to({board:e.info[0],threadID:e.info[1],postID:e.ID});return true}t=v[n](e);if(!t){return false}return i.href=z.to({board:e.info[0],type:n,value:t,isSearch:true})};return{el:i,open:a}}};c={init:function(){var t,n,i,a;a=e.el("div",{className:"delete_link",textContent:"Delete"});n=e.el("a",{className:"delete_post",href:"javascript:;"});t=e.el("a",{className:"delete_image",href:"javascript:;"});i=[];i.push({el:n,open:function(){n.textContent="Post";e.on(n,"click",c["delete"]);return true}});i.push({el:t,open:function(n){if(!n.img){return false}t.textContent="Image";e.on(t,"click",c["delete"]);return true}});T.addEntry({el:a,open:function(e){var t,n;if(e.isArchived){return false}t=a.firstChild;if(n=c.cooldown[e.ID]){t.textContent="Delete ("+n+")";c.cooldown.el=t}else{t.textContent="Delete";delete c.cooldown.el}return true},children:i});return e.on(ot,"QRPostSuccessful",this.cooldown.start)},"delete":function(){var t,n,i,a,r,o,s;r=e.id("menu");i=r.dataset.id;if(c.cooldown[i]){return}e.off(this,"click",c["delete"]);this.textContent="Deleting...";o=(a=ot.cookie.match(/4chan_pass=([^;]+)/))?decodeURIComponent(a[1]):e.id("delPassword").value;t=e('a[title="Highlight this post"]',e.id(r.dataset.rootid)).pathname.split("/")[1];s=this;n={mode:"usrdel",onlyimgdel:/\bdelete_image\b/.test(this.className),pwd:o};n[i]="delete";return e.ajax(e.id("delform").action.replace("/"+st.BOARD+"/","/"+t+"/"),{onload:function(){return c.load(s,this.response)},onerror:function(){return c.error(s)}},{form:e.formData(n)})},load:function(t,n){var i,a,r;i=ot.implementation.createHTMLDocument("");i.documentElement.innerHTML=n;if(i.title==="4chan - Banned"){r="Banned!"}else if(a=i.getElementById("errmsg")){r=a.textContent;e.on(t,"click",c["delete"])}else{r="Deleted"}return t.textContent=r},error:function(t){t.textContent="Connection error, please retry.";return e.on(t,"click",c["delete"])},cooldown:{start:function(e){var t;t=st.BOARD==="q"?600:30;return c.cooldown.count(e.detail.postID,t,t)},count:function(e,t,n){var i;if(!(0<=t&&t<=n)){return}setTimeout(c.cooldown.count,1e3,e,t-1,n);i=c.cooldown.el;if(t===0){if(i!=null){i.textContent="Delete"}delete c.cooldown[e];delete c.cooldown.el;return}if(i!=null){i.textContent="Delete ("+t+")"}return c.cooldown[e]=t}}};u={init:function(){var t;if(e.el("a").download==null){return}t=e.el("a",{className:"download_link",textContent:"Download file"});return T.addEntry({el:t,open:function(n){var i;if(!n.img){return false}t.href=n.img.parentNode.href;i=n.fileInfo.firstElementChild;t.download=s["File Info Formatting"]?i.dataset.filename:e("span",i).title;return true}})}};h={init:function(){var t;t=e.el("a",{className:"embed_link",textContent:"Embed all in post"});e.on(t,"click",h.toggle);return T.addEntry({el:t,open:function(t){var n;if(e(".embed",n=t.blockquote)){if(e(".embedded",n)){this.el.textContent="Unembed all in post";h[t.id]=true}e.on(this.el,"click",this.toggle);return true}return false}})},toggle:function(){var n,i,a,r,o,s,l;a=e.id("menu");i=a.dataset.id;r=e.id("m"+i);l=t(".embed",r);for(o=0,s=l.length;o<s;o++){n=l[o];if(!h[i]&&n.className.contains("embedded")||h[i]&&!n.className.contains("embedded")){continue}n.click()}return h[i]=!h[i]}};T={entries:[],init:function(){this.a=e.el("a",{className:"menu_button",href:"javascript:;",innerHTML:"[<span class=dropmarker></span>]"});this.el=e.el("div",{className:"reply dialog",id:"menu",tabIndex:0});e.on(this.el,"click",function(e){return e.stopPropagation()});e.on(this.el,"keydown",this.keybinds);e.on(ot,"AddMenuEntry",function(e){return T.addEntry(e.detail)});return R.callbacks.push(this.node)},node:function(t){var n;if(t.isInlined&&!t.isCrosspost){n=e(".menu_button",t.el)}else{n=T.a.cloneNode(true);e.add(e(".postInfo",t.el),[e.tn(" "),n])}return e.on(n,"click",T.toggle)},toggle:function(t){var n,i;t.preventDefault();t.stopPropagation();if(T.el.parentNode){n=T.lastOpener;T.close();if(n===this){return}}T.lastOpener=this;i=/\bhidden_thread\b/.test(this.parentNode.className)?e.x('ancestor::div[parent::div[@class="board"]]/child::div[contains(@class,"opContainer")]',this):e.x('ancestor::div[contains(@class,"postContainer")][1]',this);return T.open(this,R.preParse(i))},open:function(t,n){var i,a,r,o,s,l,d,c,u,h;o=T.el;o.setAttribute("data-id",n.ID);o.setAttribute("data-rootid",n.root.id);l=function(t,i){var a,r,o,s,d;r=t.children;if(!t.open(n)){return}e.add(i,t.el);if(!r){return}if(o=e(".subMenu",t.el)){e.rm(o)}o=e.el("div",{className:"reply dialog subMenu"});e.add(t.el,o);for(s=0,d=r.length;s<d;s++){a=r[s];l(a,o)}};h=T.entries;for(c=0,u=h.length;c<u;c++){s=h[c];l(s,o)}T.focus(e(".entry",T.el));e.on(ot,"click",T.close);e.add(ot.body,o);d=o.getBoundingClientRect();a=t.getBoundingClientRect();r=ot.documentElement.scrollTop+ot.body.scrollTop+a.top;i=ot.documentElement.scrollLeft+ot.body.scrollLeft+a.left;o.style.top=a.top+a.height+d.height<ot.documentElement.clientHeight?r+a.height+2+"px":r-d.height-2+"px";o.style.left=a.left+d.width<ot.documentElement.clientWidth?i+"px":i+a.width-d.width+"px";return o.focus()},close:function(){var n,i,a,r,o;n=T.el;e.rm(n);o=t(".focused.entry",n);for(a=0,r=o.length;a<r;a++){i=o[a];e.rmClass(i,"focused")}n.innerHTML=null;n.removeAttribute("style");delete T.lastOpener;delete T.focusedEntry;return e.off(ot,"click",T.close)},keybinds:function(t){var n,i,a;n=T.focusedEntry;switch(C.keyCode(t)||t.keyCode){case"Esc":T.lastOpener.focus();T.close();break;case 13:case 32:n.click();break;case"Up":if(i=n.previousElementSibling){T.focus(i)}break;case"Down":if(i=n.nextElementSibling){T.focus(i)}break;case"Right":if((a=e(".subMenu",n))&&(i=a.firstElementChild)){T.focus(i)}break;case"Left":if(i=e.x('parent::*[contains(@class,"subMenu")]/parent::*',n)){T.focus(i)}break;default:return}t.preventDefault();return t.stopPropagation()},focus:function(n){var i,a,r,o;if(i=e.x('parent::*/child::*[contains(@class,"focused")]',n)){e.rmClass(i,"focused")}o=t(".focused",n);for(a=0,r=o.length;a<r;a++){i=o[a];e.rmClass(i,"focused")}T.focusedEntry=n;return e.addClass(n,"focused")},addEntry:function(t){var n;n=function(t){var i,a,r,o,s;r=t.el,a=t.children;e.addClass(r,"entry");e.on(r,"focus mouseover",function(e){e.stopPropagation();return T.focus(this)});if(!a){return}e.addClass(r,"hasSubMenu");for(o=0,s=a.length;o<s;o++){i=a[o];n(i)}};n(t);return T.entries.push(t)}};Q={init:function(){var t;if(!s["Reply Hiding"]){R.callbacks.push(this.node)}t=e.el("a",{className:"reply_hide_link",href:"javascript:;",textContent:"Hide / Restore Post"});e.on(t,"click",function(){var t,n,i,a;i=T.el;n=i.dataset.id;a=e.id("pc"+n);t=a.firstChild;J.toggle(t,a,n);return T.close()});return T.addEntry({el:t,open:function(e){if(e.isInlined||e.el.classList.contains("op")){return false}else{return true}}})},node:function(e){if(e.isInlined||e.ID===e.threadID){return}if(e.ID in st.hiddenReplies){return J.hide(e.root)}}};W={init:function(){var t;t=e.el("a",{className:"report_link",href:"javascript:;",textContent:"Report this post"});e.on(t,"click",this.report);return T.addEntry({el:t,open:function(e){return e.isArchived===false}})},report:function(){var t,n,i,a;t=e('a[title="Highlight this post"]',e.id(this.parentNode.dataset.rootid));a="//sys.4chan.org/"+t.pathname.split("/")[1]+"/imgboard.php?mode=report&no="+this.parentNode.dataset.id;n=Date.now();i="toolbar=0,scrollbars=0,location=0,status=1,menubar=0,resizable=1,width=685,height=200";return window.open(a,n,i)}};X={init:function(){var t;if(!s["Thread Hiding"]){e.ready(this.iterate)}t=e.el("a",{className:"thread_hide_link",href:"javascript:;",textContent:"Hide / Restore Thread"});e.on(t,"click",function(){var t,n;t=T.el;n=e.id("t"+t.dataset.id);$.toggle(n);return T.close()});return T.addEntry({el:t,open:function(e){if(e.el.classList.contains("op")){return true}else{return false}}})},iterate:function(){var n,i,a,r;$.hiddenThreads=e.get("hiddenThreads/"+st.BOARD+"/",{});r=t(".thread");for(i=0,a=r.length;i<a;i++){n=r[i];if(n.id.slice(1)in $.hiddenThreads){$.hide(n)}}}};m={init:function(){var t;if(this.el){return}this.el=e('link[rel="shortcut icon"]',ot.head);this.el.type="image/x-icon";t=this.el.href;this.SFW=/ws.ico$/.test(t);this["default"]=t;return this["switch"]()},"switch":function(){this.unreadDead=this.unreadSFW=this.unreadNSFW="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA";switch(s["favicon"]){case"ferongr":this.unreadDead+="BAAAAAQBAMAAADt3eJSAAAAD1BMVEWrVlbpCwJzBQD/jIzlCgLerRyUAAAAAXRSTlMAQObYZgAAAFhJREFUeF5Fi8ENw0AMw6gNZHcCXbJAkw2C7D9Tz68KJKAP+a8MKtAK9DJ9X9ZxB+WT/rbpt9L1Bq3lEapGgBqY3hvYfTagY6rLKHPa6DzTz2PothJAApsfXPUIxXEAtJ4AAAAASUVORK5CYII=";this.unreadNSFW+="BAAAAAQCAMAAAAoLQ9TAAAAFVBMVEWJq3ho/gooegBJ3ABU/QBW/wHV/8Hz/s/JAAAAAnRSTlMAscr1TiIAAABVSURBVBjTZY5LDgAxCEKNovc/8mgozq9d+CQRMPs/AC+Auz8BXlUfyGzoPZN7xNDoEVR0u2Zy3ziTsEV0oj5eTCn1KaVQGTpCHiH64wzegKZYV8M9Lia0Aj8l3NBcAAAAAElFTkSuQmCC";this.unreadSFW+="BAAAAAQCAMAAAAoLQ9TAAAAFVBMVEUAS1QAnbAAsseF5vMA2fMA1/EAb37J/JegAAAAA3RSTlMAmPz35Xr7AAAAUUlEQVQY02WOCQ4AIQgDSUr5/5Pl9NjVhE6bYBX5H5IP0MxuoAH4gKqDe9XyZFDkPlirt+bjjyae2X2cWR7VgvkPpqWSoA60g7wtMsmWTIRHFpbuAyerdnAvAAAAAElFTkSuQmCC";break;case"xat-":this.unreadDead+="BAAAAAQBAMAAADt3eJSAAAAG1BMVEXzZmTzZGLzZGLzZGIAAAD/AAD/lJX4bWz/0tMaHcyBAAAABHRSTlMAm8l+71ABtwAAAFpJREFUeF5ty9EJgDAQA9B8dIGKC1gcoQNUm+ICvRWKAwjdwLklCAXBfD2SO/yE2ftIwFkNoVgCih2XVTWCGrI1EsDUz7svH2gSoo4zxruwry/KNlfBOSAljDwk8xZR3HxWZAAAAABJRU5ErkJggg==";this.unreadNSFW+="BAAAAAQBAMAAADt3eJSAAAAIVBMVEVirGJdqF9dqF9dqF9dqF9082JmzDOq/5oAAACR/33Z/9JztnAYAAAABXRSTlMAyZ2Ses9C/CQAAABjSURBVHhebcsxDkBAFATQKbddGq1otJxij8AFJnsFqiVr8x1AuIFr8iMRhaleZv7HTyS2lRPA0FubGIDEpaPXhutBbUT2QQRA2Y/nln3R6JQDcHoc8b4rpuJBmmuvMAYIAW8utWkfv3LWVYEAAAAASUVORK5CYII=";this.unreadSFW+="BAAAAAQBAMAAADt3eJSAAAAHlBMVEUAAABde6Zde6Zde6Zde6aQz/8umMNquPcAAADQ6/+nHRY3AAAABXRSTlMAyZ16kvc074oAAABfSURBVHhebcuxCYAwFIThv0yrWNgKFo6QVnewcIFHNohlNBDfAu4rDyFYeNXHHcdPNC+jV3ASmqZIgiLXLsEagzWq66oKDHG7Y/vFbFMHeHtl6t1w9C/KOQWDc5ASNQ9glx6N+XFPbgAAAABJRU5ErkJggg==";break;case"Mayhem":this.unreadDead+="BAAAAAQBAMAAADt3eJSAAAAHlBMVEUAAAAAAAAAAAAAAAAAAAATExMBAQEAAAD/AAD///+gujywAAAACHRSTlMPJRcbLzEcM37+zgIAAAB9SURBVHheRcu9DoJAEATgcX0B+Wns7uAFRGgoCVhQ0phca8K77JXEI+6+rUujU32ZzOAXanLAFw5e91cdNEfPcVmF3+iEt8BxtOaANV51WdU2VE5FMw0O1B0YDaUOD30aZk6Bd4eT8Mfulz/OIinEeANd5yxLmwPqtqraO75dUSZT40SwmAAAAABJRU5ErkJggg==";this.unreadNSFW+="BAAAAAQBAMAAADt3eJSAAAAHlBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///9mzDPTSEsdAAAACHRSTlMaDCUeLg4zKeknoAsAAACHSURBVHheJcqxCsIwEMbxLw2CY27oLiSCYwioeyjS0Sp9Ah26d+koUtrkDXJv6xXhhj+/70B9R1T3BBN8V2urUKXV6ykdsOcSXeYPLpnXictLZAuRKqXokvzc3duGW9zBXBsbmlHBuG2KEi3PcgrPzMvA5YzHP44ieW6LiDkNNixfBYIHNOgHHmcn+8KfmKQAAAAASUVORK5CYII=";this.unreadSFW+="BAAAAAQBAMAAADt3eJSAAAAG1BMVEUAAAAAAAABAwMAAAAAAAAAAAAAAAAumMP///+/4sWwAAAAB3RSTlMVJxQdMSkcONaevAAAAIJJREFUeF4lirEKgzAURa9PcBai4PjI0NlA6y61kFXawVHq4h+8rEI0+ewmdLqHcw80SGtOw2Yg3hShiGdfLrHGLm5ug1y4Bzk6cc9kMiRTxDi3MTVVMykzjSv48VLm8yZwk6+RcFvEWzm/KEMG16P4Q51M8NYlw51Vxh8EXQ3AtuofzNIkEO8Bb0kAAAAASUVORK5CYII=";break;case"4chanJS":this.unreadDead+="BAAAAAQCAMAAAAoLQ9TAAAAD1BMVEUBAAAAAAD/AABnZ2f///8nFk05AAAAAXRSTlMAQObYZgAAAEFJREFUeNqNjgEKACAMAjvX/98cAkkxgmSgO8Bt/Ai4ApJ6KKhzF3OiEMDASrGB/QWgPEHsUpN+Ng9xAETMYhDrWmeHAMcmvycWAAAAAElFTkSuQmCC";this.unreadNSFW+="BAAAAAQCAMAAAAoLQ9TAAAAElBMVEUBAAAAAABmzDNlyjJnZ2f///+6o7dfAAAAAXRSTlMAQObYZgAAAERJREFUeF6NjkEKADEIA51o///lJZfQxUsHITogWi8AvwZJuxmYa25xDooBLEwOWFTYAsYVhdorLZt9Ng9xCUTCUCQ2H3F4ANrZ2WNiAAAAAElFTkSuQmCC";this.unreadSFW+="BAAAAAQCAMAAAAoLQ9TAAAAD1BMVEUBAAAAAAAul8NnZ2f////82iC9AAAAAXRSTlMAQObYZgAAAEFJREFUeNqNjgEKACAMAjvX/98cAkkxgmSgO8Bt/Ai4ApJ6KKhzF3OiEMDASrGB/QWgPEHsUpN+Ng9xAETMYhDrWmeHAMcmvycWAAAAAElFTkSuQmCC";break;case"Original":this.unreadDead+="BAAAAAQCAMAAAAoLQ9TAAAAD1BMVEWYmJiYmJj///8AAAD/AACKRYF4AAAAAnRSTlMAvLREMp8AAABFSURBVBjTbY7BDgAgCEIZ+P/f3MGgXHkR3wYCvENyCEq6BVVVPzFvg03sTZjT8w4GKWKL+8ih7jPffoEaKB52KJMKnrUA5kwBxesBDg0AAAAASUVORK5CYII=";this.unreadNSFW+="BAAAAAQCAMAAAAoLQ9TAAAADFBMVEWYmJj///9mzDMAAAADduU3AAAAAXRSTlMAQObYZgAAAERJREFUGNNtjkESACAIAkH+/+cOBuWUF3FnQIB3SA5BSbegquon5m2wib0Jc3rewSBFbHEfOdR95tsvUAPFww5lUsGzFpsgATH7KrmBAAAAAElFTkSuQmCC";this.unreadSFW+="BAAAAAQCAMAAAAoLQ9TAAAADFBMVEWYmJj///8umMMAAACriBKaAAAAAXRSTlMAQObYZgAAAERJREFUGNNtjkESACAIAkH+/+cOBuWUF3FnQIB3SA5BSbegquon5m2wib0Jc3rewSBFbHEfOdR95tsvUAPFww5lUsGzFpsgATH7KrmBAAAAAElFTkSuQmCC"}this.unread=this.SFW?this.unreadSFW:this.unreadNSFW},empty:"data:image/gif;base64,R0lGODlhEAAQAJEAAAAAAP///9vb2////yH5BAEAAAMALAAAAAAQABAAAAIvnI+pq+D9DBAUoFkPFnbs7lFZKIJOJJ3MyraoB14jFpOcVMpzrnF3OKlZYsMWowAAOw==",dead:"data:image/gif;base64,R0lGODlhEAAQAKECAAAAAP8AAP///////yH5BAEKAAIALAAAAAAQABAAAAIvlI+pq+D9DAgUoFkPDlbs7lFZKIJOJJ3MyraoB14jFpOcVMpzrnF3OKlZYsMWowAAOw=="};k={init:function(){q.callbacks.push(this.node);p.callbacks.push(this.node);return R.callbacks.push(this.node)},node:function(t){var n,i;if(!(i=e(".postInfo .hand",t.el))){return}n=i.textContent;if(i.nodeName==="SPAN"){i.style.cssText=k.apply.call(n)}if(!k.highlight[n]){k.highlight[n]=[]}if(n===e.get("highlightedID/"+st.BOARD+"/")){k.highlight.current.push(t);e.addClass(t.el,"highlight")}k.highlight[n].push(t);return e.on(i,"click",function(){return k.idClick(n)})},ids:{},compute:function(e){var t,n;t=this.hash(e);n=[t>>24&255,t>>16&255,t>>8&255];n[3]=n[0]*.299+n[1]*.587+n[2]*.114>125;this.ids[e]=n;return n},apply:function(){var e;e=k.ids[this]||k.compute(this);return"background-color: rgb("+e[0]+","+e[1]+","+e[2]+"); color: "+(e[3]?"black;":"white;")},hash:function(e){var t,n,i;i=0;t=0;n=e.length;while(t<n){i=(i<<5)-i+e.charCodeAt(t);++t}return i},highlight:{current:[]},idClick:function(t){var n,i,a,r,o,s,l,d,c;d=this.highlight.current;for(r=0,s=d.length;r<s;r++){i=d[r];e.rmClass(i.el,"highlight")}n=e.get(a="highlightedID/"+st.BOARD+"/",false);if(t===n){this.highlight.current=[];return e["delete"](a)}c=this.highlight[t];for(o=0,l=c.length;o<l;o++){i=c[o];if(i.isInlined){continue}e.addClass(i.el,"highlight");this.highlight.current.push(i)}return e.set(a,t)}};S={init:function(){R.callbacks.push(this.node);return this.posts=e.get("ownedPosts",{})},node:function(t){var n,i,a,r,o,s;i=S.posts;s=t.quotes;for(r=0,o=s.length;r<o;r++){a=s[r];if(!(a.hash&&i[a.hash.slice(2)])){continue}n=true;e.addClass(a,"ownreply");a.textContent+=" (You)"}if(n){e.addClass(t.el,"quotedYou")}}};j={init:function(){if(s["Indicate Spoilers"]){this.wrapper=function(e){return"[spoiler]"+e+"[/spoiler]"}}return R.callbacks.push(this.node)},wrapper:function(e){return e},node:function(n){var i,a,r,o;a=t("s",n.el);for(r=0,o=a.length;r<o;r++){i=a[r];e.replace(i,e.tn(j.wrapper(i.textContent)))}}};Z={init:function(){var t,n,i;Z.postcount=e.el("span",{id:"postcount",textContent:"0"});Z.imagecount=e.el("span",{id:"imagecount",textContent:"0"});if(s["Thread Updater"]&&s["Merged Updater and Stats"]&&(i=at.count.parentElement)){t=e.el("span");e.add(t,[e.tn("["),Z.postcount,e.tn(" / "),Z.imagecount,e.tn("] ")]);e.prepend(i,t)}else{n=nt.dialog("stats","bottom: 0; left: 0;","<div class=move></div>");n.className="dialog";e.add(e(".move",n),Z.postcount);e.add(e(".move",n),e.tn(" / "));e.add(e(".move",n),Z.imagecount);e.add(ot.body,n)}this.posts=this.images=0;this.imgLimit=function(){switch(st.BOARD){case"a":case"b":case"v":case"co":case"mlp":return 251;case"vg":return 376;default:return 151}}();return R.callbacks.push(this.node)},node:function(t){if(t.isInlined){return}Z.postcount.textContent=++Z.posts;if(!t.img){return}Z.imagecount.textContent=++Z.images;if(Z.images>Z.imgLimit){return e.addClass(Z.imagecount,"warning")}}};tt={init:function(){return ot.title=A.title()}};it={init:function(){this.title=ot.title;e.on(ot,"QRPostSuccessful",this.post);this.update();e.on(window,"scroll",it.scroll);e.on(window,"focus",it.focus);return R.callbacks.push(this.node)},replies:[],foresee:[],post:function(e){return it.foresee.push(e.detail.postID)},node:function(e){var t,n,i,a;if((i=it.foresee.indexOf(e.ID))!==-1){it.foresee.splice(i,1);return}n=e.el,a=e.root;if(n.hidden||/\bop\b/.test(e["class"])||e.isInlined){return}t=it.replies.push(n);return it.update(t===1)},focus:function(){if(it.replies!==0){return it.count()}},scroll:function(){if(!(e.hidden()||it.replies===0)){return it.count()}},count:function(){var e,t,n,i,a,r,o;t=ot.documentElement.clientHeight;o=it.replies;for(n=a=0,r=o.length;a<r;n=++a){i=o[n];e=i.getBoundingClientRect().bottom;if(e>t){break}}if(n===0){return}it.replies=it.replies.slice(n);return it.update(it.replies.length===0)},setTitle:function(e){if(this.scheduled){clearTimeout(this.scheduled);delete it.scheduled;this.setTitle(e);return}return this.scheduled=setTimeout(function(){return ot.title="("+e+") "+it.title},5)},update:function(t){var n;if(!st.REPLY){return}n=this.replies.length;if(s["Unread Count"]){this.setTitle(n)}if(!(s["Unread Favicon"]&&t)){return}if(e.engine==="presto"){e.rm(m.el)}m.el.href=st.dead?n?m.unreadDead:m.dead:n?m.unread:m["default"];if(st.dead){e.addClass(m.el,"dead")}else{e.rmClass(m.el,"dead")}if(n){e.addClass(m.el,"unread")}else{e.rmClass(m.el,"unread")}if(e.engine!=="webkit"){return e.add(ot.head,m.el)}}};at={init:function(){var n,i,a,r,o,d,c,u,h,p;r="<div class=move><span id=count></span> <span id=timer></span></div>";n=l.updater.checkbox;for(d in n){c=n[d][1];i=s[d]?"checked":"";r+="<div><label title='"+c+"'>"+d+"<input name='"+d+"' type=checkbox "+i+"></label></div>"}i=s["Auto Update"]?"checked":"";r+="      <div><label title='Controls whether *this* thread automatically updates or not'>Auto Update This<input name='Auto Update This' type=checkbox "+i+"></label></div>      <div><label>Interval (s)<input type=number name=Interval"+(s["Interval per board"]?"_"+st.BOARD:"")+" class=field min=1></label></div>      <div><label>BGInterval<input type=number name=BGInterval"+(s["Interval per board"]?"_"+st.BOARD:"")+" class=field min=1></label></div>      <div><input value='Update Now' type=button name='Update Now'></div>";a=nt.dialog("updater","bottom: 0; right: 0;",r);this.count=e("#count",a);this.timer=e("#timer",a);this.thread=e.id("t"+st.THREAD_ID);this.save=[];this.checkPostCount=0;this.unsuccessfulFetchCount=0;this.lastModified="0";p=t("input",a);for(u=0,h=p.length;u<h;u++){o=p[u];if(o.type==="checkbox"){e.on(o,"click",e.cb.checked)}switch(o.name){case"Scroll BG":e.on(o,"click",this.cb.scrollBG);this.cb.scrollBG.call(o);break;case"Verbose":e.on(o,"click",this.cb.verbose);this.cb.verbose.call(o);break;case"Auto Update This":e.on(o,"click",this.cb.autoUpdate);this.cb.autoUpdate.call(o);break;case"Interval":case"BGInterval":case"Interval_"+st.BOARD:case"BGInterval_"+st.BOARD:o.value=s[o.name];e.on(o,"change",this.cb.interval);this.cb.interval.call(o);break;case"Update Now":e.on(o,"click",this.update)}}e.add(ot.body,a);e.on(ot,"QRPostSuccessful",this.cb.post);return e.on(ot,"visibilitychange ovisibilitychange mozvisibilitychange webkitvisibilitychange",this.cb.visibility)},audio:e.el("audio",{src:"data:audio/wav;base64,UklGRjQDAABXQVZFZm10IBAAAAABAAEAgD4AAIA+AAABAAgAc21wbDwAAABBAAADAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABkYXRhzAIAAGMms8em0tleMV4zIpLVo8nhfSlcPR102Ki+5JspVEkdVtKzs+K1NEhUIT7DwKrcy0g6WygsrM2k1NpiLl0zIY/WpMrjgCdbPhxw2Kq+5Z4qUkkdU9K1s+K5NkVTITzBwqnczko3WikrqM+l1NxlLF0zIIvXpsnjgydZPhxs2ay95aIrUEkdUdC3suK8N0NUIjq+xKrcz002WioppdGm091pK1w0IIjYp8jkhydXPxxq2K295aUrTkoeTs65suK+OUFUIzi7xqrb0VA0WSoootKm0t5tKlo1H4TYqMfkiydWQBxm16+85actTEseS8y7seHAPD9TIza5yKra01QyWSson9On0d5wKVk2H4DYqcfkjidUQB1j1rG75KsvSkseScu8seDCPz1TJDW2yara1FYxWSwnm9Sn0N9zKVg2H33ZqsXkkihSQR1g1bK65K0wSEsfR8i+seDEQTxUJTOzy6rY1VowWC0mmNWoz993KVc3H3rYq8TklSlRQh1d1LS647AyR0wgRMbAsN/GRDpTJTKwzKrX1l4vVy4lldWpzt97KVY4IXbUr8LZljVPRCxhw7W3z6ZISkw1VK+4sMWvXEhSPk6buay9sm5JVkZNiLWqtrJ+TldNTnquqbCwilZXU1BwpKirrpNgWFhTaZmnpquZbFlbVmWOpaOonHZcXlljhaGhpZ1+YWBdYn2cn6GdhmdhYGN3lp2enIttY2Jjco+bnJuOdGZlZXCImJqakHpoZ2Zug5WYmZJ/bGlobX6RlpeSg3BqaW16jZSVkoZ0bGtteImSk5KIeG5tbnaFkJKRinxxbm91gY2QkIt/c3BwdH6Kj4+LgnZxcXR8iI2OjIR5c3J0e4WLjYuFe3VzdHmCioyLhn52dHR5gIiKioeAeHV1eH+GiYqHgXp2dnh9hIiJh4J8eHd4fIKHiIeDfXl4eHyBhoeHhH96eHmA"}),cb:{post:function(){if(!s["Auto Update This"]){return
}at.unsuccessfulFetchCount=0;return setTimeout(at.update,500)},checkpost:function(e){if(!(e===404||at.foundPost||at.checkPostCount>=10)){return setTimeout(at.update,++at.checkPostCount*500)}at.checkPostCount=0;delete at.foundPost;return delete at.postID},visibility:function(){if(e.hidden()){return}at.unsuccessfulFetchCount=0;if(at.timer.textContent<(s["Interval per board"]?-s["Interval_"+st.BOARD]:-s["Interval"])){return at.set("timer",-at.getInterval())}},interval:function(){var t;t=parseInt(this.value,10);this.value=t>0?t:30;e.cb.value.call(this);return at.set("timer",-at.getInterval())},verbose:function(){if(s["Verbose"]){at.set("count","+0");return at.timer.hidden=false}else{at.set("count","+0");at.count.className="";return at.timer.hidden=true}},autoUpdate:function(){if(s["Auto Update This"]=this.checked){return at.timeoutID=setTimeout(at.timeout,1e3)}else{return clearTimeout(at.timeoutID)}},scrollBG:function(){return at.scrollBG=this.checked?function(){return true}:function(){return!e.hidden()}},load:function(){switch(this.status){case 404:at.set("timer","");at.set("count",404);at.count.className="warning";clearTimeout(at.timeoutID);st.dead=true;if(s["Unread Count"]){it.title=it.title.match(/^.+-/)[0]+" 404"}else{ot.title=ot.title.match(/^.+-/)[0]+" 404"}it.update(true);F.abort();break;case 0:case 304:at.unsuccessfulFetchCount++;at.set("timer",-at.getInterval());if(s["Verbose"]){at.set("count","+0");at.count.className=null}break;case 200:at.lastModified=this.getResponseHeader("Last-Modified");at.cb.update(JSON.parse(this.response).posts);at.set("timer",-at.getInterval());break;default:at.unsuccessfulFetchCount++;at.set("timer",-at.getInterval());if(s["Verbose"]){at.set("count",this.statusText);at.count.className="warning"}}if(at.postID){at.cb.checkpost(this.status)}return delete at.request},update:function(t){var n,i,a,o,l,d,c,u,h,p,f,g;if(h=t[0].custom_spoiler){r.spoilerRange[st.BOARD]=h}o=at.thread.lastElementChild;a=+o.id.slice(2);d=function(){var e,n,i,o;i=t.reverse();o=[];for(e=0,n=i.length;e<n;e++){c=i[e];if(c.no<=a){break}if(at.postID){if(""+c.no===at.postID){at.foundPost=true}}o.push(r.postFromObject(c,st.BOARD))}return o}();n=d.length;if(s["Verbose"]){at.set("count","+"+n);at.count.className=n?"new":null}if(n){if(s["Beep"]&&e.hidden()&&it.replies.length===0){at.audio.play()}at.unsuccessfulFetchCount=0}else{at.unsuccessfulFetchCount++;return}u=s["Scrolling"]&&at.scrollBG()&&o.getBoundingClientRect().bottom-ot.documentElement.clientHeight<25;g=d.reverse();for(p=0,f=g.length;p<f;p++){l=g[p];i=e.frag();e.add(i,l);R.node(R.preParse(l));e.add(at.thread,i)}if(u&&d!=null){return d[0].scrollIntoView()}}},set:function(e,t){var n,i;n=at[e];if(i=n.firstChild){return i.data=t}else{return n.textContent=t}},getInput:function(e){var t,n,i,a,r;while((t=e.length)<10){e[t]=e[t-1]}r=[];for(i=0,a=e.length;i<a;i++){n=e[i];r.push(parseInt(n,10))}return r},getInterval:function(){var t,n,i,a,r,o;o="Interval"+(s["Interval per board"]?"_"+st.BOARD:"");a="updateIncrease";if(e.hidden()){o="BG"+o;a+="B"}n=+s[o];r=(t=this.unsuccessfulFetchCount)>9?9:t;return s["Optional Increase"]?n>(i=at.getInput(s[a].split(","))[r])?n:i:n},timeout:function(){var e;at.timeoutID=setTimeout(at.timeout,1e3);e=1+parseInt(at.timer.firstChild.data,10);if(e===0){return at.update()}else if(e>=at.getInterval()){at.unsuccessfulFetchCount++;at.set("count","Retry");at.count.className=null;return at.update()}else{return at.set("timer",e)}},update:function(){var t,n;at.set("timer",0);t=at.request;if(t){t.onloadend=null;t.abort()}n="//api.4chan.org/"+st.BOARD+"/res/"+st.THREAD_ID+".json";return at.request=e.ajax(n,{onloadend:at.cb.load},{headers:{"If-Modified-Since":at.lastModified}})}};rt={init:function(){var n,i,a,r,o,s;i="<div class=move>Thread Watcher</div>";this.dialog=nt.dialog("watcher","top: 50px; left: 0px;",i);e.add(ot.body,this.dialog);s=t(".op input");for(r=0,o=s.length;r<o;r++){a=s[r];n=e.el("img",{className:"favicon"});e.on(n,"click",this.cb.toggle);e.before(a,n)}if(st.THREAD_ID===e.get("autoWatch",0)){this.watch(st.THREAD_ID);e["delete"]("autoWatch")}else{this.refresh()}e.on(ot,"QRPostSuccessful",this.cb.post);return e.sync("watched",this.refresh)},refresh:function(n){var i,a,r,o,s,l,d,c,u,h,p,f,g,b,v,A;n||(n=e.get("watched",{}));l=[];for(i in n){b=n[i];for(o in b){d=b[o];u=e.el("a",{textContent:"×",href:"javascript:;"});e.on(u,"click",rt.cb.x);s=e.el("a",d);s.title=s.textContent;a=e.el("div");e.add(a,[u,e.tn(" "),s]);l.push(a)}}v=t("div:not(.move)",rt.dialog);for(h=0,f=v.length;h<f;h++){a=v[h];e.rm(a)}e.add(rt.dialog,l);c=n[st.BOARD]||{};A=t(".favicon");for(p=0,g=A.length;p<g;p++){r=A[p];o=r.nextSibling.name;if(o in c){r.src=m["default"]}else{r.src=m.empty}}},cb:{toggle:function(){return rt.toggle(this.parentNode)},x:function(){var e;e=this.nextElementSibling.pathname.split("/");return rt.unwatch(e[3],e[1])},post:function(t){var n,i,a;a=t.detail,n=a.postID,i=a.threadID;if(i==="0"){if(s["Auto Watch"]){return e.set("autoWatch",n)}}else if(s["Auto Watch Reply"]){return rt.watch(i)}}},toggle:function(t){var n;n=e(".favicon + input",t).name;return rt.watch(n)||rt.unwatch(n,st.BOARD)},unwatch:function(t,n){var i;i=e.get("watched",{});delete i[n][t];e.set("watched",i);return rt.refresh()},watch:function(t){var n,i,a;n=e.id("t"+t);if(e(".favicon",n).src===m["default"]){return false}i=e.get("watched",{});i[a=st.BOARD]||(i[a]={});i[st.BOARD][t]={href:"/"+st.BOARD+"/res/"+t,textContent:A.title(n)};e.set("watched",i);rt.refresh();return true}};I={format:function(e){var t,n,i;i={bi:/(\*\*\*|___)(?=\S)([^\r\n]*?\S)\1/g,b:/(\*\*|__)(?=\S)([^\r\n]*?\S)\1/g,i:/(\*|_)(?=\S)([^\r\n]*?\S)\1/g,code:/(`)(?=\S)([^\r\n]*?\S)\1/g,ds:/(\|\||__)(?=\S)([^\r\n]*?\S)\1/g};for(n in i){t=i[n];e=e?e.replace(t,I.unicode_convert):" "}return e},unicode_convert:function(e,t,n){var i,a,r,o,s,l,d,c;l=function(){switch(t){case"_":case"*":return"i";case"__":case"**":return"b";case"___":case"***":return"bi";case"||":return"ds";case"`":case"```":return"code"}}();o={b:[120782,119808,119834],i:[120822,119860,119886],bi:[120782,119912,119938],code:[120822,120432,120458],ds:[120792,120120,120146]};r=function(){var e,t,a;a=[];for(d=e=0,t=n.length;e<t;d=++e){i=n[d];a.push(n.charCodeAt(d))}return a}();s=function(){var e,n,i;i=[];for(e=0,n=r.length;e<n;e++){a=r[e];if(a>=48&&a<=57){i.push(a-48+o[l][0])}else if(a>=65&&a<=90){i.push(a-65+o[l][1])}else if(a>=97&&a<=122){if(a===104&&t==="i"){i.push(8462)}else{i.push(a-97+o[l][2])}}else{i.push(a)}}return i}();c=s.map(I.ucs2_encode).join("");if(t==="code"){c=c.replace(/\x20/g," ")}return c},ucs2_encode:function(e){var t;t="";if(e>65535){e-=65536;t+=String.fromCharCode(e>>>10&1023|55296);e=56320|e&1023}return t+=String.fromCharCode(e)}};F={init:function(){if(!e.id("postForm")){return}P.callbacks.push(this.node);R.callbacks.push(this.node);return setTimeout(this.asyncInit)},asyncInit:function(){var t,n;if(s["Hide Original Post Form"]){t=e.el("h1",{innerHTML:"<a href=javascript:;>"+(n=st.REPLY?"Reply to Thread":"Start a Thread")+"</a>",title:n});e.on(t.firstChild,"click",function(){F.open();if(!st.REPLY){F.threadSelector.value=st.BOARD==="f"?"9999":"new"}return e("textarea",F.el).focus()});e.before(e.id("postForm"),t);if(s["Check for Bans"]){a.init()}}if(s["Persistent QR"]){F.dialog();if(s["Auto Hide QR"]){F.hide()}}e.on(ot,"dragover",F.dragOver);e.on(ot,"drop",F.dropFile);return e.on(ot,"dragstart dragend",F.drag)},node:function(t){return e.on(e('a[title="Quote this post"]',e(".postInfo",t.el)),"click",F.quote)},open:function(){if(F.el){F.el.hidden=false;return F.unhide()}else{return F.dialog()}},close:function(){var t,n,i,a,r;F.el.hidden=true;F.abort();ot.activeElement.blur();e.rmClass(F.el,"dump");r=F.replies;for(i=0,a=r.length;i<a;i++){t=r[i];F.replies[0].rm()}F.cooldown.auto=false;F.status();F.resetFileInput();if(!s["Remember Spoiler"]&&(n=e.id("spoiler")).checked){n.click()}return F.cleanError()},hide:function(){ot.activeElement.blur();e.addClass(F.el,"autohide");return F.autohide.checked=true},unhide:function(){e.rmClass(F.el,"autohide");return F.autohide.checked=false},toggleHide:function(){return this.checked&&F.hide()||F.unhide()},error:function(t){if(typeof t==="string"){F.warning.textContent=t}else{F.warning.innerHTML=null;e.add(F.warning,t)}F.open();if(F.captcha.isEnabled&&/captcha|verification/i.test(F.warning.textContent)){e("[autocomplete]",F.el).focus()}if(e.hidden()){return alert(F.warning.textContent)}},cleanError:function(){return F.warning.textContent=null},status:function(e){var t,n,i;if(e==null){e={}}if(!F.el){return}if(st.dead){i=404;t=true;F.cooldown.auto=false}i=e.progress||F.cooldown.seconds||i;n=F.status.input;n.value=F.cooldown.auto&&s["Cooldown"]?i?"Auto "+i:"Auto":i||"Submit";return n.disabled=t||false},cooldown:{init:function(){if(!s["Cooldown"]){return}F.cooldown.types={thread:function(){switch(st.BOARD){case"q":return 86400;case"b":case"soc":case"r9k":return 600;default:return 300}}(),sage:60,file:st.BOARD==="q"?300:30,post:st.BOARD==="q"?60:30};F.cooldown.cooldowns=e.get(""+st.BOARD+".cooldown",{});F.cooldown.start();return e.sync(""+st.BOARD+".cooldown",F.cooldown.sync)},start:function(){if(F.cooldown.isCounting){return}F.cooldown.isCounting=true;return F.cooldown.count()},sync:function(e){var t;for(t in e){F.cooldown.cooldowns[t]=e[t]}return F.cooldown.start()},set:function(t){var n,i,a,r,o,l;if(!s["Cooldown"]){return}o=Date.now();if(t.delay){n={delay:t.delay}}else{r=/sage/i.test(t.post.email);i=!!t.post.file;a=t.isReply;l=!a?"thread":r?"sage":i?"file":"post";n={isReply:a,isSage:r,hasFile:i,timeout:o+F.cooldown.types[l]*e.SECOND}}F.cooldown.cooldowns[o]=n;e.set(""+st.BOARD+".cooldown",F.cooldown.cooldowns);return F.cooldown.start()},unset:function(t){delete F.cooldown.cooldowns[t];return e.set(""+st.BOARD+".cooldown",F.cooldown.cooldowns)},count:function(){var t,n,i,a,r,o,s,l,d,c,u,h,p,f;if(Object.keys(F.cooldown.cooldowns).length){setTimeout(F.cooldown.count,1e3)}else{e["delete"](""+st.BOARD+".cooldown");delete F.cooldown.isCounting;delete F.cooldown.seconds;F.status();return}if(r=st.REPLY?true:F.threadSelector.value!=="new"){l=F.replies[0];o=/sage/i.test(l.email);a=!!l.file}s=Date.now();d=null;f=F.cooldown,h=f.types,n=f.cooldowns;for(c in n){t=n[c];if("delay"in t){if(t.delay){d=Math.max(d,t.delay--)}else{d=Math.max(d,0);F.cooldown.unset(c)}continue}if(r===t.isReply){u=!r?"thread":o&&t.isSage?"sage":a&&t.hasFile?"file":"post";i=Math.floor((s-c)/1e3);if(i>=0){d=Math.max(d,h[u]-i)}}if(!(c<=s&&s<=t.timeout)){F.cooldown.unset(c)}}p=d!==null||!!F.cooldown.seconds;F.cooldown.seconds=d;if(p){F.status()}if(d===0&&F.cooldown.auto){return F.submit()}}},quote:function(t){var n,i,a,r,o,s,l,d;if(t!=null){t.preventDefault()}F.open();if(!st.REPLY){F.threadSelector.value=e.x('ancestor::div[parent::div[@class="board"]]',this).id.slice(1)}i=this.previousSibling.hash.slice(2);l=">>"+i+"\n";o=ot.getSelection();if((r=o.toString().trim())&&i===((d=e.x("ancestor-or-self::blockquote",o.anchorNode))!=null?d.id.match(/\d+$/)[0]:void 0)){r=r.replace(/\n/g,"\n>");l+=">"+r+"\n"}s=e("textarea",F.el);n=s.selectionStart;s.value=s.value.slice(0,n)+l+s.value.slice(s.selectionEnd);a=n+l.length;s.setSelectionRange(a,a);s.focus();return e.event(s,new Event("input"))},characterCount:function(){var t,n;n=F.charaCounter;t=this.textLength;n.textContent=t;n.hidden=t<1e3;return(t>1500?e.addClass:e.rmClass)(n,"warning")},drag:function(t){var n;n=t.type==="dragstart"?e.off:e.on;n(ot,"dragover",F.dragOver);return n(ot,"drop",F.dropFile)},dragOver:function(e){e.preventDefault();return e.dataTransfer.dropEffect="copy"},dropFile:function(t){if(!t.dataTransfer.files.length){return}t.preventDefault();F.open();F.fileInput.call(t.dataTransfer);return e.addClass(F.el,"dump")},fileInput:function(){var t,n,i,a;F.cleanError();if(this.files.length===1){t=this.files[0];if(t.size>this.max){F.error("File too large.");F.resetFileInput()}else if(!F.mimeTypes.contains(t.type)){F.error("Unsupported file type.");F.resetFileInput()}else{F.selected.setFile(t)}return}a=this.files;for(n=0,i=a.length;n<i;n++){t=a[n];if(t.size>this.max){F.error("File "+t.name+" is too large.");break}else if(!F.mimeTypes.contains(t.type)){F.error(""+t.name+": Unsupported file type.");break}if(!F.replies[F.replies.length-1].file){F.replies[F.replies.length-1].setFile(t)}else{(new F.reply).setFile(t)}}e.addClass(F.el,"dump");return F.resetFileInput()},resetFileInput:function(){return F.fileEl.value=null},replies:[],reply:function(){function t(){var t,n,i,a=this;i=F.replies[F.replies.length-1];n=e.get("persona",{global:{}});if(!n[t=s["Per Board Persona"]?st.BOARD:"global"]){n[t]=JSON.parse(JSON.stringify(n.global))}this.name=i?i.name:n[t].name||null;this.email=i&&(s["Remember Sage"]||!/^sage$/.test(i.email))?i.email:n[t].email||null;this.sub=i&&s["Remember Subject"]?i.sub:s["Remember Subject"]?n[t].sub:null;this.spoiler=i&&s["Remember Spoiler"]?i.spoiler:false;this.com=null;this.el=e.el("a",{className:"thumbnail",draggable:true,href:"javascript:;",innerHTML:"<a class=remove>×</a><label hidden><input type=checkbox> Spoiler</label><span></span>"});e("input",this.el).checked=this.spoiler;e.on(this.el,"click",function(){return a.select()});e.on(e(".remove",this.el),"click",function(e){e.stopPropagation();return a.rm()});e.on(e("label",this.el),"click",function(e){return e.stopPropagation()});e.on(e("input",this.el),"change",function(t){a.spoiler=t.target.checked;if(a.el.id==="selected"){return e.id("spoiler").checked=a.spoiler}});e.before(e("#addReply",F.el),this.el);e.on(this.el,"dragstart",this.dragStart);e.on(this.el,"dragenter",this.dragEnter);e.on(this.el,"dragleave",this.dragLeave);e.on(this.el,"dragover",this.dragOver);e.on(this.el,"dragend",this.dragEnd);e.on(this.el,"drop",this.drop);F.replies.push(this)}t.prototype.setFile=function(t){var n,i,a,r=this;this.file=t;this.el.title=""+t.name+" ("+e.bytesToString(t.size)+")";if(F.spoiler){e("label",this.el).hidden=false}if(!/^image/.test(t.type)){this.el.style.backgroundImage=null;return}if(!(a=window.URL||window.webkitURL)){return}a.revokeObjectURL(this.url);n=a.createObjectURL(t);i=e.el("img");e.on(i,"load",function(){var t,o,s,l,d,c,u;d=90*3;if(i.height<d||i.width<d){r.url=n;r.el.style.backgroundImage="url("+r.url+")";return}if(i.height<=i.width){i.width=d/i.height*i.width;i.height=d}else{i.height=d/i.width*i.height;i.width=d}t=e.el("canvas",{height:i.height,width:i.width});t.getContext("2d").drawImage(i,0,0,i.width,i.height);o=atob(t.toDataURL().split(",")[1]);l=o.length;c=new Uint8Array(l);for(s=u=0;0<=l?u<l:u>l;s=0<=l?++u:--u){c[s]=o.charCodeAt(s)}r.url=a.createObjectURL(new Blob([c],{type:"image/png"}));r.el.style.backgroundImage="url("+r.url+")";return typeof a.revokeObjectURL==="function"?a.revokeObjectURL(n):void 0});return i.src=n};t.prototype.rmFile=function(){var t;F.resetFileInput();delete this.file;this.el.title=null;this.el.style.backgroundImage=null;if(F.spoiler){e("label",this.el).hidden=true}return typeof(t=window.URL||window.webkitURL).revokeObjectURL==="function"?t.revokeObjectURL(this.url):void 0};t.prototype.select=function(){var t,n,i,a,r,o,l,d,c;if(F.selected===this){return}if((d=F.selected)!=null){d.el.removeAttribute("id")}F.selected=this;this.el.id="selected";a=this.el.getBoundingClientRect();r=this.el.parentNode.getBoundingClientRect();this.el.parentNode.scrollLeft+=a.left+a.width/2-r.left-r.width/2;c=["name","email","sub","com"];for(o=0,l=c.length;o<l;o++){n=c[o];i=e("[name="+n+"]",F.el);i.value=this[n];if(s["Tripcode Hider"]){if(n==="name"){t=/^.*##?.+/.test(this[n]);if(t){e.addClass(i,"tripped")}e.on(i,"blur",function(){t=/^.*##?.+/.test(this.value);if(t&&!this.className.match("\\btripped\\b")){return e.addClass(this,"tripped")}else if(!t&&this.className.match("\\btripped\\b")){return e.rmClass(this,"tripped")}})}}}F.characterCount.call(e("textarea",F.el));return e("#spoiler",F.el).checked=this.spoiler};t.prototype.dragStart=function(){return e.addClass(this,"drag")};t.prototype.dragEnter=function(){return e.addClass(this,"over")};t.prototype.dragLeave=function(){return e.rmClass(this,"over")};t.prototype.dragOver=function(e){e.preventDefault();return e.dataTransfer.dropEffect="move"};t.prototype.drop=function(){var t,n,i,a,r;t=e(".drag",this.parentNode);n=function(e){return ct.call(e.parentNode.children).indexOf(e)};a=n(t);i=n(this);if(a<i){e.after(this,t)}else{e.before(this,t)}r=F.replies.splice(a,1)[0];return F.replies.splice(i,0,r)};t.prototype.dragEnd=function(){var t;e.rmClass(this,"drag");if(t=e(".over",this.parentNode)){return e.rmClass(t,"over")}};t.prototype.rm=function(){var t,n;F.resetFileInput();e.rm(this.el);t=F.replies.indexOf(this);if(F.replies.length===1){(new F.reply).select();e.rmClass(F.el,"dump")}else if(this.el.id==="selected"){(F.replies[t-1]||F.replies[t+1]).select()}F.replies.splice(t,1);return typeof(n=window.URL||window.webkitURL).revokeObjectURL==="function"?n.revokeObjectURL(this.url):void 0};return t}(),captcha:{init:function(){var t,n,i=this;if(ot.cookie.contains("pass_enabled=")||!(this.isEnabled=!!e.id("captchaFormPart"))){return}if(e.id("recaptcha_challenge_field_holder")){return this.ready()}else{if(N){t=new N(n=function(){if(e.id("recaptcha_challenge_field_holder")){i.ready();return t.disconnect()}});return t.observe(e.id("recaptcha_widget_div"),{childList:true,subtree:true})}else{return e.on(e.id("recaptcha_widget_div"),"DOMNodeInserted",this.ready)}}},ready:function(){var t,n=this;if(this.challenge=e.id("recaptcha_challenge_field_holder")){e.off(e.id("recaptcha_widget_div"),"DOMNodeInserted",this.onready);delete this.onready}else{return}e.addClass(F.el,"captcha");e.after(e(".textarea",F.el),e.el("div",{className:"captchaimg",title:"Reload",innerHTML:"<img>"}));e.after(e(".captchaimg",F.el),e.el("div",{className:"captchainput",innerHTML:"<input title=Verification class=field autocomplete=off size=1>"}));this.img=e(".captchaimg > img",F.el);this.input=e(".captchainput > input",F.el);e.on(this.img.parentNode,"click",this.reload);e.on(this.input,"keydown",this.keydown);e.on(this.input,"focus",function(){return F.el.classList.add("focus")});e.on(this.input,"blur",function(){return F.el.classList.remove("focus")});if(N){t=new N(function(){return n.load()});t.observe(this.challenge,{childList:true,subtree:true})}else{e.on(this.challenge,"DOMNodeInserted",function(){return n.load()})}e.sync("captchas",function(e){return n.count(e.length)});this.count(e.get("captchas",[]).length);return this.reload()},save:function(){var t,n,i;if(!(i=this.input.value)){return}n=e.get("captchas",[]);while((t=n[0])&&t.time<Date.now()){n.shift()}n.push({challenge:this.challenge.firstChild.value,response:i,time:this.timeout});e.set("captchas",n);this.count(n.length);return this.reload()},load:function(){var t;this.timeout=Date.now()+4*e.MINUTE;t=this.challenge.firstChild.value;this.img.alt=t;this.img.src="//www.google.com/recaptcha/api/image?c="+t;return this.input.value=null},count:function(e){this.input.placeholder=function(){switch(e){case 0:return"Verification (Shift + Enter to cache)";case 1:return"Verification (1 cached captcha)";default:return"Verification ("+e+" cached captchas)"}}();return this.input.alt=e},reload:function(t){e.globalEval('Recaptcha.reload("t")');if(t){return F.captcha.input.focus()}},keydown:function(e){var t;t=F.captcha;if(e.keyCode===8&&!t.input.value){t.reload()}else if(e.keyCode===13&&e.shiftKey){t.save()}else{return}return e.preventDefault()}},dialog:function(){var n,i,a,r,o,l,d,c,u,h,p,f,g,m,b;F.el=nt.dialog("qr","bottom: 0; right: 0;",'<div id=qrtab class=move>  <label><input type=checkbox id=autohide title=Auto-hide> Quick Reply</label>  <span> <a class=close title=Close>×</a> </span>  <div id=threadselect></div></div><form>  <div class=userInfo><input id=dump type=button title="Dump list" value=+ class=field><input name=name title=Name placeholder=Name class=field><input name=email title=E-mail placeholder=E-mail class=field><input name=sub title=Subject placeholder=Subject class=field></div>  <div id=replies><div><span id=addReply href=javascript:; title="Add a reply">+</a></div></div>  <div class=textarea><textarea name=com title=Comment placeholder=Comment class=field></textarea><span id=charCount></span><div style=clear:both></div></div>  <input type=file multiple size=16><input type=submit>  <label id=spoilerLabel><input type=checkbox id=spoiler> Spoiler Image?</label>  <div class=warning></div></form>');if(s["Remember QR size"]){e.on(d=e("textarea",F.el),"mouseup",function(){return e.set("QR.size",this.style.cssText)});d.style.cssText=e.get("QR.size","")}F.autohide=e("#autohide",F.el);a=e("ul.rules").firstElementChild.textContent.trim().match(/: (.+)/)[1].toLowerCase().replace(/\w+/g,function(e){switch(e){case"jpg":return"image/jpeg";case"pdf":return"application/pdf";case"swf":return"application/x-shockwave-flash";default:return"image/"+e}});F.mimeTypes=a.split(", ");F.mimeTypes.push("");F.fileEl=e("input[type=file]",F.el);F.fileEl.max=e("input[name=MAX_FILE_SIZE]").value;if(e.engine!=="presto"){F.fileEl.accept=a}F.warning=e(".warning",F.el);F.spoiler=!!e("input[name=spoiler]");l=e("#spoilerLabel",F.el);l.hidden=!F.spoiler;F.charaCounter=e("#charCount",F.el);d=e("textarea",F.el);if(!st.REPLY){u="<option value=new>New thread</option>";m=t(".thread");for(h=0,f=m.length;h<f;h++){c=m[h];i=c.id.slice(1);u+="<option value="+i+">Thread "+i+"</option>"}F.threadSelector=st.BOARD==="f"?e("select[name=filetag]").cloneNode(true):e.el("select",{innerHTML:u,title:"Create a new thread / Reply to a thread"});F.threadSelector.className=null;e.prepend(e("#threadselect",F.el),F.threadSelector);e.on(F.threadSelector,"mousedown",function(e){return e.stopPropagation()})}n=0;o=F.fileEl.max;while(n++<2){o/=1024}e.on(F.fileEl,"change",e.on(F.fileEl,"change",F.fileInput));e.on(F.fileEl,"click",function(e){if(e.shiftKey){return F.selected.rmFile()||e.preventDefault()}});e.on(F.autohide,"change",F.toggleHide);e.on(e(".close",F.el),"click",F.close);e.on(e("#dump",F.el),"click",function(){return e.toggleClass(F.el,"dump")});e.on(e("#addReply",F.el),"click",function(){return(new F.reply).select()});e.on(e("form",F.el),"submit",F.submit);e.on(d,"input",function(){return F.selected.el.lastChild.textContent=this.value});e.on(d,"input",F.characterCount);e.on(l.firstChild,"change",function(){return e("input",F.selected.el).click()});e.on(F.warning,"click",F.cleanError);(new F.reply).select();b=["name","email","sub","com"];for(p=0,g=b.length;p<g;p++){r=b[p];e.on(e("[name="+r+"]",F.el),"focus",function(){return F.el.classList.add("focus")});e.on(e("[name="+r+"]",F.el),"blur",function(){return F.el.classList.remove("focus")});e.on(e("[name="+r+"]",F.el),"input",function(){var e;F.selected[this.name]=this.value;if(F.cooldown.auto&&F.selected===F.replies[0]&&0<(e=F.cooldown.seconds)&&e<=5){return F.cooldown.auto=false}});e.on(F.fileEl,"focus",function(){return F.el.classList.add("focus")});e.on(F.fileEl,"blur",function(){return F.el.classList.remove("focus")})}F.status.input=e("input[type=submit]",F.el);F.status();F.cooldown.init();F.captcha.init();e.add(ot.body,F.el);return e.event(F.el,new CustomEvent("QRDialogCreation",{bubbles:true}))},submit:function(t){var n,i,r,o,l,d,c,u,h,p,f,g,m;if(t!=null){t.preventDefault()}if(F.cooldown.seconds){F.cooldown.auto=!F.cooldown.auto;F.status();return}F.abort();p=F.replies[0];if(!st.REPLY&&st.BOARD==="f"){d=F.threadSelector.value;m="new"}else{m=st.THREAD_ID||F.threadSelector.value}if(m==="new"){m=null;if(["vg","q"].contains(st.BOARD)&&!p.sub){l="New threads require a subject."}else if(!(p.file||(g=!!e("input[name=textonly]",e.id("postForm"))))){l="No file selected."}else if(st.BOARD==="f"&&d==="9999"){l="Invalid tag specified."}}else if(!(p.com||p.file)){l="No file selected."}if(F.captcha.isEnabled&&!l){r=e.get("captchas",[]);while((i=r[0])&&i.time<Date.now()){r.shift()}if(i=r.shift()){o=i.challenge;f=i.response}else{o=F.captcha.img.alt;if(f=F.captcha.input.value){F.captcha.reload()}}e.set("captchas",r);F.captcha.count(r.length);if(!f){l="No valid captcha."}else{f=f.trim();if(!/\s/.test(f)){f=""+f+" "+f}}}if(l){F.cooldown.auto=false;F.status();F.error(l);return}F.cleanError();F.cooldown.auto=F.replies.length>1;if(s["Auto Hide QR"]&&!F.cooldown.auto&&s["Post Form Style"]==="float"){F.hide()}if(!F.cooldown.auto&&e.x('ancestor::div[@id="qr"]',ot.activeElement)){ot.activeElement.blur()}F.status({progress:"..."});h={resto:m,name:p.name,email:p.email,sub:p.sub,com:s["Markdown"]?I.format(p.com):p.com,upfile:p.file,filetag:d,spoiler:p.spoiler,textonly:g,mode:"regist",pwd:(c=ot.cookie.match(/4chan_pass=([^;]+)/))?decodeURIComponent(c[1]):e("input[name=pwd]").value,recaptcha_challenge_field:o,recaptcha_response_field:f};n={onload:function(){return F.response(this.response)},onerror:function(){F.cooldown.auto=false;F.status();F.error(e.el("a",{href:"//www.4chan.org/banned",target:"_blank",textContent:"Connection error, or you are banned."}));if(s["Check for Bans"]){e["delete"]("lastBanCheck");return a.init()}}};u={form:e.formData(h),upCallbacks:{onload:function(){return F.status({progress:"..."})},onprogress:function(e){return F.status({progress:""+Math.round(e.loaded/e.total*100)+"%"})}}};return F.ajax=e.ajax(e.id("postForm").parentNode.action,n,u)},response:function(t){var n,i,r,o,l,d,c,u,h,p,f,g;r=ot.implementation.createHTMLDocument("");r.documentElement.innerHTML=t;if(n=e(".banType",r)){i=e(".board",r).innerHTML;l=e.el("span",n.textContent.toLowerCase()==="banned"?(s["Check for Bans"]?(e["delete"]("lastBanCheck"),a.init()):void 0,l.innerHTML="You are banned on "+i+"! ;_;<br>\nClick <a href=//www.4chan.org/banned target=_blank>here</a> to see the reason."):l.innerHTML="You were issued a warning on "+i+" as "+e(".nameBlock",r).innerHTML+".<br>\nReason: "+e(".reason",r).innerHTML)}else if(l=r.getElementById("errmsg")){if(o=e("a",l)){o.target="_blank"}}else if(r.title!=="Post successful!"){l="Connection error with sys.4chan.org."}if(l){if(/captcha|verification/i.test(l.textContent)||l==="Connection error with sys.4chan.org."){if(/mistyped/i.test(l.textContent)){l.textContent="You seem to have mistyped the CAPTCHA."}F.cooldown.auto=F.captcha.isEnabled?!!e.get("captchas",[]).length:l==="Connection error with sys.4chan.org."?true:false;F.cooldown.set({delay:2})}else{F.cooldown.auto=false}F.status();F.error(l);return}h=F.replies[0];c=e.get("persona",{global:{}});if(!c[d=s["Per Board Persona"]?st.BOARD:"global"]){c[d]=JSON.parse(JSON.stringify(c.global))}c[d]={name:h.name,email:!s["Remember Sage"]&&/^sage$/.test(h.email)?/^sage$/.test(c[d].email)?null:c[d].email:h.email,sub:s["Remember Subject"]?h.sub:null};e.set("persona",c);g=r.body.lastChild.textContent.match(/thread:(\d+),no:(\d+)/),f=g[0],p=g[1],u=g[2];at.postID=u;if(!S.posts){S.posts=e.get("ownedPosts",{})}S.posts[u]=Date.now();e.set("ownedPosts",S.posts);e.event(F.el,new CustomEvent("QRPostSuccessful",{bubbles:true,detail:{threadID:p,postID:u}}));if(e.get("isBanned")){if(a.el){e.rm(a.el);delete a.el}e["delete"]("isBanned")}F.cooldown.set({post:h,isReply:p!=="0"});if(p==="0"){location.pathname="/"+st.BOARD+"/res/"+u}else{F.cooldown.auto=F.replies.length>1;if(s["Open Reply in New Tab"]&&!st.REPLY&&!F.cooldown.auto){e.open("//boards.4chan.org/"+st.BOARD+"/res/"+p+"#p"+u)}}if(s["Persistent QR"]||F.cooldown.auto){h.rm()}else{F.close()}F.status();return F.resetFileInput()},abort:function(){var e;if((e=F.ajax)!=null){e.abort()}delete F.ajax;return F.status()}};L={init:function(){var e;e=s["backlink"].replace(/%id/g,"' + id + '");this.funk=Function("id","return '"+e+"'");return R.callbacks.push(this.node)},node:function(t){var n,i,a,r,o,l,d,c,u,h,p,f,g;if(t.isInlined){return}u={};f=t.quotes;for(h=0,p=f.length;h<p;h++){c=f[h];if(c.parentNode.parentNode.className==="capcodeReplies"){break}if(c.hostname==="boards.4chan.org"&&!/catalog$/.test(c.pathname)&&(d=(g=c.hash)!=null?g.slice(2):void 0)){u[d]=true}}n=e.el("a",{href:"/"+st.BOARD+"/res/"+t.threadID+"#p"+t.ID,className:t.el.hidden?"filtered backlink":"backlink",textContent:L.funk(t.ID)});if(s["Mark Owned Posts"]){if(S.posts[t.ID]){e.addClass(n,"ownreply");n.textContent+=" (You)";l=true}}for(d in u){if(!(a=e.id("pi"+d))||!s["OP Backlinks"]&&/\bop\b/.test(a.parentNode.className)){continue}r=n.cloneNode(true);o=e.nodes([e.tn(" "),r]);if(s["Quote Preview"]){e.on(r,"mouseover",q.mouseover)}if(s["Quote Inline"]){e.on(r,"click",P.toggle);if(s["Quote Hash Navigation"]){P.qiQuote(r)}}if(!(i=e.id("blc"+d))){e.addClass(a.parentNode,"quoted");if(l){e.addClass(a.parentNode,"youQuoted")}i=e.el("span",{className:"container",id:"blc"+d});e.add(a,i)}e.add(i,o)}}};H={init:function(){p.callbacks.push(this.node);return R.callbacks.push(this.node)},node:function(t){var n,i,a,r,o;if(t.isInlined&&!t.isCrosspost){return}o=t.quotes;for(a=0,r=o.length;a<r;a++){i=o[a];if(!(i.hash&&i.hostname==="boards.4chan.org"&&!/catalog$/.test(i.pathname))){continue}n=i.pathname.split("/");if(n[1]===st.BOARD&&n[3]!==t.threadID){e.add(i,e.tn(" (Cross-thread)"))}}}};P={init:function(){this.callbacks.push(this.node);p.callbacks.push(this.node);return R.callbacks.push(this.node)},callbacks:[],cb:function(t,n){var i,a,r,o;t.isCrosspost=t.isInlined=true;t.threadID=e.x('ancestor::div[parent::div[@class="board"]]',n).id.match(/\d+$/)[0];o=R.callbacks;for(a=0,r=o.length;a<r;a++){i=o[a];i(t)}},cb2:function(e){var t,n,i,a;e.isInlined=true;a=P.callbacks;for(n=0,i=a.length;n<i;n++){t=a[n];t(e)}},node:function(t){var n,i,a,r,o,l,d;l=t.quotes;for(i=0,r=l.length;i<r;i++){n=l[i];if(!(n.hash&&n.hostname==="boards.4chan.org"&&!/catalog$/.test(n.pathname)||/\bdeadlink\b/.test(n.className))){continue}e.on(n,"click",P.toggle);if(s["Quote Hash Navigation"]&&!t.isInlined){P.qiQuote(n)}}d=t.backlinks;for(a=0,o=d.length;a<o;a++){n=d[a];e.on(n,"click",P.toggle)}},qiQuote:function(t){return e.after(t,[e.tn(" "),e.el("a",{className:"qiQuote",textContent:"#",href:t.href})])},toggle:function(t){var n;if(t.shiftKey||t.altKey||t.ctrlKey||t.metaKey||t.button!==0){return}t.preventDefault();n=this.dataset.id||this.hash.slice(2);if(/\binlined\b/.test(this.className)){P.rm(this,n)}else{if(e.x("ancestor::div[contains(@id,'p"+n+"')]",this)){return}P.add(this,n)}return e.toggleClass(this,"inlined")},add:function(t,n){var i,a,r,o,l,d,c,u,h;if(t.host==="boards.4chan.org"){d=t.pathname.split("/");i=d[1];h=d[3];c=n}else{i=t.dataset.board;h=0;c=t.dataset.id}a=i===st.BOARD?e.id("p"+c):false;o=e.el("div",{id:"i"+c,className:a?"inline":"inline crosspost"});u=(l=/\bbacklink\b/.test(t.className))?t.parentNode:e.x("ancestor-or-self::*[parent::blockquote][1]",t);if(s["Quote Hash Navigation"]&&!l&&u===t){e.after(u.nextElementSibling,o)}else{e.after(u,o)}A.post(i,h,c,o,P.cb,P.cb2);if(!a){return}if(l&&s["Forward Hiding"]){e.addClass(a.parentNode,"forwarded");++a.dataset.forwarded||(a.dataset.forwarded=1)}if((r=it.replies.indexOf(a))!==-1){it.replies.splice(r,1);it.update(true)}if(s["Color user IDs"]&&["b","q","soc"].contains(i)){return setTimeout(function(){return e.rmClass(e(".reply.highlight",o),"highlight")})}},rm:function(n,i){var a,r,o,l,d;a=e.x("following::div[@id='i"+i+"']",n);e.rm(a);if(!s["Forward Hiding"]){return}d=t(".backlink.inlined",a);for(o=0,l=d.length;o<l;o++){r=d[o];a=e.id(r.hash.slice(1));if(!--a.dataset.forwarded){e.rmClass(a.parentNode,"forwarded")}}if(/\bbacklink\b/.test(n.className)){a=e.id("p"+i);if(!--a.dataset.forwarded){return e.rmClass(a.parentNode,"forwarded")}}}};_={init:function(){p.callbacks.push(this.node);return R.callbacks.push(this.node)},node:function(t){var n,i,a,r;if(t.isInlined&&!t.isCrosspost){return}r=t.quotes;for(i=0,a=r.length;i<a;i++){n=r[i];if(n.hash.slice(2)===t.threadID){e.add(n,e.tn(" (OP)"))}}}};q={init:function(){P.callbacks.push(this.node);p.callbacks.push(this.node);R.callbacks.push(this.node);return e.ready(function(){return e.add(ot.body,q.el=e.el("div",{id:"qp",className:"reply dialog"}))})},callbacks:[],callback:function(e){var t,n,i,a;a=q.callbacks;for(n=0,i=a.length;n<i;n++){t=a[n];t(e)}},node:function(t){var n,i,a,r,o,s,l;
s=t.quotes;for(i=0,r=s.length;i<r;i++){n=s[i];if(!(n.hostname==="boards.4chan.org"&&n.hash&&!/catalog$/.test(n.pathname)||/\bdeadlink\b/.test(n.className))){continue}e.on(n,"mouseover",q.mouseover)}l=t.backlinks;for(a=0,o=l.length;a<o;a++){n=l[a];e.on(n,"mouseover",q.mouseover)}},mouseover:function(n){var i,a,r,o,l,d,c,u,h,p,f,g,m,b,v,k;if(nt.el||/\binlined\b/.test(this.className)){return}c=q.el;if(r=c.children){for(g=0,b=r.length;g<b;g++){a=r[g];e.rm(a)}}if(this.host==="boards.4chan.org"){l=this.pathname.split("/");i=l[1];p=l[3];d=this.hash.slice(2)}else{i=this.dataset.board;p=0;d=this.dataset.id}nt.el=c;nt.hover(n);A.post(i,p,d,c,function(e){R.prettify(e.blockquote);e.isArchived=c.className.contains("archivedPost");return q.callback(e)});e.on(this,"mousemove",nt.hover);e.on(this,"mouseout click",q.mouseout);f=s;if(o=e.id("p"+d)){f=s;if(f["Quote Highlighting"]){if(/\bop\b/.test(o.className)){e.addClass(o.parentNode,"qphl")}else{e.addClass(o,"qphl")}}h=e.x("ancestor::*[@id][1]",this).id.match(/\d+$/)[0];k=t(".quotelink, .backlink",c);for(m=0,v=k.length;m<v;m++){u=k[m];if(u.hash.slice(2)===h){e.addClass(u,"forwardlink")}}}},mouseout:function(t){var n,i;delete nt.el;e.rm(q.el.firstChild);if((i=this.hash)&&(n=e.id(i.slice(1)))){e.rmClass(n.parentNode,"qphl");e.rmClass(n,"qphl")}e.off(this,"mousemove",nt.hover);return e.off(this,"mouseout click",q.mouseout)}};U={init:function(){q.callbacks.push(this.node);p.callbacks.push(this.node);return R.callbacks.push(this.node)},node:function(n){var i,a,r,o,s,l,d,c,u,h;if(n.isInlined&&!n.isCrosspost){return}h=t(".deadlink",n.blockquote);for(c=0,u=h.length;c<u;c++){r=h[c];d=r.textContent;i=e.el("a",{textContent:""+d+" (Dead)"});if(!(o=d.match(/\d+$/))){continue}o=o[0];if(s=d.match(/^>>>\/([a-z\d]+)/)){a=s[1]}else if(l){a=l}else{a=l=e('a[title="Highlight this post"]',n.el).pathname.split("/")[1]}if(a===st.BOARD&&e.id("p"+o)){i.href="#p"+o;i.className="quotelink"}else{i.href=z.to({board:a,threadID:0,postID:o});i.className="deadlink";i.target="_blank";if(z.post(a,o)){e.addClass(i,"quotelink");i.setAttribute("data-board",a);i.setAttribute("data-id",o)}}e.replace(r,i)}}};G={init:function(){this.agent={gecko:"-moz-",webkit:"-webkit-",presto:"-o-"}[e.engine];if(ot.head){return this.wrapper()}return this.observe()},cleanup:function(){delete G.init;delete G.observe;delete G.wrapper;return delete G.cleanup},observe:function(){var t;if(N){G.observer=new N(t=this.wrapper);return G.observer.observe(ot,{childList:true,subtree:true})}else{return e.on(ot,"DOMNodeInserted",this.wrapper)}},wrapper:function(){if(ot.head){G.addStyle();if(G.observer){G.observer.disconnect()}else{e.off(ot,"DOMNodeInserted",G.wrapper)}return G.cleanup()}},addStyle:function(){var t;t=G.agent;return G.css=e.addStyle('/* dialog styling */\nhr.abovePostForm {\n  width: 100% !important;\n}\n.dialog.reply {\n  display: block;\n  border: 1px solid rgba(0,0,0,.25);\n  padding: 0;\n}\n.move {\n  cursor: move;\n}\nlabel, .favicon {\n  cursor: pointer;\n}\na[href="javascript:;"] {\n  text-decoration: none;\n}\n.warning {\n  color: red;\n}\n\n.hide_thread_button:not(.hidden_thread) {\n  float: left;\n}\n\n.thread > .hidden_thread ~ *,\n.hidden .sideArrows,\n[hidden],\n#globalMessage.hidden,\n#content > [name=tab]:not(:checked) + div,\n#updater:not(:hover) > :not(.move),\n.autohide:not(:hover) > form,\n#qp input, .forwarded {\n  display: none !important;\n}\n\n.menu_button {\n  display: inline-block;\n}\n.menu_button > span {\n  border-top:   .5em solid;\n  border-right: .3em solid transparent;\n  border-left:  .3em solid transparent;\n  display: inline-block;\n  margin: 2px;\n  vertical-align: middle;\n}\n#menu {\n  position: absolute;\n  outline: none;\n}\n.entry {\n  border-bottom: 1px solid rgba(0, 0, 0, .25);\n  cursor: pointer;\n  display: block;\n  outline: none;\n  padding: 3px 7px;\n  position: relative;\n  text-decoration: none;\n  white-space: nowrap;\n}\n.entry:last-child {\n  border: none;\n}\n.focused.entry {\n  background: rgba(255, 255, 255, .33);\n}\n.entry.hasSubMenu {\n  padding-right: 1.5em;\n}\n.hasSubMenu::after {\n  content: "";\n  border-left:   .5em solid;\n  border-top:    .3em solid transparent;\n  border-bottom: .3em solid transparent;\n  display: inline-block;\n  margin: .3em;\n  position: absolute;\n  right: 3px;\n}\n.hasSubMenu:not(.focused) > .subMenu {\n  display: none;\n}\n.subMenu {\n  position: absolute;\n  left: 100%;\n  top: 0;\n  margin-top: -1px;\n}\nh1,\nh2 {\n  text-align: center;\n}\n#qr > .move {\n  min-width: 300px;\n  overflow: hidden;\n  box-sizing: border-box;\n  '+t+"box-sizing: border-box;\n  padding: 0 2px;\n}\n#threadselect,\n#qr > .move > span {\n  float: right;\n  padding: 0 2px;\n}\n#autohide, .close, #qr select, #dump, .remove, .captchaimg, #qr div.warning {\n  cursor: pointer;\n}\n#qr select,\n#qr > form {\n  margin: 0;\n}\n#dump {\n  background: "+t+"linear-gradient(#EEE, #CCC);\n  background: linear-gradient(#EEE, #CCC);\n  width: 10%;\n}\n.gecko #dump {\n  padding: 1px 0 2px;\n}\n#dump:hover, #dump:focus {\n  background: "+t+"linear-gradient(#FFF, #DDD);\n  background: linear-gradient(#FFF, #DDD);\n}\n#dump:active, .dump #dump:not(:hover):not(:focus) {\n  background: "+t+"linear-gradient(#CCC, #DDD);\n  background: linear-gradient(#CCC, #DDD);\n}\n#qp:empty,\n#qr:not(.dump) #replies, .dump > form > label {\n  display: none;\n}\n#replies {\n  display: block;\n  height: 100px;\n  position: relative;\n  "+t+"user-select: none;\n  user-select: none;\n}\n#replies > div {\n  counter-reset: thumbnails;\n  top: 0; right: 0; bottom: 0; left: 0;\n  margin: 0; padding: 0;\n  overflow: hidden;\n  position: absolute;\n  white-space: pre;\n}\n#replies > div:hover {\n  bottom: -10px;\n  overflow-x: auto;\n  z-index: 1;\n}\n.thumbnail {\n  background-color: rgba(0,0,0,.2) !important;\n  background-position: 50% 20% !important;\n  background-size: cover !important;\n  border: 1px solid #666;\n  box-sizing: border-box;\n  "+t+"box-sizing: border-box;\n  cursor: move;\n  display: inline-block;\n  height: 90px; width: 90px;\n  margin: 5px; padding: 2px;\n  opacity: .5;\n  outline: none;\n  overflow: hidden;\n  position: relative;\n  text-shadow: 0 1px 1px #000;\n  "+t+'transition: opacity .25s ease-in-out;\n  transition: opacity .25s ease-in-out;\n  vertical-align: top;\n}\n.thumbnail:hover, .thumbnail:focus {\n  opacity: .9;\n}\n.thumbnail#selected {\n  opacity: 1;\n}\n.thumbnail::before {\n  counter-increment: thumbnails;\n  content: counter(thumbnails);\n  color: #FFF;\n  font-weight: 700;\n  padding: 3px;\n  position: absolute;\n  top: 0;\n  right: 0;\n  text-shadow: 0 0 3px #000, 0 0 8px #000;\n}\n.thumbnail.drag {\n  box-shadow: 0 0 10px rgba(0,0,0,.5);\n}\n.thumbnail.over {\n  border-color: #FFF;\n}\n.thumbnail > span {\n  color: #FFF;\n}\n.remove {\n  background: none;\n  color: #E00;\n  font-weight: 700;\n  padding: 3px;\n}\n.remove:hover::after {\n  content: " Remove";\n}\n.thumbnail > label {\n  background: rgba(0,0,0,.5);\n  color: #FFF;\n  right: 0; bottom: 0; left: 0;\n  position: absolute;\n  text-align: center;\n}\n.thumbnail > label > input {\n  margin: 0;\n}\n#addReply {\n  color: #333;\n  font-size: 3.5em;\n  line-height: 100px;\n}\n#addReply:hover, #addReply:focus {\n  color: #000;\n}\n.field {\n  border: 1px solid #CCC;\n  box-sizing: border-box;\n  '+t+"box-sizing: border-box;\n  color: #333;\n  font: 13px sans-serif;\n  margin: 0;\n  padding: 2px 4px 3px;\n  "+t+"transition: color .25s, border .25s;\n  transition: color .25s, border .25s;\n}\n.field:"+t+"placeholder,\n.field:hover:"+t+"placeholder {\n  color: #AAA;\n}\n.field:hover, .field:focus {\n  border-color: #999;\n  color: #000;\n  outline: none;\n}\n.userInfo > .field:not(#dump) {\n  width: 95px;\n  min-width: 30%;\n  max-width: 30%;\n}\n#qr textarea.field {\n  display: "+t+"box;\n  min-height: 160px;\n  min-width: 100%;\n}\n#qr.captcha textarea.field {\n  min-height: 120px;\n}\n.textarea {\n  position: relative;\n}\n#charCount {\n  color: #000;\n  background: hsla(0, 0%, 100%, .5);\n  font-size: 8pt;\n  margin: 1px;\n  position: absolute;\n  bottom: 0;\n  right: 0;\n  pointer-events: none;\n}\n#charCount.warning {\n  color: red;\n}\n.captchainput > .field {\n  min-width: 100%;\n}\n.captchaimg {\n  background: #FFF;\n  outline: 1px solid #CCC;\n  outline-offset: -1px;\n  text-align: center;\n}\n.captchaimg > img {\n  display: block;\n  height: 57px;\n  width: 300px;\n}\n#qr [type=file] {\n  margin: 1px 0;\n  width: 70%;\n}\n#qr [type=submit] {\n  margin: 1px 0;\n  padding: 1px; /* not Gecko */\n  width: 30%;\n}\n.gecko #qr [type=submit] {\n  padding: 0 1px; /* Gecko does not respect box-sizing: border-box */\n}\n#spoilerLabel:not([hidden]) {\n  display: block;\n}\n.fileText:hover .fntrunc,\n.fileText:not(:hover) .fnfull {\n  display: none;\n}\n.fitwidth img[data-md5] + img {\n  max-width: 100%;\n}\n.gecko  .fitwidth img[data-md5] + img,\n.presto .fitwidth img[data-md5] + img {\n  width: 100%;\n}\n#qr, #qp, #updater, #stats, #ihover, #overlay, #navlinks, #mouseover {\n  position: fixed;\n}\n#ihover {\n  max-height: 97%;\n  max-width: 75%;\n  padding-bottom: 18px;\n}\n#navlinks {\n  font-size: 16px;\n  top: 25px;\n  right: 5px;\n}\nbody {\n  box-sizing: border-box;\n  "+t+'box-sizing: border-box;\n}\nbody.unscroll {\n  overflow: hidden;\n}\n#mouseover {\n  z-index: 2;\n}\n#overlay {\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  text-align: center;\n  background: rgba(0,0,0,.5);\n  z-index: 1;\n}\n#overlay::after {\n  content: "";\n  display: inline-block;\n  height: 100%;\n  vertical-align: middle;\n}\n#options {\n  box-sizing: border-box;\n  '+t+"box-sizing: border-box;\n  display: inline-block;\n  padding: 5px;\n  position: relative;\n  text-align: left;\n  vertical-align: middle;\n  width: 600px;\n  max-width: 100%;\n  height: 500px;\n  max-height: 100%;\n}\n#credits {\n  float: right;\n}\n#options ul {\n  padding: 0;\n}\n#options article li {\n  margin: 10px 0 10px 2em;\n}\n#options code {\n  background: hsla(0, 0%, 100%, .5);\n  color: #000;\n  padding: 0 1px;\n}\n#options label {\n  text-decoration: underline;\n}\n#selected_tab {\n  font-weight: 700;\n}\n#content {\n  overflow: auto;\n  position: absolute;\n  top: 2.5em;\n  right: 5px;\n  bottom: 5px;\n  left: 5px;\n}\n#content textarea {\n  font-family: monospace;\n  min-height: 350px;\n  resize: vertical;\n  width: 100%;\n}\n\n#updater {\n  text-align: right;\n}\n#updater:not(:hover) {\n  border: none;\n  background: transparent;\n}\n#updater input[type=number] {\n  width: 4em;\n}\n.new {\n  background: lime;\n}\n\n#watcher {\n  padding-bottom: 5px;\n  position: absolute;\n  overflow: hidden;\n  white-space: nowrap;\n}\n#watcher:not(:hover) {\n  max-height: 220px;\n}\n#watcher > div {\n  max-width: 200px;\n  overflow: hidden;\n  padding-left: 5px;\n  padding-right: 5px;\n  text-overflow: ellipsis;\n}\n#watcher > .move {\n  padding-top: 5px;\n  text-decoration: underline;\n}\n\n#qp {\n  padding: 2px 2px 5px;\n}\n#qp .post {\n  border: none;\n  margin: 0;\n  padding: 0;\n}\n#qp img {\n  max-height: 300px;\n  max-width: 500px;\n}\n.qphl {\n  box-shadow: 0 0 0 2px rgba(216, 94, 49, .7);\n}\n.quotelink.deadlink {\n  text-decoration: underline !important;\n}\n.deadlink:not(.quotelink) {\n  text-decoration: none !important;\n}\n.inlined {\n  opacity: .5;\n}\n.inline {\n  background-color: rgba(255, 255, 255, 0.15);\n  border: 1px solid rgba(128, 128, 128, 0.5);\n  display: table;\n  margin: 2px;\n  padding: 2px;\n}\n.inline .post {\n  background: none;\n  border: none;\n  margin: 0;\n  padding: 0;\n}\ndiv.opContainer {\n  display: block !important;\n}\n.opContainer.filter_highlight {\n  box-shadow: inset 5px 0 rgba(255, 0, 0, .5);\n}\n.opContainer.filter_highlight.qphl {\n  box-shadow: inset 5px 0 rgba(255, 0, 0, .5),\n              0 0 0 2px rgba(216, 94, 49, .7);\n}\n.filter_highlight > .reply {\n  box-shadow: -5px 0 rgba(255, 0, 0, .5);\n}\n.filter_highlight > .reply.qphl {\n  box-shadow: -5px 0 rgba(255, 0, 0, .5),\n              0 0 0 2px rgba(216, 94, 49, .7)\n}\n.filtered,\n.quotelink.filtered {\n  text-decoration: underline;\n  text-decoration: line-through !important;\n}\n.quotelink.forwardlink,\n.backlink.forwardlink {\n  text-decoration: none;\n  border-bottom: 1px dashed;\n}\n.threadContainer {\n  margin-left: 20px;\n  border-left: 1px solid black;\n}\n"+(s["Custom CSS"]?s["customCSS"]:"")+"\n"+(s["Quick Reply"]&&s["Hide Original Post Form"]?"#postForm { display: none; }":""))}};A={post:function(t,n,i,a,r,o){var s,l;if(t===st.BOARD&&(s=e.id("pc"+i))){s=A.cleanPost(s.cloneNode(true));if(o){o(R.preParse(s))}e.add(a,s);return}a.innerHTML="<div class=post>Loading post No."+i+"...</div>";if(n){return e.cache("//api.4chan.org/"+t+"/res/"+n+".json",function(){return A.parsePost(this,t,n,i,a,r)})}else if(l=z.post(t,i)){return e.cache(l,function(){return A.parseArchivedPost(this,t,i,a,r)})}},parsePost:function(t,n,i,a,o,s){var l,d,c,u,h,p,f,g;h=t.status;if(h!==200){if(p=z.post(n,a)){e.cache(p,function(){return A.parseArchivedPost(this,n,a,o,s)})}else{e.addClass(o,"warning");o.innerHTML=h===404?"<div class=post>Thread No."+i+" 404'd.</div>":"<div class=post>Error "+t.status+": "+t.statusText+".</div>"}return}c=JSON.parse(t.response).posts;if(u=c[0].custom_spoiler){r.spoilerRange[n]=u}a=+a;for(f=0,g=c.length;f<g;f++){l=c[f];if(l.no===a){break}if(l.no>a){if(p=z.post(n,a)){e.cache(p,function(){return A.parseArchivedPost(this,n,a,o,s)})}else{e.addClass(o,"warning");o.textContent="Post No."+a+" was not found."}return}}l=R.preParse(d=A.cleanPost(r.postFromObject(l,n)));if(s){s(l,o)}return e.replace(o.firstChild,d)},parseArchivedPost:function(t,n,i,a,o){var s,l,d,c,u,h,p;d=JSON.parse(t.response);if(d.error){e.addClass(a,"warning");a.textContent=d.error;return}s=e.el("blockquote",{textContent:d.comment});s.innerHTML=s.innerHTML.replace(/\n|\[\/?b\]|\[\/?spoiler\]|\[\/?code\]|\[\/?moot\]|\[\/?banned\]/g,function(e){switch(e){case"\n":return"<br>";case"[b]":return"<b>";case"[/b]":return"</b>";case"[spoiler]":return"<s>";case"[/spoiler]":return"</s>";case"[code]":return"<pre class=prettyprint>";case"[/code]":return"</pre>";case"[moot]":return'<div style="padding:5px;margin-left:.5em;border-color:#faa;border:2px dashed rgba(255,0,0,.1);border-radius:2px">';case"[/moot]":return"</div>";case"[banned]":return'<b style="color: red;">';case"[/banned]":return"</b>"}});l=s.innerHTML.replace(/(^|>)(&gt;[^<$]*)(<|$)/g,"$1<span class=quote>$2</span>$3");c={postID:i,threadID:d.thread_num,board:n,name:d.name_processed,capcode:function(){switch(d.capcode){case"M":return"mod";case"A":return"admin";case"D":return"developer"}}(),tripcode:d.trip,uniqueID:d.poster_hash,email:d.email?encodeURI(d.email.replace(/&quot;/g,'"')):"",subject:d.title_processed,flagCode:d.poster_country,flagName:d.poster_country_name_processed,date:d.fourchan_date,dateUTC:d.timestamp,comment:l};if((p=d.media)!=null?p.media_filename:void 0){c.file={name:d.media.media_filename_processed,timestamp:d.media.media_orig,url:d.media.media_link||d.media.remote_media_link,height:d.media.media_h,width:d.media.media_w,MD5:d.media.media_hash,size:d.media.media_size,turl:d.media.thumb_link||"//thumbs.4chan.org/"+n+"/thumb/"+d.media.preview_orig,theight:d.media.preview_h,twidth:d.media.preview_w,isSpoiler:d.media.spoiler==="1"}}u=R.preParse(h=A.cleanPost(r.post(c,true)));if(o){o(u,a)}return e.replace(a.firstChild,h)},cleanPost:function(n){var i,a,r,o,s,l,d,c,u,h,p,f,g,m,b,v,A,k;d=e(".post",n);v=ct.call(n.childNodes);for(c=0,f=v.length;c<f;c++){i=v[c];if(i!==d){e.rm(i)}}A=t(".inline",d);for(u=0,g=A.length;u<g;u++){o=A[u];e.rm(o)}k=t(".inlined",d);for(h=0,m=k.length;h<m;h++){s=k[h];e.rmClass(s,"inlined")}l=Date.now();r=t("[id]",n);r.push(n);for(p=0,b=r.length;p<b;p++){a=r[p];a.id=""+l+"_"+a.id}e.rmClass(n,"forwarded");e.rmClass(n,"qphl");e.rmClass(d,"highlight");e.rmClass(d,"qphl");n.hidden=d.hidden=false;return n},title:function(t){var n,i,a;i=e(".op",t);n=e(".postInfo .subject",i);if(!n.textContent){n=e("blockquote",i);if(!n.textContent){n=e(".nameBlock",i)}}a=e.el("span",{innerHTML:n.innerHTML.replace(/<br>/g," ")});return"/"+st.BOARD+"/ - "+a.textContent.trim()}};r={spoilerRange:{},shortFilename:function(e,t){var n;n=t?40:30;if(e.length-4>n){return""+e.slice(0,n-5)+"(...)."+e.slice(-3)}else{return e}},postFromObject:function(e,t){var n;n={postID:e.no,threadID:e.resto||e.no,board:t,name:e.name,capcode:e.capcode,tripcode:e.trip,uniqueID:e.id,email:e.email?encodeURI(e.email.replace(/&quot;/g,'"')):"",subject:e.sub,flagCode:e.country,flagName:e.country_name,date:e.now,dateUTC:e.time,comment:e.com,isSticky:!!e.sticky,isClosed:!!e.closed};if(e.ext||e.filedeleted){n.file={name:e.filename+e.ext,timestamp:""+e.tim+e.ext,url:"//images.4chan.org/"+t+"/src/"+e.tim+e.ext,height:e.h,width:e.w,MD5:e.md5,size:e.fsize,turl:"//thumbs.4chan.org/"+t+"/thumb/"+e.tim+"s.jpg",theight:e.tn_h,twidth:e.tn_w,isSpoiler:!!e.spoiler,isDeleted:!!e.filedeleted}}return r.post(n)},post:function(n,i){var a,o,s,l,d,c,u,h,p,f,g,m,b,v,A,k,y,w,x,C,D,R,S,I,T,N,B,E,O,M,F,L,H,P,_,q,U,z,j,Q,J,W,Y,V;F=n.postID,z=n.threadID,o=n.board,M=n.name,s=n.capcode,j=n.tripcode,Q=n.uniqueID,g=n.email,U=n.subject,S=n.flagCode,I=n.flagName,p=n.date,f=n.dateUTC,O=n.isSticky,B=n.isClosed,u=n.comment,A=n.file;E=F===z;_="//static.4chan.org";if(g){b='<a href="mailto:'+g+'" class="useremail">';m="</a>"}else{b="";m=""}U="<span class=subject>"+(U||"")+"</span>";J=!s&&Q?" <span class='posteruid id_"+Q+"'>(ID: "+("<span class=hand title='Highlight posts by this ID'>"+Q+"</span>)</span> "):"";switch(s){case"admin":case"admin_highlight":l=" capcodeAdmin";d=" <strong class='capcode hand id_admin'"+"title='Highlight posts by the Administrator'>## Admin</strong>";s=" <img src='"+_+"/image/adminicon.gif' "+"alt='This user is the 4chan Administrator.' "+"title='This user is the 4chan Administrator.' class=identityIcon>";break;case"mod":l=" capcodeMod";d=" <strong class='capcode hand id_mod' "+"title='Highlight posts by Moderators'>## Mod</strong>";s=" <img src='"+_+"/image/modicon.gif' "+"alt='This user is a 4chan Moderator.' "+"title='This user is a 4chan Moderator.' class=identityIcon>";break;case"developer":l=" capcodeDeveloper";d=" <strong class='capcode hand id_developer' "+"title='Highlight posts by Developers'>## Developer</strong>";s=" <img src='"+_+"/image/developericon.gif' "+"alt='This user is a 4chan Developer.' "+"title='This user is a 4chan Developer.' class=identityIcon>";break;default:l="";d="";s=""}R=S?" <img src='"+_+"/image/country/"+(o==="pol"?"troll/":"")+S.toLowerCase()+(".gif' alt="+S+" title='"+I+"' class=countryFlag>"):"";if(A!=null?A.isDeleted:void 0){y=E?"<div class=file id=f"+F+"><div class=fileInfo></div><span class=fileThumb>"+("<img src='"+_+"/image/filedeleted.gif' alt='File deleted.' class='fileDeleted retina'>")+"</span></div>":"<div id=f"+F+" class=file><span class=fileThumb>"+("<img src='"+_+"/image/filedeleted-res.gif' alt='File deleted.' class='fileDeletedRes retina'>")+"</span></div>"}else if(A){v=A.name.slice(-3);if(!A.twidth&&!A.theight&&v==="gif"){A.twidth=A.width;A.theight=A.height}x=e.bytesToString(A.size);C=A.turl;if(A.isSpoiler){x="Spoiler Image, "+x;if(!i){C="//static.4chan.org/image/spoiler";if(P=r.spoilerRange[o]){C+="-"+o+Math.floor(1+P*Math.random())}C+=".png";A.twidth=A.theight=100}}N="<a class='fileThumb"+(A.isSpoiler?" imgspoiler":"")+"' href='"+A.url+"' target=_blank>"+("<img src='"+C+"' alt='"+x+"' data-md5="+A.MD5+" style='width:"+A.twidth+"px;height:"+A.theight+"px'></a>");a=e.el("a",{innerHTML:A.name});D=a.textContent.replace(/%22/g,'"');a.textContent=r.shortFilename(D);H=a.innerHTML;a.textContent=D;D=a.innerHTML.replace(/'/g,"&apos;");k=v==="pdf"?"PDF":""+A.width+"x"+A.height;w="<span class=fileText id=fT"+F+(A.isSpoiler?" title='"+D+"'":"")+">File: <a href='"+A.url+"' target=_blank>"+A.timestamp+"</a>"+("-("+x+", "+k+(A.isSpoiler?"":", <span title='"+D+"'>"+H+"</span>"))+")</span>";y="<div id=f"+F+" class=file><div class=fileInfo>"+w+"</div>"+N+"</div>"}else{y=""}j=j?" <span class=postertrip>"+j+"</span>":"";q=O?' <img src=//static.4chan.org/image/sticky.gif alt=Sticky title=Sticky style="height:16px;width:16px">':"";c=B?' <img src=//static.4chan.org/image/closed.gif alt=Closed title=Closed style="height:16px;width:16px">':"";h=e.el("div",{id:"pc"+F,className:"postContainer "+(E?"op":"reply")+"Container",innerHTML:(E?"":"<div class=sideArrows id=sa"+F+">&gt;&gt;</div>")+("<div id=p"+F+" class='post "+(E?"op":"reply")+(s==="admin_highlight"?" highlightPost":"")+"'>")+(E?y:"")+("<div class='postInfo desktop' id=pi"+F+">")+("<input type=checkbox name="+F+" value=delete> ")+(""+U+" ")+("<span class='nameBlock"+l+"'>")+b+("<span class=name>"+(M||"")+"</span>")+j+d+m+s+J+R+q+c+" </span> "+("<span class=dateTime data-utc="+f+">"+p+"</span> ")+"<span class='postNum desktop'>"+("<a href="+("/"+o+"/res/"+z+"#p"+F)+" title='Highlight this post'>No.</a>")+("<a href='"+(st.REPLY&&+st.THREAD_ID===z?"javascript:quote("+F+")":"/"+o+"/res/"+z+"#q"+F)+"' title='Quote this post'>"+F+"</a>")+"</span>"+"</div>"+(E?"":y)+("<blockquote class=postMessage id=m"+F+">"+(u||"")+"</blockquote> ")+"</div>"});V=t(".quotelink",h);for(W=0,Y=V.length;W<Y;W++){L=V[W];T=L.getAttribute("href");if(T[0]==="/"){continue}L.href="/"+o+"/res/"+T}return h}};R={init:function(){var t,n,i,a,r,o,d,c;R.flatten(null,l);for(t in s){d=s[t];s[t]=e.get(t,d)}i=location.pathname;a=i.slice(1).split("/");st.BOARD=a[0],o=a[1];switch(o){case"res":st.REPLY=true;st.THREAD_ID=a[2];break;case"catalog":st.CATALOG=true}if(["b","d","e","gif","h","hc","hm","hr","pol","r","r9k","rs","s","soc","t","u","y"].contains(st.BOARD)){st.TYPE="nsfw"}c=s;if(c["Interval per board"]){s["Interval_"+st.BOARD]=e.get("Interval_"+st.BOARD,s["Interval"]);s["BGInterval_"+st.BOARD]=e.get("BGInterval_"+st.BOARD,s["BGInteval"])}switch(location.hostname){case"sys.4chan.org":if(/report/.test(location.search)){e.ready(function(){var t,n;n=e("form");t=e.id("recaptcha_response_field");e.on(t,"keydown",function(t){if(t.keyCode===8&&!t.target.value){return e.globalEval("Recaptcha.reload()")}});return e.on(n,"submit",function(e){var i;e.preventDefault();i=t.value.trim();if(!/\s/.test(i)){t.value=""+i+" "+i}return n.submit()})})}return;case"images.4chan.org":e.ready(function(){var e;if(/^4chan - 404/.test(ot.title)&&c["404 Redirect"]){i=location.pathname.split("/");e=z.image(i[1],i[3]);if(e){return location.href=e}}});return}lt=e.get("userNavigation",E);R.prune();n=Date.now();if(c["Check for Updates"]&&e.get("lastUpdate",0)<n-18*e.HOUR){e.ready(function(){e.on(window,"message",R.message);e.set("lastUpdate",n);return e.add(ot.head,e.el("script",{src:"https://github.com/zixaphir/appchan-x/raw/4chanX/latest.js"}))})}r=JSON.parse(localStorage.getItem("4chan-settings"))||{};r.disableAll=true;localStorage.setItem("4chan-settings",JSON.stringify(r));if(st.CATALOG){return e.ready(R.catalog)}else{return R.features()}},catalog:function(){var t;t=s;if(t["Catalog Links"]){o.init()}if(t["Thread Hiding"]){$.init()}return e.ready(function(){var n,i,a,r,o;if(t["Custom Navigation"]){d.init()}o=["boardNavDesktop","boardNavDesktopFoot"];for(a=0,r=o.length;a<r;a++){i=o[a];if(n=e("a[href*='/"+st.BOARD+"/']",e.id(i))){e.addClass(n,"current")}}})},features:function(){var t;t=s;G.init();if(t["Filter"]){v.init()}if(t["Reply Hiding"]){J.init()}if(t["Reply Hiding"]||t["Reply Hiding Link"]||t["Filter"]){K.init();q.callbacks.push(J.unhide);P.callbacks.push(J.unhide)}if(t["Anonymize"]){n.init()}if(t["Time Formatting"]){et.init()}if(t["File Info Formatting"]){b.init()}if(t["Sauce"]){V.init()}if(t["Reveal Spoilers"]){Y.init()}if(t["Image Auto-Gif"]){AutoGif.init()}if(t["Png Thumbnail Fix"]){PngFix.init()}if(t["Image Hover"]){w.init()}if(t["Menu"]){T.init();if(t["Report Link"]){W.init()}if(t["Delete Link"]){c.init()}if(t["Filter"]){v.menuInit()}if(t["Archive Link"]){i.init()}if(t["Download Link"]){u.init()}if(t["Embed Link"]){h.init()}if(t["Thread Hiding Link"]){X.init()}if(t["Reply Hiding Link"]){Q.init()}}if(t["Linkify"]){D.init()}if(t["Resurrect Quotes"]){U.init()}if(t["Remove Spoilers"]){j.init()}if(t["Quote Inline"]){P.init()}if(t["Quote Preview"]){q.init()}if(t["Quote Backlinks"]){L.init()}if(t["Mark Owned Posts"]){S.init()}if(t["Indicate OP quote"]){_.init()}if(t["Indicate Cross-thread Quotes"]){H.init()}if(t["Color user IDs"]){k.init()}if(t["Replace GIF"]||t["Replace PNG"]||t["Replace JPG"]){x.init()}return e.ready(R.featuresReady)},featuresReady:function(){var n,i,a,r,l,c,u,h,b,v,A,k,w,x;h=s;if(/^4chan - 404/.test(ot.title)){if(h["404 Redirect"]&&/^\d+$/.test(st.THREAD_ID)){location.href=z.to({board:st.BOARD,threadID:st.THREAD_ID,postID:location.hash})}return}if(!e.id("navtopright")){return}e.addClass(ot.body,e.engine);e.addClass(ot.body,"fourchan_x");if(h["Custom Navigation"]){d.init()}w=["boardNavDesktop","boardNavDesktopFoot"];for(b=0,A=w.length;b<A;b++){a=w[b];if(n=e("a[href*='/"+st.BOARD+"/']",e.id(a))){e.addClass(n,"current")}}c=Date.now();m.init();O.init();if(h["Quick Reply"]){F.init()}if(h["Image Expansion"]){y.init()}if(h["Catalog Links"]){o.init()}if(h["Thread Watcher"]){rt.init()}if(h["Keybinds"]){C.init()}if(h["Fappe Tyme"]){g.init()}if(st.REPLY){if(h["Prefetch"]){M.init()}if(h["Thread Updater"]){at.init()}if(h["Thread Stats"]){Z.init()}if(h["Reply Navigation"]){B.init()}if(h["Post in Title"]){tt.init()}if(h["Unread Count"]||h["Unread Favicon"]){it.init()}}else{if(h["Thread Hiding"]){$.init()}if(h["Thread Expansion"]){f.init()}if(h["Comment Expansion"]){p.init()}if(h["Index Navigation"]){B.init()}}i=e(".board");l=[];u=function(){if(ot.readyState==="complete"){return true}return false};x=t(".postContainer",i);for(v=0,k=x.length;v<k;v++){r=x[v];R.node(R.preParse(r),u)}R.hasCodeTags=!!e('script[src^="//static.4chan.org/js/prettify/prettify"]');if(N){R.observer=new N(R.observe);R.observer.observe(i,{childList:true,subtree:true});e.ready(function(){return R.observer.disconnect()})}else{e.on(i,"DOMNodeInserted",R.listener);e.ready(function(){return e.off(i,"DOMNodeInserted",R.listener)})}},prune:function(){var t,n,i,a,r,o,s,l;a=Date.now();st.hiddenReplies=e.get("hiddenReplies/"+st.BOARD+"/",{});if(e.get("lastChecked",0)<a-1*e.DAY){e.set("lastChecked",a);t=a-7*e.DAY;n=e.get("hiddenThreads/"+st.BOARD+"/",{});r=e.get("ownedPosts",{});s=e.get("CachedTitles",{});for(i in n){o=n[i];if(o<t){delete n[i]}}l=st.hiddenReplies;for(i in l){o=l[i];if(o<t){delete st.hiddenReplies[i]}}for(i in r){o=r[i];if(o<t){delete r[i]}}for(i in s){if(s[i][1]<t){delete s[i]}}e.set("hiddenThreads/"+st.BOARD+"/",n);e.set("hiddenReplies/"+st.BOARD+"/",st.hiddenReplies);e.set("CachedTitles",s);return e.set("ownedPosts",r)}},flatten:function(e,t){var n,i;if(t instanceof Array){s[e]=t[0]}else if(typeof t==="object"){for(n in t){i=t[n];R.flatten(n,i)}}else{s[e]=t}},message:function(t){var n,i;n=t.data.version;if(n&&n!==R.version){i=e.el("div",{id:"xupdater",className:"reply",innerHTML:"<a href=https://raw.github.com/zixaphir/appchan-x/"+n+"/appchan_x.user.js>An updated version of Appchan X (v"+n+") is available.</a> <a href=javascript:; id=dismiss_xupdate>dismiss</a>"});e.on(e("#dismiss_xupdate",i),"click",function(){return e.rm(i)});return e.prepend(e.id("delform"),i)}},preParse:function(t){var n,i,a,r,o,s;o=(r=t.parentElement)?r.className:"";n=e(".post",t);s={root:t,el:n,"class":n.className,ID:n.id.match(/\d+$/)[0],threadID:st.THREAD_ID||(r?e.x('ancestor::div[parent::div[@class="board"]]',t).id.match(/\d+$/)[0]:void 0),isArchived:o.contains("archivedPost"),isInlined:/\binline\b/.test(o),isCrosspost:o.contains("crosspost"),blockquote:n.lastElementChild,quotes:n.getElementsByClassName("quotelink"),backlinks:n.getElementsByClassName("backlink"),fileInfo:false,img:false};if(i=e("img[data-md5]",n)){a=i.parentNode;s.img=i;s.fileInfo=a.previousElementSibling;s.hasPdf=/\.pdf$/.test(a.href)}R.prettify(s.blockquote);return s},node:function(e,t){var n,i,a,r;r=R.callbacks;for(i=0,a=r.length;i<a;i++){n=r[i];try{n(e)}catch(o){if(t){alert("4chan X has experienced an error. You can help by sending this snippet to:\nhttps://github.com/zixaphir/appchan-x/issues\n\n"+R.version+"\n"+window.location+"\n"+navigator.userAgent+"\n\n"+o+"\n"+o.stack)}}}},observe:function(e){var t,n,i,a,r,o;i=[];o=[];for(a=0,r=e.length;a<r;a++){n=e[a];o.push(function(){var e,i,a,r;a=n.addedNodes;r=[];for(e=0,i=a.length;e<i;e++){t=a[e];if(/\bpostContainer\b/.test(t.className)){r.push(R.node(R.preParse(t)))}}return r}())}return o},listener:function(e){var t;t=e.target;if(/\bpostContainer\b/.test(t.className)){return R.node(R.preParse(t))}},prettify:function(t){var n;if(!R.hasCodeTags){return}switch(st.BOARD){case"g":n=function(){var e,t,n,i;i=document.getElementById("_id_").getElementsByClassName("prettyprint");for(t=0,n=i.length;t<n;t++){e=i[t];e.innerHTML=prettyPrintOne(e.innerHTML.replace(/\s/g,"&nbsp;"))}};break;case"sci":n=function(){jsMath.Process(document.getElementById("_id_"))};break;default:return}return e.globalEval((""+n).replace("_id_",t.id))},namespace:"4chan_x.",version:"1.2.0",callbacks:[]};R.init()}).call(this);